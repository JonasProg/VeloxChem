//
//                     V.E.L.O.X. C.H.E.M. MP
//      ---------------------------------------------------
//           An Electronic Structure Code for Nanoscale
//
//  Created by Zilvinas Rinkevicius (rinkevic@kth.se), KTH, Sweden.
//  Copyright Â© 2018 by Velox Chem MP developers. All rights reserved.

#include "KineticEnergyIntegralsDriverTest.hpp"

#include "KineticEnergyIntegralsDriver.hpp"
#include "MoleculeSetter.hpp"
#include "MolecularBasisSetter.hpp"

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeSSForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 0);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 3.082911586456580,  2.133606523257290, -0.118704796811193,
                                 0.188907818018553,  2.133606523257290,  1.800000000000001,
                                 0.042721407212621,  0.271738995098817, -0.118704796811193,
                                 0.042721407212621,  3.676148028919980,  1.444559298223930,
                                 0.188907818018553,  0.271738995098817,  1.444559298223930,
                                 1.200000000000001};

    std::vector<int32_t> rows{0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3};

    std::vector<int32_t> cols{0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 4, 4, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeSPForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 1);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 3.082911586456580,  2.133606523257290, -0.154617667962229,
                                -0.418320601655943, -0.283465724597419, -0.766921103035895,
                                -0.103078445308152, -0.278880401103962,  2.133606523257290,
                                 1.800000000000001, -0.253501885073874, -0.436341425420179,
                                -0.464753455968768, -0.799959279936996, -0.169001256715916,
                                -0.290894283613453, -0.154617667962229, -0.253501885073874,
                                 6.128188526493468,  2.082419686588810, -0.418320601655943,
                                -0.436341425420179,  2.082419686588810,  2.000000000000000,
                                -0.283465724597419, -0.464753455968768,  6.128188526493468,
                                 2.082419686588810, -0.766921103035895, -0.799959279936996,
                                 2.082419686588810,  2.000000000000000, -0.103078445308152,
                                -0.169001256715916,  6.128188526493468,  2.082419686588810,
                                -0.278880401103962, -0.290894283613453,  2.082419686588810,
                                 2.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2,
                              2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6,
                              6, 6, 7, 7, 7, 7};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0,
                              1, 2, 3, 0, 1, 2, 3, 0, 1, 4, 5, 0, 1, 4, 5, 0, 1,
                              6, 7, 0, 1, 6, 7};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 8, 8, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputePSForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 0);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 3.676148028919980,  1.444559298223930,  0.179759663973418,
                                 0.355144582925384,  0.329559383951266,  0.651098402029872,
                                 0.119839775982279,  0.236763055283590,  1.444559298223930,
                                 1.200000000000001,  0.270494350745713,  0.356271281972707,
                                 0.495906309700475,  0.653164016949963,  0.180329567163809,
                                 0.237514187981805,  0.179759663973418,  0.270494350745713,
                                 5.144058407759709,  3.427919368883665,  0.355144582925384,
                                 0.356271281972707,  3.427919368883665,  3.000000000000000,
                                 0.329559383951266,  0.495906309700475,  5.144058407759709,
                                 3.427919368883665,  0.651098402029872,  0.653164016949963,
                                 3.427919368883665,  3.000000000000000,  0.119839775982279,
                                 0.180329567163809,  5.144058407759709,  3.427919368883665,
                                 0.236763055283590,  0.237514187981805,  3.427919368883665,
                                 3.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2,
                              2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6,
                              6, 6, 7, 7, 7, 7};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0,
                              1, 2, 3, 0, 1, 2, 3, 0, 1, 4, 5, 0, 1, 4, 5, 0, 1,
                              6, 7, 0, 1, 6, 7};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 8, 8, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputePPForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 1);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 5.144058407759709,  3.427919368883665, -0.186409818896714,
                                 0.166404486477559, -0.706921701478079, -0.618991957258913,
                                -0.257062436901119, -0.225087984457787,  3.427919368883665,
                                 3.000000000000000, -0.032297400612418,  0.297019346658219,
                                -0.766311766435484, -0.672563816424050, -0.278658824158358,
                                -0.244568660517836, -0.186409818896714, -0.032297400612418,
                                 6.128188526493468,  2.082419686588810, -0.706921701478079,
                                -0.766311766435484, -0.257062436901119, -0.278658824158358,
                                 0.166404486477559,  0.297019346658219,  2.082419686588810,
                                 2.000000000000000, -0.618991957258913, -0.672563816424050,
                                -0.225087984457787, -0.244568660517836, -0.706921701478079,
                                -0.618991957258913,  5.144058407759709,  3.427919368883665,
                                -1.096839282921512, -0.630782125143769, -0.471281134318719,
                                -0.412661304839275, -0.766311766435484, -0.672563816424050,
                                 3.427919368883665,  3.000000000000000, -1.019214069506602,
                                -0.569161326009119, -0.510874510956989, -0.448375877616033,
                                -0.706921701478079, -0.766311766435484, -1.096839282921512,
                                -1.019214069506602,  6.128188526493468,  2.082419686588810,
                                -0.471281134318719, -0.510874510956989, -0.618991957258913,
                                -0.672563816424050, -0.630782125143769, -0.569161326009119,
                                 2.082419686588810,  2.000000000000000, -0.412661304839276,
                                -0.448375877616033, -0.257062436901119, -0.225087984457787,
                                -0.471281134318719, -0.412661304839276,  5.144058407759709,
                                 3.427919368883665,  0.027808878520885,  0.353977806859047,
                                -0.278658824158358, -0.244568660517836, -0.510874510956989,
                                -0.448375877616033,  3.427919368883665,  3.000000000000000,
                                 0.199918286186214,  0.500826563756416, -0.257062436901119,
                                -0.278658824158358, -0.471281134318719, -0.510874510956989,
                                 0.027808878520885,  0.199918286186214,  6.128188526493468,
                                 2.082419686588810, -0.225087984457787, -0.244568660517836,
                                -0.412661304839275, -0.448375877616033,  0.353977806859047,
                                 0.500826563756416,  2.082419686588810,  2.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2,
                              2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4,
                              4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6,
                              6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
                              8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11};

    std::vector<int32_t> cols{0, 1, 2, 3, 6, 7, 10, 11, 0, 1, 2, 3, 6, 7, 10, 11,
                              0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 2,
                              3, 4, 5, 6, 7, 10, 11, 2, 3, 4, 5, 6, 7, 10, 11, 0,
                              1, 4, 5, 6, 7, 8, 9, 0, 1, 4, 5, 6, 7, 8, 9, 2, 3,
                              6, 7, 8, 9, 10, 11, 2, 3, 6, 7, 8, 9, 10, 11, 0, 1,
                              4, 5, 8, 9, 10, 11, 0, 1, 4, 5, 8, 9, 10, 11};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 12, 12, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeSDForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 2);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 3.082911586456580,  2.133606523257290,  0.235118043747387,
                                 0.354112520799683,  0.646574620305315,  0.973809432199128,
                                 0.537325802318532,  0.809269213528159,  0.431049746870210,
                                 0.649206288132752, -0.097965851561411, -0.147546883666534,
                                 2.133606523257290,  1.800000000000001,  0.198794504661795,
                                 0.299534212672331,  0.546684887819936,  0.823719084848910,
                                 0.454313990587127,  0.684538960008247,  0.364456591879958,
                                 0.549146056565940, -0.082831043609081, -0.124805921946805,
                                 0.235118043747387,  0.198794504661795,  8.581248210846821,
                                 2.528100795265542,  0.354112520799683,  0.299534212672331,
                                 2.528100795265542,  2.800000000000002,  0.646574620305315,
                                 0.546684887819936,  8.581248210846820,  2.528100795265542,
                                 0.973809432199128,  0.823719084848910,  2.528100795265542,
                                 2.800000000000002,  0.537325802318532,  0.454313990587127,
                                 8.581248210846823,  2.528100795265543,  0.809269213528159,
                                 0.684538960008247,  2.528100795265543,  2.800000000000002,
                                 0.431049746870210,  0.364456591879958,  8.581248210846820,
                                 2.528100795265542,  0.649206288132752,  0.549146056565940,
                                 2.528100795265542,  2.800000000000002, -0.097965851561411,
                                -0.082831043609081,  8.581248210846818,  2.528100795265543,
                                -0.147546883666534, -0.124805921946805,  2.528100795265543,
                                 2.800000000000001};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4,
                              4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8,
                              8, 9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3,
                              4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 0, 1, 2, 3,
                              0, 1, 4, 5, 0, 1, 4, 5, 0, 1, 6, 7, 0, 1, 6, 7, 0,
                              1, 8, 9, 0, 1, 8, 9, 0, 1, 10, 11, 0, 1, 10, 11};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 12, 12, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeDSForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 0);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 3.676148028919980,  1.444559298223930,  0.291067867042784,
                                 0.394582695948803,  0.800436634367657,  1.085102413859208,
                                 0.665190440917174,  0.901757518489288,  0.533624422911771,
                                 0.723401609239472, -0.121278277934494, -0.164409456645334,
                                 1.444559298223930,  1.200000000000001,  0.146498584372701,
                                 0.199689475114887,  0.402871107024927,  0.549146056565940,
                                 0.334799780280434,  0.456359306672165,  0.268580738016618,
                                 0.366097371043960, -0.061041076821959, -0.083203947964536,
                                 0.291067867042784,  0.146498584372701,  7.209879635504452,
                                 4.632477550580943,  0.394582695948803,  0.199689475114887,
                                 4.632477550580943,  4.200000000000002,  0.800436634367657,
                                 0.402871107024927,  7.209879635504452,  4.632477550580942,
                                 1.085102413859208,  0.549146056565940,  4.632477550580942,
                                 4.200000000000002,  0.665190440917174,  0.334799780280434,
                                 7.209879635504457,  4.632477550580946,  0.901757518489288,
                                 0.456359306672165,  4.632477550580946,  4.200000000000005,
                                 0.533624422911771,  0.268580738016618,  7.209879635504452,
                                 4.632477550580942,  0.723401609239472,  0.366097371043960,
                                 4.632477550580942,  4.200000000000002, -0.121278277934494,
                                -0.061041076821959,  7.209879635504454,  4.632477550580943,
                                -0.164409456645334, -0.083203947964536,  4.632477550580943,
                                 4.200000000000003};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4,
                              4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8,
                              8, 9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3,
                              4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 0, 1, 2, 3,
                              0, 1, 4, 5, 0, 1, 4, 5, 0, 1, 6, 7, 0, 1, 6, 7, 0,
                              1, 8, 9, 0, 1, 8, 9, 0, 1, 10, 11, 0, 1, 10, 11};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 12, 12, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputePDForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 2);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 5.144058407759709,  3.427919368883665,  0.076928041119542,
                                -0.180311067576102,  0.211552113078741, -0.495855435834281,
                                 1.059703058289734,  0.909695832779701,  0.655247865505521,
                                 0.438378650530799,  0.271799858846676,  0.529508531223261,
                                 3.427919368883665,  3.000000000000000, -0.048053407944779,
                                -0.239230317328084, -0.132146871848142, -0.657883372652232,
                                 0.843332876598690,  0.889440074201839,  0.466405131557091,
                                 0.396910203082327,  0.347683144200904,  0.593383323268047,
                                 5.144058407759709,  3.427919368883665,  0.655247865505520,
                                 0.438378650530799,  1.381211801860433,  0.576401246252164,
                                 0.606824056588850, -0.330012258153969,  0.920807867906955,
                                 0.384267497501443, -0.273019943960634, -0.182657771054500,
                                 3.427919368883665,  3.000000000000000,  0.466405131557091,
                                 0.396910203082327,  0.828929801318121,  0.407912870871460,
                                 0.105469100510396, -0.540050247523336,  0.552619867545414,
                                 0.271941913914306, -0.194335471482121, -0.165379251284303,
                                 5.144058407759709,  3.427919368883665, -0.182447877186832,
                                -0.469729624332698,  0.655247865505520,  0.438378650530799,
                                 0.706468705526489,  0.606463888519801, -0.334487774842526,
                                -0.861170977943280, -0.379759865141881, -0.485847702794538,
                                 3.427919368883665,  3.000000000000000, -0.284082444443119,
                                -0.539259204665911,  0.466405131557091,  0.396910203082327,
                                 0.562221917732460,  0.592960049467893, -0.520817814812385,
                                -0.988641875220837, -0.373123651151236, -0.515864701294554,
                                 0.076928041119542, -0.048053407944779,  0.655247865505520,
                                 0.466405131557091, -0.182447877186832, -0.284082444443119,
                                 8.581248210846821,  2.528100795265542, -0.180311067576102,
                                -0.239230317328084,  0.438378650530799,  0.396910203082327,
                                -0.469729624332698, -0.539259204665911,  2.528100795265542,
                                 2.800000000000002,  0.211552113078741, -0.132146871848142,
                                 1.381211801860433,  0.828929801318121,  0.655247865505520,
                                 0.466405131557091,  8.581248210846820,  2.528100795265542,
                                -0.495855435834281, -0.657883372652232,  0.576401246252164,
                                 0.407912870871460,  0.438378650530799,  0.396910203082327,
                                 2.528100795265542,  2.800000000000002,  1.059703058289734,
                                 0.843332876598690,  0.606824056588850,  0.105469100510396,
                                 0.706468705526489,  0.562221917732460,  8.581248210846823,
                                 2.528100795265543,  0.909695832779701,  0.889440074201839,
                                -0.330012258153969, -0.540050247523336,  0.606463888519801,
                                 0.592960049467893,  2.528100795265543,  2.800000000000002,
                                 0.655247865505521,  0.466405131557091,  0.920807867906955,
                                 0.552619867545414, -0.334487774842526, -0.520817814812385,
                                 8.581248210846820,  2.528100795265542,  0.438378650530799,
                                 0.396910203082327,  0.384267497501443,  0.271941913914306,
                                -0.861170977943280, -0.988641875220837,  2.528100795265542,
                                 2.800000000000002,  0.271799858846676,  0.347683144200904,
                                -0.273019943960634, -0.194335471482121, -0.379759865141881,
                                -0.373123651151236,  8.581248210846818,  2.528100795265543,
                                 0.529508531223261,  0.593383323268047, -0.182657771054500,
                                -0.165379251284303, -0.485847702794538, -0.515864701294554,
                                 2.528100795265543,  2.800000000000001};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7,
                              7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9,
                              9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11,
                              11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12,
                              13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14,
                              14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 6,
                              7, 8, 9, 10, 11, 12, 13, 14, 15, 2, 3, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 2, 3, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
                              0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0,
                              1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1,
                              2, 3, 4, 5, 10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1,
                              2, 3, 4, 5, 12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1,
                              2, 3, 4, 5, 14, 15, 0, 1, 2, 3, 4, 5, 14, 15};

    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 16, 16, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeDPForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 1);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 6.128188526493468,  2.082419686588810, -0.076429092700509,
                                 0.064454913997238, -0.210180004926400,  0.177251013492403,
                                -1.164698772896484, -1.188771806324358, -0.716078533784018,
                                -0.659103473520518, -0.308493676367065, -0.486152605348889,
                                 2.082419686588810,  2.000000000000000,  0.119661470966833,
                                 0.195330736152636,  0.329069045158791,  0.537159524419748,
                                -0.586805907971002, -0.726224779525905, -0.281091292937656,
                                -0.324075823752049, -0.345591606822501, -0.484495454627892,
                                 6.128188526493468,  2.082419686588810, -0.716078533784018,
                                -0.659103473520518, -1.497977170224434, -1.176585702850599,
                                -0.638896926826138, -0.160006161825406, -0.998651446816290,
                                -0.784390468567066,  0.298366055743341,  0.274626447300216,
                                 2.082419686588810,  2.000000000000000, -0.281091292937656,
                                -0.324075823752049, -0.363525063997494, -0.333059464382960,
                                 0.224450075532904,  0.440949180631976, -0.242350042664996,
                                -0.222039642921973,  0.117121372057357,  0.135031593230021,
                                 6.128188526493468,  2.082419686588810,  0.210846603578335,
                                 0.396274858959728, -0.716078533784018, -0.659103473520518,
                                -0.776465848597656, -0.792514537549572,  0.386552106560281,
                                 0.726503908092835,  0.422655945997442,  0.523830062208507,
                                 2.082419686588810,  2.000000000000000,  0.307260975967366,
                                 0.440303296843521, -0.281091292937656, -0.324075823752049,
                                -0.391203938647334, -0.484149853017270,  0.563311789273504,
                                 0.807222710879789,  0.315573584226411,  0.421201764828306,
                                -0.076429092700509,  0.119661470966833, -0.716078533784018,
                                -0.281091292937656,  0.210846603578335,  0.307260975967366,
                                 7.209879635504452,  4.632477550580943,  0.064454913997238,
                                 0.195330736152636, -0.659103473520518, -0.324075823752049,
                                 0.396274858959728,  0.440303296843521,  4.632477550580943,
                                 4.200000000000002, -0.210180004926400,  0.329069045158791,
                                -1.497977170224434, -0.363525063997494, -0.716078533784018,
                                -0.281091292937656,  7.209879635504452,  4.632477550580942,
                                 0.177251013492403,  0.537159524419748, -1.176585702850599,
                                -0.333059464382960, -0.659103473520518, -0.324075823752049,
                                 4.632477550580942,  4.200000000000002, -1.164698772896484,
                                -0.586805907971002, -0.638896926826138,  0.224450075532904,
                                -0.776465848597656, -0.391203938647334,  7.209879635504457,
                                 4.632477550580946, -1.188771806324358, -0.726224779525905,
                                -0.160006161825406,  0.440949180631976, -0.792514537549572,
                                -0.484149853017270,  4.632477550580946,  4.200000000000005,
                                -0.716078533784018, -0.281091292937656, -0.998651446816290,
                                -0.242350042664996,  0.386552106560281,  0.563311789273504,
                                 7.209879635504452,  4.632477550580942, -0.659103473520518,
                                -0.324075823752049, -0.784390468567066, -0.222039642921973,
                                 0.726503908092835,  0.807222710879789,  4.632477550580942,
                                 4.200000000000002, -0.308493676367065, -0.345591606822501,
                                 0.298366055743341,  0.117121372057357,  0.422655945997442,
                                 0.315573584226411,  7.209879635504454,  4.632477550580943,
                                -0.486152605348889, -0.484495454627892,  0.274626447300216,
                                 0.135031593230021,  0.523830062208507,  0.421201764828306,
                                 4.632477550580943,  4.200000000000003};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7,
                              7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9,
                              9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11,
                              11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12,
                              13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14,
                              14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 6,
                              7, 8, 9, 10, 11, 12, 13, 14, 15, 2, 3, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 2, 3, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
                              0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0,
                              1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1,
                              2, 3, 4, 5, 10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1,
                              2, 3, 4, 5, 12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1,
                              2, 3, 4, 5, 14, 15, 0, 1, 2, 3, 4, 5, 14, 15};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 16, 16, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeDDForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 2);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 7.209879635504452,  4.632477550580943, -0.087112104520447,
                                 0.243227572780129,  0.081315576299682, -0.250900117687152,
                                 1.193212491114567,  0.556672378020490, -0.587893047610209,
                                -0.603752327688591, -0.129066620374497, -0.041345845665066,
                                 4.632477550580943,  4.200000000000002,  0.047467171052133,
                                 0.422945664975468, -0.171047873835683, -0.338305935522482,
                                 0.894506190578171,  0.601046443433662, -0.705375923969121,
                                -0.728770326302365, -0.081600747857381, -0.040238440548844,
                                -0.087112104520447,  0.047467171052133,  8.581248210846821,
                                 2.528100795265542,  0.081315576299682, -0.171047873835683,
                                 1.193212491114568,  0.894506190578171, -0.587893047610209,
                                -0.705375923969121, -0.129066620374497, -0.081600747857381,
                                 0.243227572780129,  0.422945664975468,  2.528100795265542,
                                 2.800000000000002, -0.250900117687152, -0.338305935522482,
                                 0.556672378020490,  0.601046443433662, -0.603752327688591,
                                -0.728770326302365, -0.041345845665066, -0.040238440548844,
                                 0.081315576299682, -0.250900117687152,  7.209879635504452,
                                 4.632477550580942,  0.106936429831066, -0.355511344427847,
                                 1.279453968868407,  0.170021669167033,  1.141420223892138,
                                 0.214585078505523,  0.800852971228128,  0.671972973035949,
                                -0.171047873835683, -0.338305935522482,  4.632477550580942,
                                 4.200000000000002, -0.360715255146657, -0.384375317521363,
                                 0.616263863951368,  0.083952384067400,  0.600307516513730,
                                 0.157496234380185,  0.840017157933799,  0.795163753207958,
                                 0.081315576299682, -0.171047873835683,  0.106936429831066,
                                -0.360715255146657,  8.581248210846820,  2.528100795265542,
                                 1.279453968868407,  0.616263863951367,  1.141420223892138,
                                 0.600307516513729,  0.800852971228128,  0.840017157933799,
                                -0.250900117687152, -0.338305935522482, -0.355511344427847,
                                -0.384375317521363,  2.528100795265542,  2.800000000000002,
                                 0.170021669167033,  0.083952384067400,  0.214585078505523,
                                 0.157496234380185,  0.671972973035950,  0.795163753207958,
                                 1.193212491114568,  0.556672378020490,  1.279453968868407,
                                 0.170021669167033,  7.209879635504457,  4.632477550580946,
                                -0.997233250571177, -0.845603051582035,  0.852969312578938,
                                 0.113347779444689, -0.497171871297736, -0.231946824175204,
                                 0.894506190578171,  0.601046443433662,  0.616263863951367,
                                 0.083952384067400,  4.632477550580946,  4.200000000000005,
                                -1.168356671468558, -0.907690314338746,  0.410842575967578,
                                 0.055968256044934, -0.372710912740905, -0.250436018097359,
                                 1.193212491114567,  0.894506190578171,  1.279453968868407,
                                 0.616263863951368, -0.997233250571177, -1.168356671468558,
                                 8.581248210846823,  2.528100795265543,  0.852969312578939,
                                 0.410842575967578, -0.497171871297736, -0.372710912740905,
                                 0.556672378020490,  0.601046443433662,  0.170021669167033,
                                 0.083952384067400, -0.845603051582035, -0.907690314338746,
                                 2.528100795265543,  2.800000000000002,  0.113347779444689,
                                 0.055968256044934, -0.231946824175204, -0.250436018097360,
                                -0.587893047610209, -0.603752327688591,  1.141420223892138,
                                 0.214585078505523,  0.852969312578939,  0.113347779444689,
                                 7.209879635504452,  4.632477550580942, -0.844247090079049,
                                -0.534332243182450, -1.007146255525239, -0.599583416129208,
                                -0.705375923969121, -0.728770326302365,  0.600307516513729,
                                 0.157496234380185,  0.410842575967578,  0.055968256044934,
                                 4.632477550580942,  4.200000000000002, -0.860971518908098,
                                -0.515622179504850, -0.859214180766263, -0.677650117484400,
                                -0.587893047610209, -0.705375923969121,  1.141420223892138,
                                 0.600307516513730,  0.852969312578938,  0.410842575967578,
                                -0.844247090079049, -0.860971518908098,  8.581248210846820,
                                 2.528100795265542, -1.007146255525239, -0.859214180766263,
                                -0.603752327688591, -0.728770326302365,  0.214585078505523,
                                 0.157496234380185,  0.113347779444689,  0.055968256044934,
                                -0.534332243182450, -0.515622179504850,  2.528100795265542,
                                 2.800000000000002, -0.599583416129208, -0.677650117484400,
                                -0.129066620374497, -0.041345845665066,  0.800852971228128,
                                 0.671972973035950, -0.497171871297736, -0.231946824175204,
                                -1.007146255525239, -0.599583416129208,  7.209879635504454,
                                 4.632477550580943, -0.343094234929865,  0.161224978877748,
                                -0.081600747857381, -0.040238440548844,  0.840017157933799,
                                 0.795163753207958, -0.372710912740905, -0.250436018097360,
                                -0.859214180766263, -0.677650117484400,  4.632477550580943,
                                 4.200000000000003, -0.114374312198339,  0.343139424553594,
                                -0.129066620374497, -0.081600747857381,  0.800852971228128,
                                 0.840017157933799, -0.497171871297736, -0.372710912740905,
                                -1.007146255525239, -0.859214180766263, -0.343094234929865,
                                -0.114374312198339,  8.581248210846818,  2.528100795265543,
                                -0.041345845665066, -0.040238440548844,  0.671972973035949,
                                 0.795163753207958, -0.231946824175204, -0.250436018097359,
                                -0.599583416129208, -0.677650117484400,  0.161224978877748,
                                 0.343139424553594,  2.528100795265543,  2.800000000000001};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7,
                              7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
                              9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13,
                              13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14,
                              14, 14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17,
                              17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18,
                              18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 0, 1, 2,
                              3, 6, 7, 10, 11, 14, 15, 18, 19, 0, 1, 2, 3, 4, 5,
                              8, 9, 12, 13, 16, 17, 0, 1, 2, 3, 4, 5, 8, 9, 12,
                              13, 16, 17, 2, 3, 4, 5, 6, 7, 10, 11, 14, 15, 18,
                              19, 2, 3, 4, 5, 6, 7, 10, 11, 14, 15, 18, 19, 0, 1,
                              4, 5, 6, 7, 8, 9, 12, 13, 16, 17, 0, 1, 4, 5, 6, 7,
                              8, 9, 12, 13, 16, 17, 2, 3, 6, 7, 8, 9, 10, 11, 14,
                              15, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11, 14, 15, 18,
                              19, 0, 1, 4, 5, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1,
                              4, 5, 8, 9, 10, 11, 12, 13, 16, 17, 2, 3, 6, 7, 10,
                              11, 12, 13, 14, 15, 18, 19, 2, 3, 6, 7, 10, 11, 12,
                              13, 14, 15, 18, 19, 0, 1, 4, 5, 8, 9, 12, 13, 14,
                              15, 16, 17, 0, 1, 4, 5, 8, 9, 12, 13, 14, 15, 16,
                              17, 2, 3, 6, 7, 10, 11, 14, 15, 16, 17, 18, 19, 2,
                              3, 6, 7, 10, 11, 14, 15, 16, 17, 18, 19, 0, 1, 4,
                              5, 8, 9, 12, 13, 16, 17, 18, 19, 0, 1, 4, 5, 8, 9,
                              12, 13, 16, 17, 18, 19};

    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeSFForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 3);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 3.082911586456580,  2.133606523257290, -0.034537787101234,
                                -0.038983294811130, -0.620399671781271, -0.700253992384881,
                                -0.963102774657130, -1.087067891403374, -0.287000824062391,
                                -0.323941939379838, -0.642068516438087, -0.724711927602249,
                                 0.258499863242196,  0.291772496827034,  0.176526467406305,
                                 0.199247951256889,  2.133606523257290,  1.800000000000001,
                                -0.018559870863921, -0.027062059301068, -0.333389564262736,
                                -0.486113735628074, -0.517550909498831, -0.754638515907212,
                                -0.154228127494788, -0.224879298070441, -0.345033939665887,
                                -0.503092343938142,  0.138912318442807,  0.202547389845031,
                                 0.094861562193374,  0.138317191983235, -0.034537787101234,
                                -0.018559870863921,  11.035325809057101,  2.825783659608886,
                                -0.038983294811130, -0.027062059301068,  2.825783659608886,
                                 3.600000000000001, -0.620399671781271, -0.333389564262736,
                                 11.035325809057095,  2.825783659608886, -0.700253992384881,
                                -0.486113735628074,  2.825783659608886,  3.600000000000000,
                                -0.963102774657130, -0.517550909498831,  11.035325809057101,
                                 2.825783659608886, -1.087067891403374, -0.754638515907212,
                                 2.825783659608886,  3.600000000000000, -0.287000824062391,
                                -0.154228127494788,  11.035325809057099,  2.825783659608884,
                                -0.323941939379838, -0.224879298070441,  2.825783659608884,
                                 3.600000000000000, -0.642068516438087, -0.345033939665887,
                                 11.035325809057101,  2.825783659608886, -0.724711927602249,
                                -0.503092343938142,  2.825783659608886,  3.600000000000001,
                                 0.258499863242196,  0.138912318442807,  11.035325809057099,
                                 2.825783659608885,  0.291772496827034,  0.202547389845031,
                                 2.825783659608885,  3.599999999999999,  0.176526467406305,
                                 0.094861562193374,  11.035325809057101,  2.825783659608886,
                                 0.199247951256889,  0.138317191983235,  2.825783659608886,
                                 3.600000000000001};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6,
                              6, 7, 7, 7, 7, 8, 8, 8, 8, 9, 9, 9, 9, 10, 10, 10,
                              10, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13,
                              14, 14, 14, 14, 15, 15, 15, 15};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                              15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 4, 5, 0, 1,
                              4, 5, 0, 1, 6, 7, 0, 1, 6, 7, 0, 1, 8, 9, 0, 1, 8,
                              9, 0, 1, 10, 11, 0, 1, 10, 11, 0, 1, 12, 13, 0, 1,
                              12, 13, 0, 1, 14, 15, 0, 1, 14, 15};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 16, 16, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeFSForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 0);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 3.676148028919980,  1.444559298223930,  0.045085048479009,
                                 0.052384005216496,  0.809859334549570,  0.940969945400524,
                                 1.257218221839514,  1.460753134640151,  0.374646066015799,
                                 0.435298666378253,  0.838145481226343,  0.973835423093434,
                                -0.337441389395654, -0.392070810583552, -0.230434692226044,
                                -0.267740471106536,  1.444559298223930,  1.200000000000001,
                                 0.010269968567482,  0.014730719261457,  0.184478672874856,
                                 0.264606802054885,  0.286383004041110,  0.410773178716408,
                                 0.085341004428652,  0.122408785330628,  0.190922002694073,
                                 0.273848785810939, -0.076866113697857, -0.110252834189535,
                                -0.052490950456020, -0.075290342891890,  0.045085048479009,
                                 0.010269968567482,  9.280343182967972,  5.757046560354534,
                                 0.052384005216496,  0.014730719261457,  5.757046560354534,
                                 5.400000000000003,  0.809859334549570,  0.184478672874856,
                                 9.280343182967970,  5.757046560354532,  0.940969945400524,
                                 0.264606802054885,  5.757046560354532,  5.400000000000002,
                                 1.257218221839514,  0.286383004041110,  9.280343182967972,
                                 5.757046560354533,  1.460753134640151,  0.410773178716408,
                                 5.757046560354533,  5.400000000000003,  0.374646066015799,
                                 0.085341004428652,  9.280343182967972,  5.757046560354533,
                                 0.435298666378253,  0.122408785330628,  5.757046560354533,
                                 5.400000000000001,  0.838145481226343,  0.190922002694073,
                                 9.280343182967972,  5.757046560354533,  0.973835423093434,
                                 0.273848785810939,  5.757046560354533,  5.400000000000004,
                                -0.337441389395654, -0.076866113697857,  9.280343182967970,
                                 5.757046560354533, -0.392070810583552, -0.110252834189535,
                                 5.757046560354533,  5.400000000000003, -0.230434692226044,
                                -0.052490950456020,  9.280343182967972,  5.757046560354534,
                                -0.267740471106536, -0.075290342891890,  5.757046560354534,
                                 5.400000000000003};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6,
                              6, 7, 7, 7, 7, 8, 8, 8, 8, 9, 9, 9, 9, 10, 10, 10,
                              10, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13,
                              14, 14, 14, 14, 15, 15, 15, 15};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                              15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 4, 5, 0, 1,
                              4, 5, 0, 1, 6, 7, 0, 1, 6, 7, 0, 1, 8, 9, 0, 1, 8,
                              9, 0, 1, 10, 11, 0, 1, 10, 11, 0, 1, 12, 13, 0, 1,
                              12, 13, 0, 1, 14, 15, 0, 1, 14, 15};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 16, 16, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputePFForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 3);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 5.144058407759709,  3.427919368883665, -0.242976459340248,
                                -0.251415342325989, -0.090714546142467,  0.385067429514683,
                                -0.325121397861121,  0.386424802562345, -1.199111870151905,
                                -1.148872406394528, -0.953935463952880, -0.587784873643170,
                                -0.733870232345608, -1.045387679806769, -0.247363093720430,
                                -0.422840480153797,  3.427919368883665,  3.000000000000000,
                                -0.162463490494969, -0.223975358409998,  0.125096953734672,
                                 0.414338459492493,  0.062961261051882,  0.451857577434255,
                                -0.766135033157035, -1.009803153551003, -0.482978247798420,
                                -0.464192240830129, -0.601629471969480, -0.973872728657933,
                                -0.230122733320384, -0.401534931128901,  5.144058407759709,
                                 3.427919368883665, -0.081958235850396, -0.044070704638632,
                                -1.083677506043320, -0.346073087683646, -0.933933667710672,
                                 0.320969825717130,  0.510229410179235,  0.999937040271589,
                                -0.622622445140448,  0.213979883811420,  0.451532294184717,
                                 0.144197119868186,  0.418897649902021,  0.225250268153009,
                                 3.427919368883665,  3.000000000000000, -0.039001910115598,
                                -0.033196713452796, -0.423914158329830, -0.192892705320619,
                                -0.125174214745012,  0.477583188477414,  0.524217464972479,
                                 0.961065918503300, -0.083449476496675,  0.318388792318276,
                                 0.176630899304095,  0.080371960550258,  0.199343096146390,
                                 0.169672090980959,  5.144058407759709,  3.427919368883665,
                                 0.446049726085025,  0.529678552005026,  0.533114374293460,
                                 0.937436940837213, -0.953935463952880, -0.587784873643170,
                                -0.799407913434603, -0.765914937596352,  0.469824822099612,
                                 0.876245530598321,  0.935370950568512,  0.936815650914638,
                                -0.045945548912025, -0.145467587740187,  3.427919368883665,
                                 3.000000000000000,  0.324672818449106,  0.482011812226589,
                                 0.506094693192371,  0.892557719561196, -0.482978247798420,
                                -0.464192240830129, -0.510756688771357, -0.673202102367335,
                                 0.465443134217231,  0.838684444792696,  0.613385823039895,
                                 0.829948505986926, -0.068701322742319, -0.144169117988124,
                                -0.242976459340248, -0.162463490494969, -0.081958235850396,
                                -0.039001910115598,  0.446049726085025,  0.324672818449106,
                                 11.035325809057101,  2.825783659608886, -0.251415342325989,
                                -0.223975358409998, -0.044070704638632, -0.033196713452796,
                                 0.529678552005026,  0.482011812226589,  2.825783659608886,
                                 3.600000000000001, -0.090714546142467,  0.125096953734672,
                                -1.083677506043320, -0.423914158329830,  0.533114374293460,
                                 0.506094693192371,  11.035325809057095,  2.825783659608886,
                                 0.385067429514683,  0.414338459492493, -0.346073087683646,
                                -0.192892705320619,  0.937436940837213,  0.892557719561196,
                                 2.825783659608886,  3.600000000000000, -0.325121397861121,
                                 0.062961261051882, -0.933933667710672, -0.125174214745012,
                                -0.953935463952880, -0.482978247798420,  11.035325809057101,
                                 2.825783659608886,  0.386424802562345,  0.451857577434255,
                                 0.320969825717130,  0.477583188477414, -0.587784873643170,
                                -0.464192240830129,  2.825783659608886,  3.600000000000000,
                                -1.199111870151905, -0.766135033157035,  0.510229410179235,
                                 0.524217464972479, -0.799407913434603, -0.510756688771357,
                                 11.035325809057099,  2.825783659608884, -1.148872406394528,
                                -1.009803153551003,  0.999937040271589,  0.961065918503300,
                                -0.765914937596352, -0.673202102367335,  2.825783659608884,
                                 3.600000000000000, -0.953935463952880, -0.482978247798420,
                                -0.622622445140448, -0.083449476496675,  0.469824822099612,
                                 0.465443134217231,  11.035325809057101,  2.825783659608886,
                                -0.587784873643170, -0.464192240830129,  0.213979883811420,
                                 0.318388792318276,  0.876245530598321,  0.838684444792696,
                                 2.825783659608886,  3.600000000000001, -0.733870232345608,
                                -0.601629471969480,  0.451532294184717,  0.176630899304095,
                                 0.935370950568512,  0.613385823039895,  11.035325809057099,
                                 2.825783659608885, -1.045387679806769, -0.973872728657933,
                                 0.144197119868186,  0.080371960550258,  0.936815650914638,
                                 0.829948505986926,  2.825783659608885,  3.599999999999999,
                                -0.247363093720430, -0.230122733320384,  0.418897649902021,
                                 0.199343096146390, -0.045945548912025, -0.068701322742319,
                                 11.035325809057101,  2.825783659608886, -0.422840480153797,
                                -0.401534931128901,  0.225250268153009,  0.169672090980959,
                                -0.145467587740187, -0.144169117988124,  2.825783659608886,
                                 3.600000000000001};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8,
                              8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10,
                              10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15,
                              15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17,
                              17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
                              16, 17, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2,
                              3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3,
                              4, 5, 10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1, 2, 3,
                              4, 5, 12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1, 2, 3,
                              4, 5, 14, 15, 0, 1, 2, 3, 4, 5, 14, 15, 0, 1, 2, 3,
                              4, 5, 16, 17, 0, 1, 2, 3, 4, 5, 16, 17, 0, 1, 2, 3,
                              4, 5, 18, 19, 0, 1, 2, 3, 4, 5, 18, 19};

    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeFPForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 1);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 6.128188526493468,  2.082419686588810, -0.292073129776358,
                                -0.321816649806489, -0.071596106664871,  0.235995729395778,
                                -0.334296649451712,  0.106902905913251, -1.434223863992260,
                                -1.519867083952294, -1.115470466857818, -0.966550217496618,
                                -0.904523708341416, -1.184691721114804, -0.310395248342638,
                                -0.451726928755729,  2.082419686588810,  2.000000000000000,
                                -0.105516527355853, -0.149316905606665,  0.167148820752362,
                                 0.276225639661662,  0.170539763395736,  0.301238384956170,
                                -0.481107510663364, -0.673202102367335, -0.242068971423131,
                                -0.309461493886753, -0.442047362001861, -0.649248485771955,
                                -0.179392338992542, -0.267689954085934,  6.128188526493468,
                                 2.082419686588810, -0.095333939962874, -0.078261020826441,
                                -1.242031705856242, -0.858818284620437, -1.021988289527727,
                                -0.279678298985150,  0.650233569220785,  1.026766849726576,
                                -0.681325526351819, -0.186452199323433,  0.517513210773434,
                                 0.357840951925182,  0.487262359810244,  0.400000773112922,
                                 2.082419686588810,  2.000000000000000, -0.018024865235427,
                                -0.022131142301864, -0.136276183425034, -0.128595136880413,
                                 0.149598582174550,  0.318388792318276,  0.425123158778909,
                                 0.640710612335533,  0.099732388116367,  0.212259194878851,
                                 0.056781743093764,  0.053581307033505,  0.092127088981071,
                                 0.113114727320639,  6.128188526493468,  2.082419686588810,
                                 0.541507830070817,  0.641450615607708,  0.671004200263249,
                                 0.992992153340695, -1.115470466857818, -0.966550217496618,
                                -0.956149242661507, -1.013244722634863,  0.595262072929803,
                                 0.912361420493766,  1.121948045734648,  1.215793520241221,
                                -0.062886486229248, -0.133673993678276,  2.082419686588810,
                                 2.000000000000000,  0.223088981987516,  0.321341208151060,
                                 0.397895639492634,  0.595038479707464, -0.242068971423131,
                                -0.309461493886753, -0.320738340442243, -0.448801401578224,
                                 0.372263906248345,  0.559122963195131,  0.392813180243968,
                                 0.553299003991285, -0.062184023052504, -0.096112745325415,
                                -0.292073129776358, -0.105516527355853, -0.095333939962874,
                                -0.018024865235427,  0.541507830070817,  0.223088981987516,
                                 9.280343182967972,  5.757046560354534, -0.321816649806489,
                                -0.149316905606665, -0.078261020826441, -0.022131142301864,
                                 0.641450615607708,  0.321341208151060,  5.757046560354534,
                                 5.400000000000003, -0.071596106664871,  0.167148820752362,
                                -1.242031705856242, -0.136276183425034,  0.671004200263249,
                                 0.397895639492634,  9.280343182967970,  5.757046560354532,
                                 0.235995729395778,  0.276225639661662, -0.858818284620437,
                                -0.128595136880413,  0.992992153340695,  0.595038479707464,
                                 5.757046560354532,  5.400000000000002, -0.334296649451712,
                                 0.170539763395736, -1.021988289527727,  0.149598582174550,
                                -1.115470466857818, -0.242068971423131,  9.280343182967972,
                                 5.757046560354533,  0.106902905913251,  0.301238384956170,
                                -0.279678298985150,  0.318388792318276, -0.966550217496618,
                                -0.309461493886753,  5.757046560354533,  5.400000000000003,
                                -1.434223863992260, -0.481107510663364,  0.650233569220785,
                                 0.425123158778909, -0.956149242661507, -0.320738340442243,
                                 9.280343182967972,  5.757046560354533, -1.519867083952294,
                                -0.673202102367335,  1.026766849726576,  0.640710612335533,
                                -1.013244722634863, -0.448801401578224,  5.757046560354533,
                                 5.400000000000001, -1.115470466857818, -0.242068971423131,
                                -0.681325526351819,  0.099732388116367,  0.595262072929803,
                                 0.372263906248345,  9.280343182967972,  5.757046560354533,
                                -0.966550217496618, -0.309461493886753, -0.186452199323433,
                                 0.212259194878851,  0.912361420493766,  0.559122963195131,
                                 5.757046560354533,  5.400000000000004, -0.904523708341416,
                                -0.442047362001861,  0.517513210773434,  0.056781743093764,
                                 1.121948045734648,  0.392813180243968,  9.280343182967970,
                                 5.757046560354533, -1.184691721114804, -0.649248485771955,
                                 0.357840951925182,  0.053581307033505,  1.215793520241221,
                                 0.553299003991285,  5.757046560354533,  5.400000000000003,
                                -0.310395248342638, -0.179392338992542,  0.487262359810244,
                                 0.092127088981071, -0.062886486229248, -0.062184023052504,
                                 9.280343182967972,  5.757046560354534, -0.451726928755729,
                                -0.267689954085934,  0.400000773112922,  0.113114727320639,
                                -0.133673993678276, -0.096112745325415,  5.757046560354534,
                                 5.400000000000003};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8,
                              8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10,
                              10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15,
                              15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17,
                              17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
                              16, 17, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2,
                              3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3,
                              4, 5, 10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1, 2, 3,
                              4, 5, 12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1, 2, 3,
                              4, 5, 14, 15, 0, 1, 2, 3, 4, 5, 14, 15, 0, 1, 2, 3,
                              4, 5, 16, 17, 0, 1, 2, 3, 4, 5, 16, 17, 0, 1, 2, 3,
                              4, 5, 18, 19, 0, 1, 2, 3, 4, 5, 18, 19};

    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeDFForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 3);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 7.209879635504452,  4.632477550580943, -0.153817279984697,
                                -0.416114375744645,  0.082755358961476, -0.531674519950922,
                                -0.223430111997173,  0.256239661229247, -1.715461190220041,
                                -0.866099720234127,  0.760658328607809,  0.749657138165788,
                                 0.268208228644994,  0.070574368211557,  0.360129752779279,
                                 0.658221949730436,  4.632477550580943,  4.200000000000002,
                                -0.250415454614259, -0.520669276626053, -0.174115364326311,
                                -0.754116653312306,  0.105446218507712,  0.320624450510346,
                                -1.028494447133863, -0.830685893197768,  0.682654148226239,
                                 0.802287970065999,  0.115094180135745,  0.057681003228608,
                                 0.431153275528284,  0.808833571528549,  7.209879635504452,
                                 4.632477550580942, -0.565535877161667, -0.285416694935560,
                                -0.050152729613471,  0.211421219699531, -0.430416580110264,
                                -0.404173272976370, -0.706965959388581,  0.170337510080139,
                                -0.963852465682165,  0.000333193792446, -1.301713194262859,
                                -0.521269167405446, -0.617096181559221, -0.490231859276302,
                                 4.632477550580942,  4.200000000000002, -0.338985884778120,
                                -0.273729309324451,  0.202473890218585,  0.182709949047196,
                                -0.161427648563263, -0.613397893119081, -0.128429245290612,
                                 0.310527306516438, -0.234582767623359,  0.075481192391577,
                                -0.783076044655854, -0.394062459433993, -0.495933988036046,
                                -0.497764706686921,  7.209879635504457,  4.632477550580946,
                                -0.170133323944114, -0.070579429543383, -1.471075883567071,
                                -0.387088239605887,  0.018589968396430,  0.220691559513385,
                                 1.760589880772259,  0.149717093924657,  0.012393312264287,
                                 0.147127706342257,  0.612948284819612,  0.161286766502453,
                                 0.869570322381028,  0.360739306555068,  4.632477550580946,
                                 4.200000000000005, -0.091204341158676, -0.065329328384069,
                                -0.631271730893551, -0.316370356041063,  0.267979500324089,
                                 0.151267243952080,  0.776677826549307, -0.179346746821252,
                                 0.178653000216059,  0.100844829301386,  0.263029887872313,
                                 0.131820981683776,  0.466155521477678,  0.333905456185240,
                                 7.209879635504452,  4.632477550580942,  1.055078384889860,
                                 0.605479319968044,  0.983957281489844,  0.474160550977103,
                                -0.963852465682165,  0.000333193792446, -0.471310639592387,
                                 0.113558340053426,  0.372793807958207, -0.404450934470076,
                                 1.573933046781940,  0.452198592555502, -0.131203525525450,
                                -0.171129629749584,  4.632477550580942,  4.200000000000002,
                                 0.683881997167077,  0.591957390528200,  0.672453304041705,
                                 0.366370720388639, -0.234582767623359,  0.075481192391577,
                                -0.085619496860408,  0.207018204344292,  0.034057991122869,
                                -0.676298886778729,  0.767879008913122,  0.324245504167892,
                                -0.152604109056514, -0.180321564515183,  7.209879635504454,
                                 4.632477550580943, -0.162042347182013, -0.606098666372126,
                                 0.268208228644994,  0.070574368211557, -1.089399377588880,
                                -0.859246432062364,  0.714775495925017,  0.360874883430886,
                                 1.456801916128300,  0.816362718922855,  0.614701679107380,
                                -0.391702022998000, -0.194297453322832, -0.426766034990397,
                                 4.632477550580943,  4.200000000000003, -0.346149516853113,
                                -0.766232789518516,  0.115094180135745,  0.057681003228608,
                                -0.839999594365640, -0.898693358356144,  0.428539352972443,
                                 0.346119122165737,  0.909656276553541,  0.813363101771082,
                                 0.054154759609583, -0.639715996908900, -0.267786406973339,
                                -0.529374964071990, -0.153817279984697, -0.250415454614259,
                                -0.565535877161667, -0.338985884778120, -0.170133323944114,
                                -0.091204341158676,  1.055078384889860,  0.683881997167077,
                                -0.162042347182013, -0.346149516853113,  11.035325809057101,
                                 2.825783659608886, -0.416114375744645, -0.520669276626053,
                                -0.285416694935560, -0.273729309324451, -0.070579429543383,
                                -0.065329328384069,  0.605479319968044,  0.591957390528200,
                                -0.606098666372126, -0.766232789518516,  2.825783659608886,
                                 3.600000000000001,  0.082755358961476, -0.174115364326311,
                                -0.050152729613471,  0.202473890218585, -1.471075883567071,
                                -0.631271730893551,  0.983957281489844,  0.672453304041705,
                                 0.268208228644994,  0.115094180135745,  11.035325809057095,
                                 2.825783659608886, -0.531674519950922, -0.754116653312306,
                                 0.211421219699531,  0.182709949047196, -0.387088239605887,
                                -0.316370356041063,  0.474160550977103,  0.366370720388639,
                                 0.070574368211557,  0.057681003228608,  2.825783659608886,
                                 3.600000000000000, -0.223430111997173,  0.105446218507712,
                                -0.430416580110264, -0.161427648563263,  0.018589968396430,
                                 0.267979500324089, -0.963852465682165, -0.234582767623359,
                                -1.089399377588880, -0.839999594365640,  11.035325809057101,
                                 2.825783659608886,  0.256239661229247,  0.320624450510346,
                                -0.404173272976370, -0.613397893119081,  0.220691559513385,
                                 0.151267243952080,  0.000333193792446,  0.075481192391577,
                                -0.859246432062364, -0.898693358356144,  2.825783659608886,
                                 3.600000000000000, -1.715461190220041, -1.028494447133863,
                                -0.706965959388581, -0.128429245290612,  1.760589880772259,
                                 0.776677826549307, -0.471310639592387, -0.085619496860408,
                                 0.714775495925017,  0.428539352972443,  11.035325809057099,
                                 2.825783659608884, -0.866099720234127, -0.830685893197768,
                                 0.170337510080139,  0.310527306516438,  0.149717093924657,
                                -0.179346746821252,  0.113558340053426,  0.207018204344292,
                                 0.360874883430886,  0.346119122165737,  2.825783659608884,
                                 3.600000000000000,  0.760658328607809,  0.682654148226239,
                                -0.963852465682165, -0.234582767623359,  0.012393312264287,
                                 0.178653000216059,  0.372793807958207,  0.034057991122869,
                                 1.456801916128300,  0.909656276553541,  11.035325809057101,
                                 2.825783659608886,  0.749657138165788,  0.802287970065999,
                                 0.000333193792446,  0.075481192391577,  0.147127706342257,
                                 0.100844829301386, -0.404450934470076, -0.676298886778729,
                                 0.816362718922855,  0.813363101771082,  2.825783659608886,
                                 3.600000000000001,  0.268208228644994,  0.115094180135745,
                                -1.301713194262859, -0.783076044655854,  0.612948284819612,
                                 0.263029887872313,  1.573933046781940,  0.767879008913122,
                                 0.614701679107380,  0.054154759609583,  11.035325809057099,
                                 2.825783659608885,  0.070574368211557,  0.057681003228608,
                                -0.521269167405446, -0.394062459433993,  0.161286766502453,
                                 0.131820981683776,  0.452198592555502,  0.324245504167892,
                                -0.391702022998000, -0.639715996908900,  2.825783659608885,
                                 3.599999999999999,  0.360129752779279,  0.431153275528284,
                                -0.617096181559221, -0.495933988036046,  0.869570322381028,
                                 0.466155521477678, -0.131203525525450, -0.152604109056514,
                                -0.194297453322832, -0.267786406973339,  11.035325809057101,
                                 2.825783659608886,  0.658221949730436,  0.808833571528549,
                                -0.490231859276302, -0.497764706686921,  0.360739306555068,
                                 0.333905456185240, -0.171129629749584, -0.180321564515183,
                                -0.426766034990397, -0.529374964071990,  2.825783659608886,
                                 3.600000000000001};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19,
                              19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22,
                              22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 23};

    std::vector<int32_t> cols{0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 0, 1, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 2, 3, 10, 11, 12, 13, 14,
                              15, 16, 17, 18, 19, 20, 21, 22, 23, 2, 3, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 4,
                              5, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
                              22, 23, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 6, 7, 10, 11, 12, 13, 14, 15,
                              16, 17, 18, 19, 20, 21, 22, 23, 6, 7, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                              11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14,
                              15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14, 15, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18,
                              19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18, 19, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22,
                              23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22, 23};

    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 24, 24, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeFDForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 2);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 8.581248210846821,  2.528100795265542,  0.178752760054699,
                                 0.347734724787917, -0.074334698452848,  0.236199830479332,
                                 0.220100403310216, -0.142871071960546,  1.856790471057355,
                                 1.450800090845162, -0.843538941773863, -0.957118142997259,
                                -0.286029655704678, -0.163377175891591, -0.406131370402432,
                                -0.600427531351077,  2.528100795265542,  2.800000000000002,
                                 0.275156075669238,  0.425124684159285,  0.355891753400871,
                                 0.615733669050158, -0.169746446793077, -0.261788767603529,
                                 0.559822496695564,  0.678252191620873, -0.489055044629812,
                                -0.655065384478335, -0.045036778941252, -0.047096341920640,
                                -0.434463244789306, -0.660409845692622,  8.581248210846820,
                                 2.528100795265542,  0.612120611557993,  0.478177151537527,
                                 0.030467176950699, -0.281995142874608,  0.449646055173711,
                                 0.224320402129403,  0.739981405134890,  0.189641787167309,
                                 1.011152523815688,  0.338599499231990,  1.412304578320495,
                                 1.106948343570015,  0.679716710306585,  0.696743623042226,
                                 2.528100795265542,  2.800000000000002,  0.184484335675052,
                                 0.223499045163122, -0.136195211781892, -0.149182048698514,
                                 0.271897675202348,  0.500837282480001, -0.117821085593726,
                                -0.253544484055368, -0.004575216020592, -0.061630135512071,
                                 0.331844986026058,  0.321750650799826,  0.318471774667355,
                                 0.406423181116364,  8.581248210846823,  2.528100795265543,
                                 0.183139925285943,  0.128895426879631,  1.568823337814463,
                                 0.896095636564283, -0.047540900423321, -0.374880553678937,
                                -1.887184038210941, -1.107731341674290, -0.031693933615547,
                                -0.249920369119292, -0.653676390756026, -0.373373181901785,
                                -0.936048507017041, -0.658798848495891,  2.528100795265543,
                                 2.800000000000002,  0.045483420034997,  0.053341173259897,
                                 0.247018966229071,  0.258315314014415, -0.140299475871550,
                                -0.123509187493234, -0.080631994646733,  0.146436005580063,
                                -0.093532983914367, -0.082339458328823, -0.102924569262113,
                                -0.107631380839340, -0.232470813512204, -0.272632663328362,
                                 8.581248210846820,  2.528100795265542, -1.146801182160193,
                                -0.963537434076450, -1.075841806686677, -0.949112429125837,
                                 1.011152523815688,  0.338599499231990,  0.493320936756594,
                                 0.126427858111539, -0.392981048006029, -0.057845847230588,
                                -1.689231433622147, -1.088712038922627,  0.148928510303164,
                                 0.213606622261922,  2.528100795265542,  2.800000000000002,
                                -0.392016526710414, -0.483331185421175, -0.302409870252238,
                                -0.299140440549352, -0.004575216020592, -0.061630135512070,
                                -0.078547390395818, -0.169029656036912,  0.275710355219508,
                                 0.552195728740061, -0.286641359070305, -0.264745345534271,
                                 0.111552456565685,  0.147231940894185,  8.581248210846818,
                                 2.528100795265543,  0.194881802450459,  0.479763966815145,
                                -0.286029655704678, -0.163377175891591,  1.195645805795620,
                                 1.179961603514191, -0.773662696273898, -0.604500037852151,
                                -1.579556901689871, -1.281848759047087, -0.641626848933793,
                                -0.087831568372323,  0.221922688513896,  0.372392940656231,
                                 2.528100795265543,  2.800000000000001,  0.401200959206195,
                                 0.625626452836583, -0.045036778941252, -0.047096341920639,
                                 0.559385656961871,  0.733780054400248, -0.233259373623152,
                                -0.282605079842031, -0.529214020934711, -0.664108191648859,
                                 0.266568808500722,  0.522325924240890,  0.281953393661096,
                                 0.432232848193518,  0.178752760054699,  0.275156075669238,
                                 0.612120611557993,  0.184484335675052,  0.183139925285943,
                                 0.045483420034997, -1.146801182160193, -0.392016526710414,
                                 0.194881802450459,  0.401200959206195,  9.280343182967972,
                                 5.757046560354534,  0.347734724787917,  0.425124684159285,
                                 0.478177151537527,  0.223499045163122,  0.128895426879631,
                                 0.053341173259897, -0.963537434076450, -0.483331185421175,
                                 0.479763966815145,  0.625626452836583,  5.757046560354534,
                                 5.400000000000003, -0.074334698452848,  0.355891753400871,
                                 0.030467176950699, -0.136195211781892,  1.568823337814463,
                                 0.247018966229071, -1.075841806686677, -0.302409870252238,
                                -0.286029655704678, -0.045036778941252,  9.280343182967970,
                                 5.757046560354532,  0.236199830479332,  0.615733669050158,
                                -0.281995142874608, -0.149182048698514,  0.896095636564283,
                                 0.258315314014415, -0.949112429125837, -0.299140440549352,
                                -0.163377175891591, -0.047096341920639,  5.757046560354532,
                                 5.400000000000002,  0.220100403310216, -0.169746446793077,
                                 0.449646055173711,  0.271897675202348, -0.047540900423321,
                                -0.140299475871550,  1.011152523815688, -0.004575216020592,
                                 1.195645805795620,  0.559385656961871,  9.280343182967972,
                                 5.757046560354533, -0.142871071960546, -0.261788767603529,
                                 0.224320402129403,  0.500837282480001, -0.374880553678937,
                                -0.123509187493234,  0.338599499231990, -0.061630135512070,
                                 1.179961603514191,  0.733780054400248,  5.757046560354533,
                                 5.400000000000003,  1.856790471057355,  0.559822496695564,
                                 0.739981405134890, -0.117821085593726, -1.887184038210941,
                                -0.080631994646733,  0.493320936756594, -0.078547390395818,
                                -0.773662696273898, -0.233259373623152,  9.280343182967972,
                                 5.757046560354533,  1.450800090845162,  0.678252191620873,
                                 0.189641787167309, -0.253544484055368, -1.107731341674290,
                                 0.146436005580063,  0.126427858111539, -0.169029656036912,
                                -0.604500037852151, -0.282605079842031,  5.757046560354533,
                                 5.400000000000001, -0.843538941773863, -0.489055044629812,
                                 1.011152523815688, -0.004575216020592, -0.031693933615547,
                                -0.093532983914367, -0.392981048006029,  0.275710355219508,
                                -1.579556901689871, -0.529214020934711,  9.280343182967972,
                                 5.757046560354533, -0.957118142997259, -0.655065384478335,
                                 0.338599499231990, -0.061630135512071, -0.249920369119292,
                                -0.082339458328823, -0.057845847230588,  0.552195728740061,
                                -1.281848759047087, -0.664108191648859,  5.757046560354533,
                                 5.400000000000004, -0.286029655704678, -0.045036778941252,
                                 1.412304578320495,  0.331844986026058, -0.653676390756026,
                                -0.102924569262113, -1.689231433622147, -0.286641359070305,
                                -0.641626848933793,  0.266568808500722,  9.280343182967970,
                                 5.757046560354533, -0.163377175891591, -0.047096341920640,
                                 1.106948343570015,  0.321750650799826, -0.373373181901785,
                                -0.107631380839340, -1.088712038922627, -0.264745345534271,
                                -0.087831568372323,  0.522325924240890,  5.757046560354533,
                                 5.400000000000003, -0.406131370402432, -0.434463244789306,
                                 0.679716710306585,  0.318471774667355, -0.936048507017041,
                                -0.232470813512204,  0.148928510303164,  0.111552456565685,
                                 0.221922688513896,  0.281953393661096,  9.280343182967972,
                                 5.757046560354534, -0.600427531351077, -0.660409845692622,
                                 0.696743623042226,  0.406423181116364, -0.658798848495891,
                                -0.272632663328362,  0.213606622261922,  0.147231940894185,
                                 0.372392940656231,  0.432232848193518,  5.757046560354534,
                                 5.400000000000003};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19,
                              19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22,
                              22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 23};

    std::vector<int32_t> cols{0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 0, 1, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 2, 3, 10, 11, 12, 13, 14,
                              15, 16, 17, 18, 19, 20, 21, 22, 23, 2, 3, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 4,
                              5, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
                              22, 23, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 6, 7, 10, 11, 12, 13, 14, 15,
                              16, 17, 18, 19, 20, 21, 22, 23, 6, 7, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                              11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14,
                              15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14, 15, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18,
                              19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18, 19, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22,
                              23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22, 23};

    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 24, 24, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeFFForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 3);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 9.280343182967972,  5.757046560354534, -0.371421103304830,
                                 0.082360004600899, -0.415795898776046, -0.493678070555203,
                                -0.941378167906228, -0.298797177255257, -0.294591333127733,
                                -0.076221314011161,  1.720779989600582,  0.621170627867467,
                                -0.478219856681386, -0.721590023201671,  0.021596184847186,
                                 0.002809799682774,  5.757046560354534,  5.400000000000003,
                                -0.205542269636521,  0.267796400290901, -0.555320698962476,
                                -0.651416721671939, -0.567817423741276, -0.329653983438166,
                                -0.163179058467294, -0.078972779300570,  1.120012015822089,
                                 0.698394943841697, -0.776354671834398, -0.960374332790627,
                                 0.008406407798515,  0.002486714522207, -0.371421103304830,
                                -0.205542269636521,  11.035325809057101,  2.825783659608886,
                                -0.415795898776046, -0.555320698962476, -0.941378167906229,
                                -0.567817423741276, -0.294591333127733, -0.163179058467294,
                                 1.720779989600582,  1.120012015822088, -0.478219856681386,
                                -0.776354671834397,  0.021596184847185,  0.008406407798515,
                                 0.082360004600899,  0.267796400290901,  2.825783659608886,
                                 3.600000000000001, -0.493678070555203, -0.651416721671939,
                                -0.298797177255258, -0.329653983438166, -0.076221314011161,
                                -0.078972779300570,  0.621170627867467,  0.698394943841697,
                                -0.721590023201671, -0.960374332790627,  0.002809799682774,
                                 0.002486714522207, -0.415795898776046, -0.493678070555203,
                                 9.280343182967970,  5.757046560354532,  0.007543362004237,
                                -0.301936472705153, -0.361600032424222, -0.092819646640947,
                                -1.616019538135451, -0.085102301665838,  0.644722662009072,
                                -0.068984274172985,  0.402306480648399,  0.028134812177192,
                                 0.897775281392313,  0.776176826732040, -0.555320698962476,
                                -0.651416721671939,  5.757046560354532,  5.400000000000002,
                                -0.314727264704061, -0.346728518407748, -0.068249852744595,
                                -0.158733875972198, -0.585605729534567,  0.018544583150774,
                                 0.251922027404775, -0.201523398195016,  0.125610410006265,
                                 0.017542939178975,  0.939668424664165,  1.008684466033221,
                                -0.415795898776046, -0.555320698962476,  0.007543362004237,
                                -0.314727264704061,  11.035325809057095,  2.825783659608886,
                                -0.361600032424222, -0.068249852744594, -1.616019538135451,
                                -0.585605729534567,  0.644722662009072,  0.251922027404775,
                                 0.402306480648399,  0.125610410006264,  0.897775281392313,
                                 0.939668424664165, -0.493678070555203, -0.651416721671939,
                                -0.301936472705153, -0.346728518407748,  2.825783659608886,
                                 3.600000000000000, -0.092819646640947, -0.158733875972198,
                                -0.085102301665838,  0.018544583150774, -0.068984274172985,
                                -0.201523398195016,  0.028134812177192,  0.017542939178975,
                                 0.776176826732040,  1.008684466033219, -0.941378167906229,
                                -0.298797177255258, -0.361600032424222, -0.092819646640947,
                                 9.280343182967972,  5.757046560354533, -1.241207926222034,
                                -0.865342463525172,  0.648220780130993,  0.088017686914864,
                                -0.309926329472489,  0.025894833668040, -1.000859475202693,
                                 0.047910715436455, -0.940305187608747, -0.482123385048404,
                                -0.567817423741276, -0.329653983438166, -0.068249852744594,
                                -0.158733875972198,  5.757046560354533,  5.400000000000003,
                                -1.097348911489163, -1.070801074167564,  0.358583447225504,
                                 0.030466292761014,  0.054580475016219, -0.000202651803258,
                                -0.358211069361275,  0.190550173466032, -0.768200709797489,
                                -0.563938978030247, -0.941378167906228, -0.567817423741276,
                                -0.361600032424222, -0.068249852744595, -1.241207926222034,
                                -1.097348911489163,  11.035325809057101,  2.825783659608886,
                                 0.648220780130993,  0.358583447225504, -0.309926329472489,
                                 0.054580475016219, -1.000859475202693, -0.358211069361275,
                                -0.940305187608747, -0.768200709797489, -0.298797177255257,
                                -0.329653983438166, -0.092819646640947, -0.158733875972198,
                                -0.865342463525172, -1.070801074167564,  2.825783659608886,
                                 3.600000000000000,  0.088017686914864,  0.030466292761014,
                                 0.025894833668040, -0.000202651803258,  0.047910715436454,
                                 0.190550173466032, -0.482123385048404, -0.563938978030246,
                                -0.294591333127733, -0.076221314011161, -1.616019538135451,
                                -0.085102301665838,  0.648220780130993,  0.088017686914864,
                                 9.280343182967972,  5.757046560354533,  0.838909918017982,
                                -0.778796344163673,  0.432147186753995,  0.058678457943243,
                                 0.673341474223104,  0.035459292360766,  1.505689035986191,
                                 0.389575604945933, -0.163179058467294, -0.078972779300570,
                                -0.585605729534567,  0.018544583150774,  0.358583447225504,
                                 0.030466292761014,  5.757046560354533,  5.400000000000001,
                                -0.501328532858786, -1.060662457942633,  0.239055631483669,
                                 0.020310861840676,  0.244002387306069, -0.007726909646156,
                                 0.834026298832836,  0.403638649758468, -0.294591333127733,
                                -0.163179058467294, -1.616019538135451, -0.585605729534567,
                                 0.648220780130993,  0.358583447225504,  0.838909918017982,
                                -0.501328532858786,  11.035325809057099,  2.825783659608884,
                                 0.432147186753995,  0.239055631483669,  0.673341474223104,
                                 0.244002387306070,  1.505689035986191,  0.834026298832836,
                                -0.076221314011161, -0.078972779300570, -0.085102301665838,
                                 0.018544583150774,  0.088017686914864,  0.030466292761014,
                                -0.778796344163673, -1.060662457942633,  2.825783659608884,
                                 3.600000000000000,  0.058678457943243,  0.020310861840676,
                                 0.035459292360766, -0.007726909646156,  0.389575604945933,
                                 0.403638649758468,  1.720779989600582,  0.621170627867467,
                                 0.644722662009072, -0.068984274172985, -0.309926329472489,
                                 0.025894833668040,  0.432147186753995,  0.058678457943243,
                                 9.280343182967972,  5.757046560354533, -0.982935984994959,
                                -0.886921491581872,  1.458654790565399,  0.014889653567987,
                                -0.167407322597659, -0.160908661459688,  1.120012015822088,
                                 0.698394943841697,  0.251922027404775, -0.201523398195016,
                                 0.054580475016219, -0.000202651803258,  0.239055631483669,
                                 0.020310861840676,  5.757046560354533,  5.400000000000004,
                                -1.142832640669346, -1.070632197664848,  0.475005250588628,
                                -0.102648505135168, -0.218937878600215, -0.196318484008478,
                                 1.720779989600582,  1.120012015822089,  0.644722662009072,
                                 0.251922027404775, -0.309926329472489,  0.054580475016219,
                                 0.432147186753995,  0.239055631483669, -0.982935984994959,
                                -1.142832640669346,  11.035325809057101,  2.825783659608886,
                                 1.458654790565399,  0.475005250588628, -0.167407322597659,
                                -0.218937878600215,  0.621170627867467,  0.698394943841697,
                                -0.068984274172985, -0.201523398195016,  0.025894833668040,
                                -0.000202651803258,  0.058678457943243,  0.020310861840676,
                                -0.886921491581872, -1.070632197664848,  2.825783659608886,
                                 3.600000000000001,  0.014889653567987, -0.102648505135168,
                                -0.160908661459689, -0.196318484008478, -0.478219856681386,
                                -0.721590023201671,  0.402306480648399,  0.028134812177192,
                                -1.000859475202693,  0.047910715436454,  0.673341474223104,
                                 0.035459292360766,  1.458654790565399,  0.014889653567987,
                                 9.280343182967970,  5.757046560354533,  0.805451215290228,
                                -0.246135761887056, -0.501534193273087, -0.504833162733938,
                                -0.776354671834397, -0.960374332790627,  0.125610410006264,
                                 0.017542939178975, -0.358211069361275,  0.190550173466032,
                                 0.244002387306070, -0.007726909646156,  0.475005250588628,
                                -0.102648505135168,  5.757046560354533,  5.400000000000003,
                                -0.065599951524970, -0.311935022369447, -0.588694698703233,
                                -0.661289144210626, -0.478219856681386, -0.776354671834398,
                                 0.402306480648399,  0.125610410006265, -1.000859475202693,
                                -0.358211069361275,  0.673341474223104,  0.244002387306069,
                                 1.458654790565399,  0.475005250588628,  0.805451215290228,
                                -0.065599951524970,  11.035325809057099,  2.825783659608885,
                                -0.501534193273087, -0.588694698703233, -0.721590023201671,
                                -0.960374332790627,  0.028134812177192,  0.017542939178975,
                                 0.047910715436455,  0.190550173466032,  0.035459292360766,
                                -0.007726909646156,  0.014889653567987, -0.102648505135168,
                                -0.246135761887056, -0.311935022369447,  2.825783659608885,
                                 3.599999999999999, -0.504833162733938, -0.661289144210626,
                                 0.021596184847185,  0.002809799682774,  0.897775281392313,
                                 0.776176826732040, -0.940305187608747, -0.482123385048404,
                                 1.505689035986191,  0.389575604945933, -0.167407322597659,
                                -0.160908661459689, -0.501534193273087, -0.504833162733938,
                                 9.280343182967972,  5.757046560354534, -0.477576263121309,
                                 0.068548549638472,  0.008406407798515,  0.002486714522207,
                                 0.939668424664165,  1.008684466033219, -0.768200709797489,
                                -0.563938978030246,  0.834026298832836,  0.403638649758468,
                                -0.218937878600215, -0.196318484008478, -0.588694698703233,
                                -0.661289144210626,  5.757046560354534,  5.400000000000003,
                                -0.246863621979463,  0.255573057168461,  0.021596184847186,
                                 0.008406407798515,  0.897775281392313,  0.939668424664165,
                                -0.940305187608747, -0.768200709797489,  1.505689035986191,
                                 0.834026298832836, -0.167407322597659, -0.218937878600215,
                                -0.501534193273087, -0.588694698703233, -0.477576263121309,
                                -0.246863621979463,  11.035325809057101,  2.825783659608886,
                                 0.002809799682774,  0.002486714522207,  0.776176826732040,
                                 1.008684466033221, -0.482123385048404, -0.563938978030247,
                                 0.389575604945933,  0.403638649758468, -0.160908661459688,
                                -0.196318484008478, -0.504833162733938, -0.661289144210626,
                                 0.068548549638472,  0.255573057168461,  2.825783659608886,
                                 3.600000000000001};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,
                              17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,
                              21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
                              22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25,
                              25, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26,
                              26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 27, 27, 27, 27, 27};

    std::vector<int32_t> cols{0, 1, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22, 23,
                              26, 27, 0, 1, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19,
                              22, 23, 26, 27, 0, 1, 2, 3, 4, 5, 8, 9, 12, 13, 16,
                              17, 20, 21, 24, 25, 0, 1, 2, 3, 4, 5, 8, 9, 12, 13,
                              16, 17, 20, 21, 24, 25, 2, 3, 4, 5, 6, 7, 10, 11,
                              14, 15, 18, 19, 22, 23, 26, 27, 2, 3, 4, 5, 6, 7,
                              10, 11, 14, 15, 18, 19, 22, 23, 26, 27, 0, 1, 4, 5,
                              6, 7, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 0, 1,
                              4, 5, 6, 7, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25,
                              2, 3, 6, 7, 8, 9, 10, 11, 14, 15, 18, 19, 22, 23,
                              26, 27, 2, 3, 6, 7, 8, 9, 10, 11, 14, 15, 18, 19,
                              22, 23, 26, 27, 0, 1, 4, 5, 8, 9, 10, 11, 12, 13,
                              16, 17, 20, 21, 24, 25, 0, 1, 4, 5, 8, 9, 10, 11,
                              12, 13, 16, 17, 20, 21, 24, 25, 2, 3, 6, 7, 10, 11,
                              12, 13, 14, 15, 18, 19, 22, 23, 26, 27, 2, 3, 6, 7,
                              10, 11, 12, 13, 14, 15, 18, 19, 22, 23, 26, 27, 0,
                              1, 4, 5, 8, 9, 12, 13, 14, 15, 16, 17, 20, 21, 24,
                              25, 0, 1, 4, 5, 8, 9, 12, 13, 14, 15, 16, 17, 20,
                              21, 24, 25, 2, 3, 6, 7, 10, 11, 14, 15, 16, 17, 18,
                              19, 22, 23, 26, 27, 2, 3, 6, 7, 10, 11, 14, 15, 16,
                              17, 18, 19, 22, 23, 26, 27, 0, 1, 4, 5, 8, 9, 12,
                              13, 16, 17, 18, 19, 20, 21, 24, 25, 0, 1, 4, 5, 8,
                              9, 12, 13, 16, 17, 18, 19, 20, 21, 24, 25, 2, 3, 6,
                              7, 10, 11, 14, 15, 18, 19, 20, 21, 22, 23, 26, 27,
                              2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 20, 21, 22, 23,
                              26, 27, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21,
                              22, 23, 24, 25, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17,
                              20, 21, 22, 23, 24, 25, 2, 3, 6, 7, 10, 11, 14, 15,
                              18, 19, 22, 23, 24, 25, 26, 27, 2, 3, 6, 7, 10, 11,
                              14, 15, 18, 19, 22, 23, 24, 25, 26, 27, 0, 1, 4, 5,
                              8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 26, 27, 0, 1,
                              4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 26, 27};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 28, 28, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeSGForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 4);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 3.082911586456580,  2.133606523257290, -0.068349548420077,
                                -0.061212217787100,  0.079745208145143,  0.071417897576398,
                                 0.870595725351739,  0.779684670588036,  0.823850052290132,
                                 0.737820365904333, -0.155053334536649, -0.138862051054685,
                                 0.549233368193422,  0.491880243936222, -0.362748218896558,
                                -0.324868612745015, -0.407586619408510, -0.365024809834923,
                                -0.067779968849910, -0.060702115972207,  2.133606523257290,
                                 1.800000000000001, -0.023957966146580, -0.034847511723969,
                                 0.027952386537380,  0.040657504548369,  0.305162263650124,
                                 0.443866791329384,  0.288776913949991,  0.420033855666847,
                                -0.054349481827041, -0.079052795782909,  0.192517942633328,
                                 0.280022570444565, -0.127150943187552, -0.184944496387243,
                                -0.142867753413274, -0.207805023247217, -0.023758316428692,
                                -0.034557115792936, -0.068349548420077, -0.023957966146580,
                                 13.490419626365505,  3.010048625676243, -0.061212217787100,
                                -0.034847511723969,  3.010048625676243,  4.400000000000008,
                                 0.079745208145143,  0.027952386537380,  13.490419626365505,
                                 3.010048625676241,  0.071417897576398,  0.040657504548369,
                                 3.010048625676241,  4.400000000000005,  0.870595725351739,
                                 0.305162263650124,  13.490419626365512,  3.010048625676243,
                                 0.779684670588036,  0.443866791329384,  3.010048625676243,
                                 4.400000000000006,  0.823850052290132,  0.288776913949991,
                                 13.490419626365505,  3.010048625676243,  0.737820365904333,
                                 0.420033855666847,  3.010048625676243,  4.400000000000007,
                                -0.155053334536649, -0.054349481827041,  13.490419626365515,
                                 3.010048625676241, -0.138862051054685, -0.079052795782909,
                                 3.010048625676241,  4.400000000000006,  0.549233368193422,
                                 0.192517942633328,  13.490419626365505,  3.010048625676243,
                                 0.491880243936222,  0.280022570444565,  3.010048625676243,
                                 4.400000000000007, -0.362748218896558, -0.127150943187552,
                                 13.490419626365512,  3.010048625676241, -0.324868612745015,
                                -0.184944496387243,  3.010048625676241,  4.400000000000006,
                                -0.407586619408510, -0.142867753413274,  13.490419626365505,
                                 3.010048625676241, -0.365024809834923, -0.207805023247217,
                                 3.010048625676241,  4.400000000000005, -0.067779968849910,
                                -0.023758316428692,  13.490419626365513,  3.010048625676242,
                                -0.060702115972207, -0.034557115792936,  3.010048625676242,
                                 4.400000000000006};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4,
                              4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8, 8,
                              9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11, 12, 12,
                              12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15,
                              15, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18,
                              19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                              15, 16, 17, 18, 19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 0, 1, 2, 3,
                              0, 1, 2, 3, 0, 1, 4, 5, 0, 1, 4, 5, 0, 1, 6, 7, 0,
                              1, 6, 7, 0, 1, 8, 9, 0, 1, 8, 9, 0, 1, 10, 11, 0,
                              1, 10, 11, 0, 1, 12, 13, 0, 1, 12, 13, 0, 1, 14, 15,
                              0, 1, 14, 15, 0, 1, 16, 17, 0, 1, 16, 17, 0, 1, 18,
                              19, 0, 1, 18, 19};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeGSForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 0);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 3.676148028919980,  1.444559298223930, -0.092647007957840,
                                -0.096479036396561,  0.108093690512994,  0.112564618449281,
                                 1.180082253053066,  1.228892342589767,  1.116719043723344,
                                 1.162908329572238, -0.210172968962687, -0.218866059132227,
                                 0.744479362482229,  0.775272219714826, -0.491700938772110,
                                -0.512038476079070, -0.552478862621968, -0.575330272074103,
                                -0.091874949558191, -0.095675044426590,  1.444559298223930,
                                 1.200000000000001, -0.010227853536431, -0.015487782988431,
                                 0.011933104577779,  0.018070002021497,  0.130276289663454,
                                 0.197274129479726,  0.123281248604843,  0.186681713629710,
                                -0.023202242481974, -0.035134575903515,  0.082187499069895,
                                 0.124454475753140, -0.054281787359773, -0.082197553949886,
                                -0.060991423397534, -0.092357788109874, -0.010142621423628,
                                -0.015358718130194, -0.092647007957840, -0.010227853536431,
                                 11.355406609492883,  6.810469165524211, -0.096479036396561,
                                -0.015487782988431,  6.810469165524211,  6.600000000000006,
                                 0.108093690512994,  0.011933104577779,  11.355406609492880,
                                 6.810469165524206,  0.112564618449281,  0.018070002021497,
                                 6.810469165524206,  6.599999999999996,  1.180082253053066,
                                 0.130276289663454,  11.355406609492881,  6.810469165524210,
                                 1.228892342589767,  0.197274129479726,  6.810469165524210,
                                 6.599999999999999,  1.116719043723344,  0.123281248604843,
                                 11.355406609492887,  6.810469165524212,  1.162908329572238,
                                 0.186681713629710,  6.810469165524212,  6.600000000000001,
                                -0.210172968962687, -0.023202242481974,  11.355406609492883,
                                 6.810469165524212, -0.218866059132227, -0.035134575903515,
                                 6.810469165524212,  6.599999999999996,  0.744479362482229,
                                 0.082187499069895,  11.355406609492887,  6.810469165524212,
                                 0.775272219714826,  0.124454475753140,  6.810469165524212,
                                 6.600000000000001, -0.491700938772110, -0.054281787359773,
                                 11.355406609492883,  6.810469165524209, -0.512038476079070,
                                -0.082197553949886,  6.810469165524209,  6.599999999999995,
                                -0.552478862621968, -0.060991423397534,  11.355406609492880,
                                 6.810469165524206, -0.575330272074103, -0.092357788109874,
                                 6.810469165524206,  6.599999999999996, -0.091874949558191,
                                -0.010142621423628,  11.355406609492885,  6.810469165524213,
                                -0.095675044426590, -0.015358718130194,  6.810469165524213,
                                 6.599999999999999};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4,
                              4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8, 8,
                              9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11, 12, 12,
                              12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15,
                              15, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18,
                              19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                              15, 16, 17, 18, 19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 0, 1, 2, 3,
                              0, 1, 2, 3, 0, 1, 4, 5, 0, 1, 4, 5, 0, 1, 6, 7, 0,
                              1, 6, 7, 0, 1, 8, 9, 0, 1, 8, 9, 0, 1, 10, 11, 0,
                              1, 10, 11, 0, 1, 12, 13, 0, 1, 12, 13, 0, 1, 14, 15,
                              0, 1, 14, 15, 0, 1, 16, 17, 0, 1, 16, 17, 0, 1, 18,
                              19, 0, 1, 18, 19};
    
   ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputePGForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 4);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 5.144058407759709,  3.427919368883665,  0.268902116708826,
                                 0.288102206712563,  0.539864271577363,  0.452224341438293,
                                 0.173181425599099, -0.346387518187438,  0.670684984683828,
                                 0.140279957096400,  1.066859661309058,  1.075500036371250,
                                 1.059523339346409,  0.659115632472850,  0.979456420177950,
                                 1.115570885541859,  0.580006243093195,  0.772727522393572,
                                -0.012395614777536,  0.027972163888665,  3.427919368883665,
                                 3.000000000000000,  0.141879627495823,  0.221639231194925,
                                 0.242736060057753,  0.335248567744684, -0.086137699139731,
                                -0.319808406410922,  0.160887449692521,  0.049940844936782,
                                 0.540365106830123,  0.820619556142841,  0.400165021752678,
                                 0.459334670077487,  0.538871106471797,  0.864852137810348,
                                 0.356519271188696,  0.609634771674546,  0.007226307806190,
                                 0.025655062451711,  5.144058407759709,  3.427919368883665,
                                -0.149720030184830, -0.065399196799632,  0.126182313557299,
                                 0.031509732284619,  0.766374126155313, -0.220475431816077,
                                -0.175128858715819, -1.040178640479982, -0.948958956520577,
                                -0.711105718879017, -0.116752572477212, -0.693452426986655,
                                -0.319322552564714,  0.091864763256699, -0.644931824848418,
                                -0.161049742788053, -0.148472363266623, -0.064854203492968,
                                 3.427919368883665,  3.000000000000000, -0.047289810524145,
                                -0.040786628528592,  0.031977059435695,  0.013845869522677,
                                 0.056774640945468, -0.274037519100953, -0.376906646439993,
                                -0.885690520728445, -0.398709212517914, -0.516419644054876,
                                -0.251271097626662, -0.590460347152297, -0.023656100393945,
                                 0.114182299625397, -0.163438303782443, -0.070767777560349,
                                -0.046895728769777, -0.040446739957520,  5.144058407759709,
                                 3.427919368883665, -0.123032957980560, -0.087128710084696,
                                -1.003478437585785, -0.957704384558264, -0.693480598967965,
                                -0.978034822097082,  1.059523339346409,  0.659115632472850,
                                 0.711239774206038,  0.717000024247500, -0.212251131438179,
                                -0.408983069964308, -1.288472771696376, -1.049349620238524,
                                 0.119921012038878,  0.268788953124972,  0.296577637439962,
                                 0.300191149151283,  3.427919368883665,  3.000000000000000,
                                -0.050002090962120, -0.062548421893483, -0.490275053999294,
                                -0.724996778131762, -0.444333131603597, -0.775973785150202,
                                 0.400165021752678,  0.459334670077486,  0.360243404553415,
                                 0.547079704095228, -0.172583401768044, -0.332838046794456,
                                -0.569331792910532, -0.774075542229446,  0.110094908770576,
                                 0.220847911341278,  0.150621077319983,  0.229178577680513,
                                 0.268902116708826,  0.141879627495823, -0.149720030184830,
                                -0.047289810524145, -0.123032957980560, -0.050002090962120,
                                 13.490419626365505,  3.010048625676243,  0.288102206712563,
                                 0.221639231194925, -0.065399196799632, -0.040786628528592,
                                -0.087128710084696, -0.062548421893483,  3.010048625676243,
                                 4.400000000000008,  0.539864271577363,  0.242736060057753,
                                 0.126182313557299,  0.031977059435695, -1.003478437585785,
                                -0.490275053999294,  13.490419626365505,  3.010048625676241,
                                 0.452224341438293,  0.335248567744684,  0.031509732284619,
                                 0.013845869522677, -0.957704384558264, -0.724996778131762,
                                 3.010048625676241,  4.400000000000005,  0.173181425599099,
                                -0.086137699139731,  0.766374126155313,  0.056774640945468,
                                -0.693480598967965, -0.444333131603597,  13.490419626365512,
                                 3.010048625676243, -0.346387518187438, -0.319808406410922,
                                -0.220475431816077, -0.274037519100953, -0.978034822097082,
                                -0.775973785150202,  3.010048625676243,  4.400000000000006,
                                 0.670684984683828,  0.160887449692521, -0.175128858715819,
                                -0.376906646439993,  1.059523339346409,  0.400165021752678,
                                 13.490419626365505,  3.010048625676243,  0.140279957096400,
                                 0.049940844936782, -1.040178640479982, -0.885690520728445,
                                 0.659115632472850,  0.459334670077486,  3.010048625676243,
                                 4.400000000000007,  1.066859661309058,  0.540365106830123,
                                -0.948958956520577, -0.398709212517914,  0.711239774206038,
                                 0.360243404553415,  13.490419626365515,  3.010048625676241,
                                 1.075500036371250,  0.820619556142841, -0.711105718879017,
                                -0.516419644054876,  0.717000024247500,  0.547079704095228,
                                 3.010048625676241,  4.400000000000006,  1.059523339346409,
                                 0.400165021752678, -0.116752572477212, -0.251271097626662,
                                -0.212251131438179, -0.172583401768044,  13.490419626365505,
                                 3.010048625676243,  0.659115632472850,  0.459334670077487,
                                -0.693452426986655, -0.590460347152297, -0.408983069964308,
                                -0.332838046794456,  3.010048625676243,  4.400000000000007,
                                 0.979456420177950,  0.538871106471797, -0.319322552564714,
                                -0.023656100393945, -1.288472771696376, -0.569331792910532,
                                 13.490419626365512,  3.010048625676241,  1.115570885541859,
                                 0.864852137810348,  0.091864763256699,  0.114182299625397,
                                -1.049349620238524, -0.774075542229446,  3.010048625676241,
                                 4.400000000000006,  0.580006243093195,  0.356519271188696,
                                -0.644931824848418, -0.163438303782443,  0.119921012038878,
                                 0.110094908770576,  13.490419626365505,  3.010048625676241,
                                 0.772727522393572,  0.609634771674546, -0.161049742788053,
                                -0.070767777560349,  0.268788953124972,  0.220847911341278,
                                 3.010048625676241,  4.400000000000005, -0.012395614777536,
                                 0.007226307806190, -0.148472363266623, -0.046895728769777,
                                 0.296577637439962,  0.150621077319983,  13.490419626365513,
                                 3.010048625676242,  0.027972163888665,  0.025655062451711,
                                -0.064854203492968, -0.040446739957520,  0.300191149151283,
                                 0.229178577680513,  3.010048625676242,  4.400000000000006};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10,
                              10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11,
                              11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13,
                              13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14,
                              15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16,
                              16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18,
                              18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19,
                              19, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21,
                              21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 23,
                              23, 23, 23, 23, 23, 23, 23};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 0, 1, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 2,
                              3, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 2, 3, 6, 7, 8, 9, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3,
                              4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4,
                              5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5,
                              10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1, 2, 3, 4, 5,
                              12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1, 2, 3, 4, 5,
                              14, 15, 0, 1, 2, 3, 4, 5, 14, 15, 0, 1, 2, 3, 4, 5,
                              16, 17, 0, 1, 2, 3, 4, 5, 16, 17, 0, 1, 2, 3, 4, 5,
                              18, 19, 0, 1, 2, 3, 4, 5, 18, 19, 0, 1, 2, 3, 4, 5,
                              20, 21, 0, 1, 2, 3, 4, 5, 20, 21, 0, 1, 2, 3, 4, 5,
                              22, 23, 0, 1, 2, 3, 4, 5, 22, 23};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 24, 24, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeGPForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 1);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 6.128188526493468,  2.082419686588810, -0.349705755937067,
                                -0.395670810406476, -0.685020441702813, -0.681435876093232,
                                -0.153263389184634,  0.221254324964419, -0.793992853877426,
                                -0.469296810580644, -1.378309322503227, -1.509366202806469,
                                -1.313504821904464, -1.132944036521679, -1.282730327328806,
                                -1.500432544176612, -0.774763359159580, -0.988858716711111,
                                 0.010539897364915, -0.018681816386734,  2.082419686588810,
                                 2.000000000000000, -0.078403270359942, -0.120645116313404,
                                -0.121990715319327, -0.182486206216301,  0.098801770308934,
                                 0.174081646924308, -0.033243059456528, -0.027184352759683,
                                -0.292107339999425, -0.446688707888706, -0.175309401988507,
                                -0.250030125079889, -0.304152564994777, -0.470765875686789,
                                -0.211578266169912, -0.331843137791281, -0.007964109537914,
                                -0.013964847183540,  6.128188526493468,  2.082419686588810,
                                 0.181857341394705,  0.135268143552815, -0.150073671405814,
                                -0.092873421251101, -0.855765677747246, -0.195466103708917,
                                 0.343083315643128,  1.020713952408270,  1.192774143508728,
                                 1.122807233470937,  0.228722210428752,  0.680475968272180,
                                 0.356569032394686,  0.081444209878716,  0.767043209407491,
                                 0.474686375283406,  0.180341863549750,  0.134140909023208,
                                 2.082419686588810,  2.000000000000000,  0.016987184066683,
                                 0.022201428494110, -0.007690650246097, -0.007536736750158,
                                 0.068883154907963,  0.149167131594563,  0.290342520379792,
                                 0.482108854623248,  0.190911600681295,  0.281103249129813,
                                 0.193561680253195,  0.321405903082166, -0.028701314544984,
                                -0.062152971497735,  0.039307767924499,  0.038521098945252,
                                 0.016845624199460,  0.022016416589992,  6.128188526493468,
                                 2.082419686588810,  0.153958334169387,  0.141038000782235,
                                 1.289133596394592,  1.371454803049955,  0.933662924765939,
                                 1.230766915700462, -1.313504821904464, -1.132944036521679,
                                -0.918872881668818, -1.006244135204313,  0.300594497709627,
                                 0.474823219854089,  1.630858890581131,  1.599545314953630,
                                -0.174936623111425, -0.302028090473879, -0.383321809952452,
                                -0.420674921790481,  2.082419686588810,  2.000000000000000,
                                 0.023329789670958,  0.034047048412302,  0.259625278357175,
                                 0.394638260352134,  0.268164124333690,  0.422386628309791,
                                -0.175309401988507, -0.250030125079889, -0.194738226666283,
                                -0.297792471925804,  0.112848108867229,  0.181174084806891,
                                 0.282742689243377,  0.421353355740078, -0.074344094900292,
                                -0.120214376343455, -0.081543325596511, -0.124749016732012,
                                -0.349705755937067, -0.078403270359942,  0.181857341394705,
                                 0.016987184066683,  0.153958334169387,  0.023329789670958,
                                 11.355406609492883,  6.810469165524211, -0.395670810406476,
                                -0.120645116313404,  0.135268143552815,  0.022201428494110,
                                 0.141038000782235,  0.034047048412302,  6.810469165524211,
                                 6.600000000000006, -0.685020441702813, -0.121990715319327,
                                -0.150073671405814, -0.007690650246097,  1.289133596394592,
                                 0.259625278357175,  11.355406609492880,  6.810469165524206,
                                -0.681435876093232, -0.182486206216301, -0.092873421251101,
                                -0.007536736750158,  1.371454803049955,  0.394638260352134,
                                 6.810469165524206,  6.599999999999996, -0.153263389184634,
                                 0.098801770308934, -0.855765677747246,  0.068883154907963,
                                 0.933662924765939,  0.268164124333690,  11.355406609492881,
                                 6.810469165524210,  0.221254324964419,  0.174081646924308,
                                -0.195466103708917,  0.149167131594563,  1.230766915700462,
                                 0.422386628309791,  6.810469165524210,  6.599999999999999,
                                -0.793992853877426, -0.033243059456528,  0.343083315643128,
                                 0.290342520379792, -1.313504821904464, -0.175309401988507,
                                 11.355406609492887,  6.810469165524212, -0.469296810580644,
                                -0.027184352759683,  1.020713952408270,  0.482108854623248,
                                -1.132944036521679, -0.250030125079889,  6.810469165524212,
                                 6.600000000000001, -1.378309322503227, -0.292107339999425,
                                 1.192774143508728,  0.190911600681295, -0.918872881668818,
                                -0.194738226666283,  11.355406609492883,  6.810469165524212,
                                -1.509366202806469, -0.446688707888706,  1.122807233470937,
                                 0.281103249129813, -1.006244135204313, -0.297792471925804,
                                 6.810469165524212,  6.599999999999996, -1.313504821904464,
                                -0.175309401988507,  0.228722210428752,  0.193561680253195,
                                 0.300594497709627,  0.112848108867229,  11.355406609492887,
                                 6.810469165524212, -1.132944036521679, -0.250030125079889,
                                 0.680475968272180,  0.321405903082166,  0.474823219854089,
                                 0.181174084806891,  6.810469165524212,  6.600000000000001,
                                -1.282730327328806, -0.304152564994777,  0.356569032394686,
                                -0.028701314544984,  1.630858890581131,  0.282742689243377,
                                 11.355406609492883,  6.810469165524209, -1.500432544176612,
                                -0.470765875686789,  0.081444209878716, -0.062152971497735,
                                 1.599545314953630,  0.421353355740078,  6.810469165524209,
                                 6.599999999999995, -0.774763359159580, -0.211578266169912,
                                 0.767043209407491,  0.039307767924499, -0.174936623111425,
                                -0.074344094900292,  11.355406609492880,  6.810469165524206,
                                -0.988858716711111, -0.331843137791281,  0.474686375283406,
                                 0.038521098945252, -0.302028090473879, -0.120214376343455,
                                 6.810469165524206,  6.599999999999996,  0.010539897364915,
                                -0.007964109537914,  0.180341863549750,  0.016845624199460,
                                -0.383321809952452, -0.081543325596511,  11.355406609492885,
                                 6.810469165524213, -0.018681816386734, -0.013964847183540,
                                 0.134140909023208,  0.022016416589992, -0.420674921790481,
                                -0.124749016732012,  6.810469165524213,  6.599999999999999};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10,
                              10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11,
                              11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13,
                              13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14,
                              15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16,
                              16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18,
                              18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19,
                              19, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21,
                              21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 23,
                              23, 23, 23, 23, 23, 23, 23};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 0, 1, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 2,
                              3, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 2, 3, 6, 7, 8, 9, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3,
                              4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4,
                              5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5,
                              10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1, 2, 3, 4, 5,
                              12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1, 2, 3, 4, 5,
                              14, 15, 0, 1, 2, 3, 4, 5, 14, 15, 0, 1, 2, 3, 4, 5,
                              16, 17, 0, 1, 2, 3, 4, 5, 16, 17, 0, 1, 2, 3, 4, 5,
                              18, 19, 0, 1, 2, 3, 4, 5, 18, 19, 0, 1, 2, 3, 4, 5,
                              20, 21, 0, 1, 2, 3, 4, 5, 20, 21, 0, 1, 2, 3, 4, 5,
                              22, 23, 0, 1, 2, 3, 4, 5, 22, 23};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 24, 24, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeDGForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 4);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 7.209879635504452,  4.632477550580943, -0.257097027371984,
                                -0.296705465385671,  0.372981662261678,  0.757386217097465,
                                -0.136557826781754,  0.442795554903378,  0.524384002760691,
                                -0.170959067583629,  2.001736754938371,  1.028030554167600,
                                -0.640251304983947, -0.756807031763963, -0.400147876348108,
                                -0.102694981611263, -0.822757146735023, -1.192751572325253,
                                -0.529025057369457, -0.693149360957834,  4.632477550580943,
                                 4.200000000000002, -0.182426358967875, -0.298831447798231,
                                 0.400503045076571,  0.797819289006429,  0.112157291771219,
                                 0.547524564111694,  0.022216916385825, -0.230042309709750,
                                 0.920361848212789,  0.867936114208874, -0.492548465785578,
                                -0.735741077412131, -0.124639854245898, -0.074276121152713,
                                -0.676149519742105, -1.235381126626550, -0.412621091889686,
                                -0.704275257908879,  7.209879635504452,  4.632477550580942,
                                 0.592284084053905,  0.312268517981674,  0.835471988855432,
                                 0.195985989013831,  0.243134856851496,  0.228096078086399,
                                 0.914491418623875,  0.851841223353363, -0.129495622215146,
                                -0.831993073061527,  0.440012029584408, -0.257446847200739,
                                 0.782298580427347, -0.391311414711805,  0.932258092322669,
                                 0.344162465454554, -0.020913076926763,  0.031650828481282,
                                 4.632477550580942,  4.200000000000002,  0.281754777944745,
                                 0.260223618317406,  0.275698527671934,  0.113223420767253,
                                 0.050948712072497,  0.316102807210830,  0.478108862872020,
                                 0.915649438306478, -0.356947205279593, -0.928138128642654,
                                -0.063557558694225, -0.287923850705804,  0.072349557474691,
                                -0.583388878140273,  0.418010053058710,  0.212441075416471,
                                 0.015952997233216,  0.030830805720981,  7.209879635504457,
                                 4.632477550580946, -0.352064821080670, -0.126382471572996,
                                 0.227658487689543,  0.063762833918466,  0.792162022796458,
                                 0.227481208781143, -0.842044869615841,  0.386164236594171,
                                -0.924477110269492,  0.736650267105162, -0.561363246410561,
                                 0.257442824396114, -0.330067509498524, -0.094783836992142,
                                -1.163587825968776, -0.325898928916603, -0.349130947571665,
                                -0.125329284309888,  4.632477550580946,  4.200000000000005,
                                -0.131528749037602, -0.099134899310950,  0.074150612871725,
                                 0.047262027793558,  0.202208472989091,  0.224319030025026,
                                -0.127034835485232,  0.620819038039185,  0.093490946625245,
                                 0.934978237760701, -0.084689890323488,  0.413879358692790,
                                -0.084253530412121, -0.093466262510428, -0.378992021344370,
                                -0.241561475389296, -0.130432676128956, -0.098308775150026,
                                 7.209879635504452,  4.632477550580942, -0.264070787599440,
                                -0.092993848915402, -1.567095181630578, -0.418839334199311,
                                -0.517606072957056,  0.379965115269757,  0.440012029584408,
                                -0.257446847200739, -0.086330414810097, -0.554662048707685,
                                 0.547814727303535,  1.066380262687312, -1.109737959107765,
                                 0.286088275234642,  0.205925208625088,  0.121931427508613,
                                 0.650521992717551,  0.324804277601377,  4.632477550580942,
                                 4.200000000000002, -0.097561798012956, -0.072668608369278,
                                -0.562191362735592, -0.247526953774421, -0.038017413109283,
                                 0.558180877988574, -0.063557558694224, -0.287923850705804,
                                -0.237964803519729, -0.618758752428436,  0.531073495117207,
                                 1.155585980561315, -0.124526692461812,  0.444943696875068,
                                 0.132718728909025,  0.078429924728952,  0.298431953313469,
                                 0.268773387032804,  7.209879635504454,  4.632477550580943,
                                 0.493092875272960,  0.685414928047913,  0.419729100464570,
                                 1.105999440870389, -0.400147876348109, -0.102694981611263,
                                 1.068299497721442,  0.906917560880519, -0.834056981224321,
                                -0.428346064236500, -1.663417871230950, -0.938190660846026,
                                -0.930184448205503,  0.239117174707705,  0.455342502538051,
                                 0.775114458366297, -0.168785444562356, -0.277696321700056,
                                 4.632477550580943,  4.200000000000003,  0.402331448666658,
                                 0.699000139804297,  0.560737246870394,  1.176213538701439,
                                -0.124639854245898, -0.074276121152713,  0.650310617894873,
                                 0.852944361266383, -0.383484103421995, -0.361640047587030,
                                -0.784122972172792, -0.829081316075926, -0.135045085816479,
                                 0.400210257158812,  0.424088132665095,  0.809910487878897,
                                -0.157137199597269, -0.285866634582259, -0.257097027371984,
                                -0.182426358967875,  0.592284084053905,  0.281754777944745,
                                -0.352064821080670, -0.131528749037602, -0.264070787599440,
                                -0.097561798012956,  0.493092875272960,  0.402331448666658,
                                 13.490419626365505,  3.010048625676243, -0.296705465385671,
                                -0.298831447798231,  0.312268517981674,  0.260223618317406,
                                -0.126382471572996, -0.099134899310950, -0.092993848915402,
                                -0.072668608369278,  0.685414928047913,  0.699000139804297,
                                 3.010048625676243,  4.400000000000008,  0.372981662261678,
                                 0.400503045076571,  0.835471988855432,  0.275698527671934,
                                 0.227658487689543,  0.074150612871725, -1.567095181630578,
                                -0.562191362735592,  0.419729100464570,  0.560737246870394,
                                 13.490419626365505,  3.010048625676241,  0.757386217097465,
                                 0.797819289006429,  0.195985989013831,  0.113223420767253,
                                 0.063762833918466,  0.047262027793558, -0.418839334199311,
                                -0.247526953774421,  1.105999440870389,  1.176213538701439,
                                 3.010048625676241,  4.400000000000005, -0.136557826781754,
                                 0.112157291771219,  0.243134856851496,  0.050948712072497,
                                 0.792162022796458,  0.202208472989091, -0.517606072957056,
                                -0.038017413109283, -0.400147876348109, -0.124639854245898,
                                 13.490419626365512,  3.010048625676243,  0.442795554903378,
                                 0.547524564111694,  0.228096078086399,  0.316102807210830,
                                 0.227481208781143,  0.224319030025026,  0.379965115269757,
                                 0.558180877988574, -0.102694981611263, -0.074276121152713,
                                 3.010048625676243,  4.400000000000006,  0.524384002760691,
                                 0.022216916385825,  0.914491418623875,  0.478108862872020,
                                -0.842044869615841, -0.127034835485232,  0.440012029584408,
                                -0.063557558694224,  1.068299497721442,  0.650310617894873,
                                 13.490419626365505,  3.010048625676243, -0.170959067583629,
                                -0.230042309709750,  0.851841223353363,  0.915649438306478,
                                 0.386164236594171,  0.620819038039185, -0.257446847200739,
                                -0.287923850705804,  0.906917560880519,  0.852944361266383,
                                 3.010048625676243,  4.400000000000007,  2.001736754938371,
                                 0.920361848212789, -0.129495622215146, -0.356947205279593,
                                -0.924477110269492,  0.093490946625245, -0.086330414810097,
                                -0.237964803519729, -0.834056981224321, -0.383484103421995,
                                 13.490419626365515,  3.010048625676241,  1.028030554167600,
                                 0.867936114208874, -0.831993073061527, -0.928138128642654,
                                 0.736650267105162,  0.934978237760701, -0.554662048707685,
                                -0.618758752428436, -0.428346064236500, -0.361640047587030,
                                 3.010048625676241,  4.400000000000006, -0.640251304983947,
                                -0.492548465785578,  0.440012029584408, -0.063557558694225,
                                -0.561363246410561, -0.084689890323488,  0.547814727303535,
                                 0.531073495117207, -1.663417871230950, -0.784122972172792,
                                 13.490419626365505,  3.010048625676243, -0.756807031763963,
                                -0.735741077412131, -0.257446847200739, -0.287923850705804,
                                 0.257442824396114,  0.413879358692790,  1.066380262687312,
                                 1.155585980561315, -0.938190660846026, -0.829081316075926,
                                 3.010048625676243,  4.400000000000007, -0.400147876348108,
                                -0.124639854245898,  0.782298580427347,  0.072349557474691,
                                -0.330067509498524, -0.084253530412121, -1.109737959107765,
                                -0.124526692461812, -0.930184448205503, -0.135045085816479,
                                 13.490419626365512,  3.010048625676241, -0.102694981611263,
                                -0.074276121152713, -0.391311414711805, -0.583388878140273,
                                -0.094783836992142, -0.093466262510428,  0.286088275234642,
                                 0.444943696875068,  0.239117174707705,  0.400210257158812,
                                 3.010048625676241,  4.400000000000006, -0.822757146735023,
                                -0.676149519742105,  0.932258092322669,  0.418010053058710,
                                -1.163587825968776, -0.378992021344370,  0.205925208625088,
                                 0.132718728909025,  0.455342502538051,  0.424088132665095,
                                 13.490419626365505,  3.010048625676241, -1.192751572325253,
                                -1.235381126626550,  0.344162465454554,  0.212441075416471,
                                -0.325898928916603, -0.241561475389296,  0.121931427508613,
                                 0.078429924728952,  0.775114458366297,  0.809910487878897,
                                 3.010048625676241,  4.400000000000005, -0.529025057369457,
                                -0.412621091889686, -0.020913076926763,  0.015952997233216,
                                -0.349130947571665, -0.130432676128956,  0.650521992717551,
                                 0.298431953313469, -0.168785444562356, -0.157137199597269,
                                 13.490419626365513,  3.010048625676242, -0.693149360957834,
                                -0.704275257908879,  0.031650828481282,  0.030830805720981,
                                -0.125329284309888, -0.098308775150026,  0.324804277601377,
                                 0.268773387032804, -0.277696321700056, -0.285866634582259,
                                 3.010048625676242,  4.400000000000006};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,
                              17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 27, 27, 27};

    std::vector<int32_t> cols{0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 24, 25, 26, 27, 0, 1, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                              27, 2, 3, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 24, 25, 26, 27, 2, 3, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                              26, 27, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 24, 25, 26, 27, 4, 5, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 6, 7, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 6, 7, 10,
                              11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
                              24, 25, 26, 27, 8, 9, 10, 11, 12, 13, 14, 15, 16,
                              17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              14, 15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14, 15, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              18, 19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22, 23, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 24, 25, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 26, 27};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 28, 28, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeGDForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 2);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 8.581248210846821,  2.528100795265542, -0.310789884377173,
                                -0.357346676328000,  0.479420856613856,  0.777565834863954,
                                -0.125722279617883,  0.204902174853861,  0.557287637384807,
                                 0.058681157478634,  2.318428489598826,  1.831784487104253,
                                -0.785484715561511, -0.965984218114940, -0.449105785719110,
                                -0.251295095563362, -1.013002988374031, -1.318864955098854,
                                -0.647663621922008, -0.806650636417890,  2.528100795265542,
                                 2.800000000000002, -0.127855721935095, -0.199220965198820,
                                 0.328992456237362,  0.531879526004286,  0.198131236907314,
                                 0.365016376074463, -0.078192118357363, -0.153361539806500,
                                 0.430686048451730,  0.578624076139249, -0.324352898308477,
                                -0.490494051608087, -0.041999955377216, -0.049517414101809,
                                -0.516469404445673, -0.823587417751033, -0.299171998129500,
                                -0.469516838605919,  8.581248210846820,  2.528100795265542,
                                 0.688657424908704,  0.560606760466117,  0.943555685855728,
                                 0.556513356576250,  0.257083612333474,  0.095947936509029,
                                 1.059841019860171,  0.936583678151993, -0.210136931954208,
                                -0.683750559940484,  0.446409645176470, -0.111086549599765,
                                 0.850462574433806,  0.172017211752185,  1.082641773427234,
                                 0.837418149349519, -0.017949529728719,  0.030441123699770,
                                 2.528100795265542,  2.800000000000002,  0.130607406931325,
                                 0.173482412211604,  0.078166293171723,  0.075482280511502,
                                 0.104063277535918,  0.210735204807220,  0.370794107704183,
                                 0.610432958870985, -0.365144203655639, -0.618758752428436,
                                -0.113484823934896, -0.191949233803869, -0.182412228100041,
                                -0.388925918760182,  0.138680062549161,  0.141627383610981,
                                 0.013613535751713,  0.020553870480654,  8.581248210846823,
                                 2.528100795265543, -0.400514303086986, -0.263507542503190,
                                 0.256308406199630,  0.149251880481751,  0.873550289178509,
                                 0.407004530767579, -0.929658210930598, -0.282429773801929,
                                -0.960062597635986,  0.144736819978090, -0.619772140620399,
                                -0.188286515867952, -0.363979287157712, -0.169585221153158,
                                -1.310020742798106, -0.762842944684504, -0.397176683894595,
                                -0.261311646315664,  2.528100795265543,  2.800000000000002,
                                -0.052338763824297, -0.066089932873967,  0.026174016819679,
                                 0.031508018529039,  0.097147922147739,  0.149546020016684,
                                 0.183114800575792,  0.413879358692791,  0.331891023937895,
                                 0.623318825173802,  0.122076533717195,  0.275919572461860,
                                -0.040478300894891, -0.062310841673618, -0.133778308189473,
                                -0.161040983592864, -0.051902607459094, -0.065539183433350,
                                 8.581248210846820,  2.528100795265542, -0.300142287100636,
                                -0.195527300679088, -1.781986076756531, -1.132219277416668,
                                -0.565211499141340, -0.099108184863939,  0.446409645176470,
                                -0.111086549599765, -0.140091287969472, -0.455833706626989,
                                 0.687832982213113,  1.029155802818464, -1.200866328050239,
                                -0.276698200919778,  0.250039251720841,  0.264168904576327,
                                 0.753661112769979,  0.594342964136933,  2.528100795265542,
                                 2.800000000000002, -0.038488264823816, -0.048445738912852,
                                -0.167626240692932, -0.165017969182947,  0.176339002300927,
                                 0.372120585325716, -0.113484823934896, -0.191949233803869,
                                -0.243429469103759, -0.412505834952290,  0.465364794316597,
                                 0.770390653707542,  0.135104209398062,  0.296629131250045,
                                 0.049461333179150,  0.052286616485968,  0.135690684899158,
                                 0.179182258021869,  8.581248210846818,  2.528100795265543,
                                 0.607557024642473,  0.785835750695509,  0.563153226934060,
                                 1.085397844654378, -0.449105785719110, -0.251295095563362,
                                 1.271909567053129,  1.282186004414808, -0.966011870666177,
                                -0.763243536293438, -1.928883825794568, -1.557461305831800,
                                -1.016448754627452, -0.293499764680140,  0.571349953591538,
                                 0.825276031638202, -0.212218718358027, -0.306189318302583,
                                 2.528100795265543,  2.800000000000001,  0.296035668653072,
                                 0.466000093202865,  0.481291225231548,  0.784142359134293,
                                -0.041999955377217, -0.049517414101809,  0.386472314540207,
                                 0.568629574177588, -0.179452520188221, -0.241093365058020,
                                -0.395691356875094, -0.552720877383950,  0.114831325409168,
                                 0.266806838105876,  0.336181296880785,  0.539940325252598,
                                -0.120147472557642, -0.190577756388172, -0.310789884377173,
                                -0.127855721935095,  0.688657424908704,  0.130607406931325,
                                -0.400514303086986, -0.052338763824297, -0.300142287100636,
                                -0.038488264823816,  0.607557024642473,  0.296035668653072,
                                 11.355406609492883,  6.810469165524211, -0.357346676328000,
                                -0.199220965198820,  0.560606760466117,  0.173482412211604,
                                -0.263507542503190, -0.066089932873967, -0.195527300679088,
                                -0.048445738912852,  0.785835750695509,  0.466000093202865,
                                 6.810469165524211,  6.600000000000006,  0.479420856613856,
                                 0.328992456237362,  0.943555685855728,  0.078166293171723,
                                 0.256308406199630,  0.026174016819679, -1.781986076756531,
                                -0.167626240692932,  0.563153226934060,  0.481291225231548,
                                 11.355406609492880,  6.810469165524206,  0.777565834863954,
                                 0.531879526004286,  0.556513356576250,  0.075482280511502,
                                 0.149251880481751,  0.031508018529039, -1.132219277416668,
                                -0.165017969182947,  1.085397844654378,  0.784142359134293,
                                 6.810469165524206,  6.599999999999996, -0.125722279617883,
                                 0.198131236907314,  0.257083612333474,  0.104063277535918,
                                 0.873550289178509,  0.097147922147739, -0.565211499141340,
                                 0.176339002300927, -0.449105785719110, -0.041999955377217,
                                 11.355406609492881,  6.810469165524210,  0.204902174853861,
                                 0.365016376074463,  0.095947936509029,  0.210735204807220,
                                 0.407004530767579,  0.149546020016684, -0.099108184863939,
                                 0.372120585325716, -0.251295095563362, -0.049517414101809,
                                 6.810469165524210,  6.599999999999999,  0.557287637384807,
                                -0.078192118357363,  1.059841019860171,  0.370794107704183,
                                -0.929658210930598,  0.183114800575792,  0.446409645176470,
                                -0.113484823934896,  1.271909567053129,  0.386472314540207,
                                 11.355406609492887,  6.810469165524212,  0.058681157478634,
                                -0.153361539806500,  0.936583678151993,  0.610432958870985,
                                -0.282429773801929,  0.413879358692791, -0.111086549599765,
                                -0.191949233803869,  1.282186004414808,  0.568629574177588,
                                 6.810469165524212,  6.600000000000001,  2.318428489598826,
                                 0.430686048451730, -0.210136931954208, -0.365144203655639,
                                -0.960062597635986,  0.331891023937895, -0.140091287969472,
                                -0.243429469103759, -0.966011870666177, -0.179452520188221,
                                 11.355406609492883,  6.810469165524212,  1.831784487104253,
                                 0.578624076139249, -0.683750559940484, -0.618758752428436,
                                 0.144736819978090,  0.623318825173802, -0.455833706626989,
                                -0.412505834952290, -0.763243536293438, -0.241093365058020,
                                 6.810469165524212,  6.599999999999996, -0.785484715561511,
                                -0.324352898308477,  0.446409645176470, -0.113484823934896,
                                -0.619772140620399,  0.122076533717195,  0.687832982213113,
                                 0.465364794316597, -1.928883825794568, -0.395691356875094,
                                 11.355406609492887,  6.810469165524212, -0.965984218114940,
                                -0.490494051608087, -0.111086549599765, -0.191949233803869,
                                -0.188286515867952,  0.275919572461860,  1.029155802818464,
                                 0.770390653707542, -1.557461305831800, -0.552720877383950,
                                 6.810469165524212,  6.600000000000001, -0.449105785719110,
                                -0.041999955377216,  0.850462574433806, -0.182412228100041,
                                -0.363979287157712, -0.040478300894891, -1.200866328050239,
                                 0.135104209398062, -1.016448754627452,  0.114831325409168,
                                 11.355406609492883,  6.810469165524209, -0.251295095563362,
                                -0.049517414101809,  0.172017211752185, -0.388925918760182,
                                -0.169585221153158, -0.062310841673618, -0.276698200919778,
                                 0.296629131250045, -0.293499764680140,  0.266806838105876,
                                 6.810469165524209,  6.599999999999995, -1.013002988374031,
                                -0.516469404445673,  1.082641773427234,  0.138680062549161,
                                -1.310020742798106, -0.133778308189473,  0.250039251720841,
                                 0.049461333179150,  0.571349953591538,  0.336181296880785,
                                 11.355406609492880,  6.810469165524206, -1.318864955098854,
                                -0.823587417751033,  0.837418149349519,  0.141627383610981,
                                -0.762842944684504, -0.161040983592864,  0.264168904576327,
                                 0.052286616485968,  0.825276031638202,  0.539940325252598,
                                 6.810469165524206,  6.599999999999996, -0.647663621922008,
                                -0.299171998129500, -0.017949529728719,  0.013613535751713,
                                -0.397176683894595, -0.051902607459094,  0.753661112769979,
                                 0.135690684899158, -0.212218718358027, -0.120147472557642,
                                 11.355406609492885,  6.810469165524213, -0.806650636417890,
                                -0.469516838605919,  0.030441123699770,  0.020553870480654,
                                -0.261311646315664, -0.065539183433350,  0.594342964136933,
                                 0.179182258021869, -0.306189318302583, -0.190577756388172,
                                 6.810469165524213,  6.599999999999999};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,
                              17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 27, 27, 27};

    std::vector<int32_t> cols{0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 24, 25, 26, 27, 0, 1, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                              27, 2, 3, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 24, 25, 26, 27, 2, 3, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                              26, 27, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 24, 25, 26, 27, 4, 5, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 6, 7, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 6, 7, 10,
                              11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
                              24, 25, 26, 27, 8, 9, 10, 11, 12, 13, 14, 15, 16,
                              17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              14, 15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14, 15, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              18, 19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22, 23, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 24, 25, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 26, 27};

    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 28, 28, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeFGForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 4);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 9.280343182967972,  5.757046560354534, -0.157946769558291,
                                -0.466157884663106,  0.697319234941867, -0.200879266411656,
                                 0.477501104302009,  0.566005650187694,  1.233437957382973,
                                 0.410489747758071,  0.388461888867318,  0.105139132372341,
                                -2.181342084265103, -0.839491071476022,  0.486500743472090,
                                 0.817831888007603, -0.042655078877174, -0.004539072305670,
                                 0.219097334253833,  0.697340239971966,  5.757046560354534,
                                 5.400000000000003, -0.269428061793475, -0.638995222368251,
                                 0.225769205351185, -0.471410886588977,  0.503242724588272,
                                 0.661073471727711,  0.578528188388370,  0.404739976182054,
                                 0.166122998995335,  0.097717469516125, -1.116840210896646,
                                -0.846416632052546,  0.687747742603155,  0.966642801559707,
                                -0.011083534268147, -0.003376119273120,  0.399510995002632,
                                 0.957082169969761,  9.280343182967970,  5.757046560354532,
                                -0.564698085528606, -0.325982455081608,  0.615636768315310,
                                 0.339674655542103, -0.192841722621731, -0.368477417062239,
                                 0.721217865417116,  0.244937754479793,  0.908507510776290,
                                -0.360723192163488,  0.105538652257073,  0.425880103067922,
                                -0.394914314670962, -0.006993821065020, -1.306158466333221,
                                -0.530873898037076, -1.174321070704527, -0.763101924788644,
                                 5.757046560354532,  5.400000000000002, -0.363764597333761,
                                -0.351864192649567,  0.482116269194033,  0.283496151527200,
                                -0.101981453204950, -0.628868718757682,  0.239566581322108,
                                 0.306997745708174, -0.052079097691880, -0.500286694788525,
                                 0.240294175966556,  0.569716987590909, -0.063993775008124,
                                 0.004058359475069, -0.801268755405695, -0.436014436644099,
                                -0.826015695672093, -0.830151654979628,  9.280343182967972,
                                 5.757046560354533,  1.021611928277175,  0.370235017431329,
                                 0.961606658454947,  0.096192166860231,  0.838290794356735,
                                 0.392271025985639,  1.456123744831449,  0.275469619389977,
                                -1.074765145283086, -0.034979524570495, -0.128040516873724,
                                 0.120180105389140, -0.413112884912023, -0.515174834914072,
                                 0.846823725746854,  0.110411742617902, -0.063155845384261,
                                 0.031721232801561,  5.757046560354533,  5.400000000000003,
                                 0.513524513769912,  0.365200131868166,  0.277138918532107,
                                 0.052432972210250,  0.451651363288089,  0.396881687762414,
                                 0.747696751265685,  0.012001669452848, -0.358085534376306,
                                 0.116064526599025, -0.009257538366865,  0.188228952079505,
                                -0.553815404778662, -0.505466650261384,  0.324111530891510,
                                 0.045508567479662,  0.018094699089199,  0.037804001593805,
                                 9.280343182967972,  5.757046560354533, -0.647625294717421,
                                -0.140706883261673,  0.297418101951469,  0.021367696697587,
                                 0.450602829023264, -0.138877615900874, -0.450436042812517,
                                 0.300653932599375,  0.688074505539940,  0.348971006621484,
                                -0.300290695208345,  0.200435955066250, -0.187751178759693,
                                 0.057865673292031, -1.520136965529727, -0.109212672009890,
                                -0.642228417261442, -0.139534325901159,  5.757046560354533,
                                 5.400000000000001, -0.247429280407675, -0.123634418951594,
                                 0.079589521202462,  0.006163954198515, -0.035412723339702,
                                -0.180166621755760,  0.234500599317799,  0.286638556539652,
                                 0.751606843651232,  0.087704200954398,  0.156333732878532,
                                 0.191092371026435,  0.014755301391543,  0.075069425731567,
                                -0.406790886145914, -0.031504654792409, -0.245367369737612,
                                -0.122604132126997,  9.280343182967972,  5.757046560354533,
                                -0.484826760940715, -0.116544799290870, -1.711339852696569,
                                -0.181683611166218,  0.607956724901965,  0.532074458928930,
                                -0.128040516873724,  0.120180105389140, -0.716510096855391,
                                -0.023319683046996,  1.562824175559552,  0.175319531565694,
                                -0.157577721147410,  0.305895169909696,  0.104294832563146,
                                 0.025514230549819,  1.133594973455813,  0.387569146596649,
                                 5.757046560354533,  5.400000000000004, -0.189711341942950,
                                -0.107903138049471, -0.525899621770532, -0.093041446666015,
                                 0.582352706352540,  0.526202622888054, -0.009257538366865,
                                 0.188228952079505, -0.238723689584204,  0.077376351066017,
                                 0.755411366571406, -0.144855790613406,  0.305794044132712,
                                 0.290897827670544,  0.077032395077077,  0.005296200350450,
                                 0.548595251505520,  0.379525248530798,  9.280343182967970,
                                 5.757046560354533,  1.100440306888403,  0.755240020935994,
                                 0.720328008962522,  0.498173736267381, -0.394914314670962,
                                -0.006993821065020,  0.187347791503508, -0.443422144472392,
                                -0.378544796156788,  0.150301330068120, -0.775757291581406,
                                 0.334597077213749, -0.976088446719140, -0.382348495507862,
                                 0.735354215215185,  0.346357100660868, -0.383119155135115,
                                -0.306660022303658,  5.757046560354533,  5.400000000000003,
                                 0.806818451192233,  0.824304044866172,  0.681724324857122,
                                 0.419527731557125, -0.063993775008124,  0.004058359475069,
                                -0.204577467161575, -0.602483098299503,  0.021699624038283,
                                 0.208452789495219,  0.057014514096646,  0.474468978218767,
                                -0.228902440304396, -0.620819639132129,  0.506545784314512,
                                 0.286865293940283, -0.316582963859708, -0.337492348952849,
                                 9.280343182967972,  5.757046560354534, -0.189631066490196,
                                -0.694204634002451, -0.042655078877174, -0.004539072305670,
                                -1.149115695402581, -0.907746973044033,  1.052488441578101,
                                 0.628354371268271, -1.985471876432957, -0.537377787680854,
                                 0.113991428385028,  0.201112520052052,  0.612909854947772,
                                 0.584380257180064,  0.906988523625561, -0.178567642880160,
                                -0.114538830937729, -0.461538697986505,  5.757046560354534,
                                 5.400000000000003, -0.391854453340780, -0.954749935752350,
                                -0.011083534268147, -0.003376119273119, -0.881315170307086,
                                -1.038650247941444,  0.723177252584411,  0.665316181640398,
                                -0.849073105976153, -0.499444844193527,  0.188145754728737,
                                 0.225148696190007,  0.542799217351889,  0.675788561273057,
                                 0.280249862925286, -0.454815710934875, -0.258148903768800,
                                -0.635559514779824, -0.157946769558291, -0.269428061793475,
                                -0.564698085528606, -0.363764597333761,  1.021611928277175,
                                 0.513524513769912, -0.647625294717421, -0.247429280407675,
                                -0.484826760940715, -0.189711341942950,  1.100440306888403,
                                 0.806818451192233, -0.189631066490196, -0.391854453340780,
                                 13.490419626365505,  3.010048625676243, -0.466157884663106,
                                -0.638995222368251, -0.325982455081608, -0.351864192649567,
                                 0.370235017431329,  0.365200131868166, -0.140706883261673,
                                -0.123634418951594, -0.116544799290870, -0.107903138049471,
                                 0.755240020935994,  0.824304044866172, -0.694204634002451,
                                -0.954749935752350,  3.010048625676243,  4.400000000000008,
                                 0.697319234941867,  0.225769205351185,  0.615636768315310,
                                 0.482116269194033,  0.961606658454947,  0.277138918532107,
                                 0.297418101951469,  0.079589521202462, -1.711339852696569,
                                -0.525899621770532,  0.720328008962522,  0.681724324857122,
                                -0.042655078877174, -0.011083534268147,  13.490419626365505,
                                 3.010048625676241, -0.200879266411656, -0.471410886588977,
                                 0.339674655542103,  0.283496151527200,  0.096192166860231,
                                 0.052432972210250,  0.021367696697587,  0.006163954198515,
                                -0.181683611166218, -0.093041446666015,  0.498173736267381,
                                 0.419527731557125, -0.004539072305670, -0.003376119273119,
                                 3.010048625676241,  4.400000000000005,  0.477501104302009,
                                 0.503242724588272, -0.192841722621731, -0.101981453204950,
                                 0.838290794356735,  0.451651363288089,  0.450602829023264,
                                -0.035412723339702,  0.607956724901965,  0.582352706352540,
                                -0.394914314670962, -0.063993775008124, -1.149115695402581,
                                -0.881315170307086,  13.490419626365512,  3.010048625676243,
                                 0.566005650187694,  0.661073471727711, -0.368477417062239,
                                -0.628868718757682,  0.392271025985639,  0.396881687762414,
                                -0.138877615900874, -0.180166621755760,  0.532074458928930,
                                 0.526202622888054, -0.006993821065020,  0.004058359475069,
                                -0.907746973044033, -1.038650247941444,  3.010048625676243,
                                 4.400000000000006,  1.233437957382973,  0.578528188388370,
                                 0.721217865417116,  0.239566581322108,  1.456123744831449,
                                 0.747696751265685, -0.450436042812517,  0.234500599317799,
                                -0.128040516873724, -0.009257538366865,  0.187347791503508,
                                -0.204577467161575,  1.052488441578101,  0.723177252584411,
                                 13.490419626365505,  3.010048625676243,  0.410489747758071,
                                 0.404739976182054,  0.244937754479793,  0.306997745708174,
                                 0.275469619389977,  0.012001669452848,  0.300653932599375,
                                 0.286638556539652,  0.120180105389140,  0.188228952079505,
                                -0.443422144472392, -0.602483098299503,  0.628354371268271,
                                 0.665316181640398,  3.010048625676243,  4.400000000000007,
                                 0.388461888867318,  0.166122998995335,  0.908507510776290,
                                -0.052079097691880, -1.074765145283086, -0.358085534376306,
                                 0.688074505539940,  0.751606843651232, -0.716510096855391,
                                -0.238723689584204, -0.378544796156788,  0.021699624038283,
                                -1.985471876432957, -0.849073105976153,  13.490419626365515,
                                 3.010048625676241,  0.105139132372341,  0.097717469516125,
                                -0.360723192163488, -0.500286694788525, -0.034979524570495,
                                 0.116064526599025,  0.348971006621484,  0.087704200954398,
                                -0.023319683046996,  0.077376351066017,  0.150301330068120,
                                 0.208452789495219, -0.537377787680854, -0.499444844193527,
                                 3.010048625676241,  4.400000000000006, -2.181342084265103,
                                -1.116840210896646,  0.105538652257073,  0.240294175966556,
                                -0.128040516873724, -0.009257538366865, -0.300290695208345,
                                 0.156333732878532,  1.562824175559552,  0.755411366571406,
                                -0.775757291581406,  0.057014514096646,  0.113991428385028,
                                 0.188145754728737,  13.490419626365505,  3.010048625676243,
                                -0.839491071476022, -0.846416632052546,  0.425880103067922,
                                 0.569716987590909,  0.120180105389140,  0.188228952079505,
                                 0.200435955066250,  0.191092371026435,  0.175319531565694,
                                -0.144855790613406,  0.334597077213749,  0.474468978218767,
                                 0.201112520052052,  0.225148696190007,  3.010048625676243,
                                 4.400000000000007,  0.486500743472090,  0.687747742603155,
                                -0.394914314670962, -0.063993775008124, -0.413112884912023,
                                -0.553815404778662, -0.187751178759693,  0.014755301391543,
                                -0.157577721147410,  0.305794044132712, -0.976088446719140,
                                -0.228902440304396,  0.612909854947772,  0.542799217351889,
                                 13.490419626365512,  3.010048625676241,  0.817831888007603,
                                 0.966642801559707, -0.006993821065020,  0.004058359475069,
                                -0.515174834914072, -0.505466650261384,  0.057865673292031,
                                 0.075069425731567,  0.305895169909696,  0.290897827670544,
                                -0.382348495507862, -0.620819639132129,  0.584380257180064,
                                 0.675788561273057,  3.010048625676241,  4.400000000000006,
                                -0.042655078877174, -0.011083534268147, -1.306158466333221,
                                -0.801268755405695,  0.846823725746854,  0.324111530891510,
                                -1.520136965529727, -0.406790886145914,  0.104294832563146,
                                 0.077032395077077,  0.735354215215185,  0.506545784314512,
                                 0.906988523625561,  0.280249862925286,  13.490419626365505,
                                 3.010048625676241, -0.004539072305670, -0.003376119273120,
                                -0.530873898037076, -0.436014436644099,  0.110411742617902,
                                 0.045508567479662, -0.109212672009890, -0.031504654792409,
                                 0.025514230549819,  0.005296200350450,  0.346357100660868,
                                 0.286865293940283, -0.178567642880160, -0.454815710934875,
                                 3.010048625676241,  4.400000000000005,  0.219097334253833,
                                 0.399510995002632, -1.174321070704527, -0.826015695672093,
                                -0.063155845384261,  0.018094699089199, -0.642228417261442,
                                -0.245367369737612,  1.133594973455813,  0.548595251505520,
                                -0.383119155135115, -0.316582963859708, -0.114538830937729,
                                -0.258148903768800,  13.490419626365513,  3.010048625676242,
                                 0.697340239971966,  0.957082169969761, -0.763101924788644,
                                -0.830151654979628,  0.031721232801561,  0.037804001593805,
                                -0.139534325901159, -0.122604132126997,  0.387569146596649,
                                 0.379525248530798, -0.306660022303658, -0.337492348952849,
                                -0.461538697986505, -0.635559514779824,  3.010048625676242,
                                 4.400000000000006};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14,
                              14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27,
                              27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28,
                              28, 28, 28, 28, 28, 29, 29, 29, 29, 29, 29, 29, 29,
                              29, 29, 29, 29, 29, 29, 29, 29, 30, 30, 30, 30, 30,
                              30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 31, 31,
                              31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                              31};

    std::vector<int32_t> cols{0, 1, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 28, 29, 30, 31, 0, 1, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
                              31, 2, 3, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
                              24, 25, 26, 27, 28, 29, 30, 31, 2, 3, 14, 15, 16,
                              17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
                              30, 31, 4, 5, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 24, 25, 26, 27, 28, 29, 30, 31, 4, 5, 14, 15,
                              16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28,
                              29, 30, 31, 6, 7, 14, 15, 16, 17, 18, 19, 20, 21,
                              22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 6, 7, 14,
                              15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,
                              28, 29, 30, 31, 8, 9, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 8, 9,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                              27, 28, 29, 30, 31, 10, 11, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 10,
                              11, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                              26, 27, 28, 29, 30, 31, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 28, 29, 30, 31, 0, 1, 2, 3, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1, 2, 3, 4,
                              5, 6, 7, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1, 2, 3,
                              4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 18, 19, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 20, 21, 0,
                              1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 20, 21,
                              0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 22,
                              23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
                              13, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
                              12, 13, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                              11, 12, 13, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8,
                              9, 10, 11, 12, 13, 28, 29, 0, 1, 2, 3, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 28, 29, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 10, 11, 12, 13, 30, 31, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 30, 31};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 32, 32, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeGFForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 3);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 11.035325809057101,  2.825783659608886,  0.184328489526923,
                                 0.372218242529267, -0.742884711794213, -0.326131992611388,
                                -0.536958277196918, -0.701779780093292, -1.319160308447654,
                                -0.815677318887998, -0.413981086074508, -0.234700009168212,
                                 2.342395843418173,  1.572579670340961, -0.563941524105369,
                                -0.957247539580819,  0.044683764470836,  0.015793482742856,
                                -0.257822256687588, -0.551728280898521,  2.825783659608886,
                                 3.600000000000001,  0.311744222044338,  0.521737414292829,
                                 0.143407000245927,  0.384905377112008, -0.373358771258461,
                                -0.539764229407697, -0.266812559717889, -0.330468806717416,
                                -0.068015534462517, -0.079785979756825,  0.546714522383383,
                                 0.691096286111266, -0.540111603189660, -0.789260542451899,
                                 0.002884869613486,  0.002756589843306, -0.466410931190827,
                                -0.781454319447199,  11.035325809057095,  2.825783659608886,
                                 0.613358595707798,  0.510203343610698, -0.679996243628796,
                                -0.676916033339744,  0.201394427307996,  0.139324611969954,
                                -0.757921148375210, -0.337084670944434, -0.925989007661265,
                                 0.060611644186298, -0.127764702069294, -0.330996051046759,
                                 0.409437646916564,  0.092308964231217,  1.418545062001647,
                                 1.127274244662477,  1.282500064380729,  1.157487816591675,
                                 2.825783659608886,  3.600000000000000,  0.213555220149116,
                                 0.287295910249266, -0.218935231510605, -0.231473638428127,
                                 0.251417182733651,  0.513469158718047, -0.162264994112707,
                                -0.250662609723244,  0.242410752577289,  0.408482375778464,
                                -0.284398732695293, -0.465171972464421,  0.003862674504106,
                                -0.003313636635569,  0.341657817119066,  0.356004296755035,
                                 0.500294134362273,  0.677815987942359,  11.035325809057101,
                                 2.825783659608886, -1.096428848726412, -0.723571201050187,
                                -1.011300921621369, -0.394941821226799, -0.900292683641005,
                                -0.633344721902684, -1.569430962075086, -1.056471902677355,
                                 1.138091873192165,  0.510627056375780,  0.134937962480680,
                                 0.016879740411486,  0.478681687927967,  0.772901535177403,
                                -0.900861027567096, -0.460800407568730,  0.062574949147090,
                                -0.024591708091914,  2.825783659608886,  3.600000000000000,
                                -0.240688240371640, -0.298184659024712, -0.060161095794150,
                                -0.042811342537547, -0.256081447414162, -0.324052541090836,
                                -0.167738299145436, -0.009799322073675,  0.015514068559474,
                                -0.094766289135099, -0.081774698051687, -0.153688295804525,
                                 0.335869290612154,  0.412711791711410, -0.068415564207485,
                                -0.037157589750063, -0.021001984064259, -0.030866838046728,
                                 11.035325809057099,  2.825783659608884,  0.687154624282518,
                                 0.350276936048548, -0.312199651281769, -0.113674526354245,
                                -0.456713533877746,  0.044739671757408,  0.435475675083160,
                                -0.321388006972768, -0.788088508709087, -1.056790398591652,
                                 0.290317116722107, -0.214258671315179,  0.190297305782394,
                                -0.018641529898920,  1.595687106551265,  0.581003134699473,
                                 0.681428335746830,  0.347357961581477,  2.825783659608884,
                                 3.600000000000000,  0.090621638824041,  0.100947080358962,
                                -0.013059628853734, -0.005032847528082,  0.092743269321915,
                                 0.147105430660877, -0.196260493697408, -0.234039401376685,
                                -0.216096696190022, -0.071610180212265, -0.130840329131605,
                                -0.156026267584457, -0.038643028884131, -0.061293929442033,
                                 0.066749214141305,  0.025723442921310,  0.089866458500507,
                                 0.100105854689305,  11.035325809057101,  2.825783659608886,
                                 0.514692950844140,  0.268288459390846,  1.803974154386143,
                                 0.749001569329432, -0.679856458128015, -0.813774353872009,
                                 0.134937962480680,  0.016879740411486,  0.758727915461444,
                                 0.340418037583853, -1.681879264142319, -1.070538353020260,
                                 0.127933919603684, -0.424439204130257, -0.115713737525813,
                                -0.109142335814102, -1.214396493280733, -0.773371877195028,
                                 2.825783659608886,  3.600000000000001,  0.075353480737308,
                                 0.088102543288766,  0.113368857520192,  0.075968023087371,
                                -0.347004570729636, -0.429642642463298, -0.081774698051687,
                                -0.153688295804525,  0.010342712372983, -0.063177526090066,
                                -0.099592717435697,  0.118274257763428, -0.199167793480364,
                                -0.237517081692303, -0.015582413259049, -0.004324329478050,
                                -0.251795246391927, -0.309881067801142,  11.035325809057099,
                                 2.825783659608885, -1.205105514043799, -1.130132702052586,
                                -0.808455918808323, -0.955980869770790,  0.409437646916564,
                                 0.092308964231217, -0.174970404078763,  0.278606764435792,
                                 0.385828753192194, -0.025254851744291,  0.789391616381524,
                                -0.069317206043934,  1.013445760359183,  0.322404057695201,
                                -0.804671076911183, -0.711920709615767,  0.423143728635756,
                                 0.442971872491077,  2.825783659608885,  3.599999999999999,
                                -0.495297393618504, -0.673041434278124, -0.321367517113076,
                                -0.342542958420758,  0.003862674504106, -0.003313636635569,
                                 0.296699105153162,  0.491925389828287, -0.101004480240536,
                                -0.170200989907694, -0.225133564452930, -0.387402298471895,
                                 0.259078153833460,  0.506897112724169, -0.223081657977490,
                                -0.234224531689068,  0.201274583176208,  0.275561349009267,
                                 11.035325809057101,  2.825783659608886,  0.226954566291883,
                                 0.540818091451645,  0.044683764470836,  0.015793482742856,
                                 1.260429675501189,  1.232450495831034, -1.148788746525135,
                                -1.014542141369606,  2.115903328825262,  1.199577824637524,
                                -0.135499937362057, -0.262290102658071, -0.679289189207454,
                                -0.758018910181276, -0.962525921210038, -0.403764208509244,
                                 0.138856059126058,  0.356146005704178,  2.825783659608886,
                                 3.600000000000001,  0.464418053842297,  0.779550058182760,
                                 0.002884869613486,  0.002756589843306,  0.597580939217312,
                                 0.848054376223924, -0.411010723920264, -0.543228387545275,
                                 0.347634953919531,  0.407795007645995, -0.132239626241963,
                                -0.183833140639475, -0.385102923679521, -0.551779049709518,
                                 0.129226542121668,  0.371355472930538,  0.308808434644411,
                                 0.518932170793810,  0.184328489526923,  0.311744222044338,
                                 0.613358595707798,  0.213555220149116, -1.096428848726412,
                                -0.240688240371640,  0.687154624282518,  0.090621638824041,
                                 0.514692950844140,  0.075353480737308, -1.205105514043799,
                                -0.495297393618504,  0.226954566291883,  0.464418053842297,
                                 11.355406609492883,  6.810469165524211,  0.372218242529267,
                                 0.521737414292829,  0.510203343610698,  0.287295910249266,
                                -0.723571201050187, -0.298184659024712,  0.350276936048548,
                                 0.100947080358962,  0.268288459390846,  0.088102543288766,
                                -1.130132702052586, -0.673041434278124,  0.540818091451645,
                                 0.779550058182760,  6.810469165524211,  6.600000000000006,
                                -0.742884711794213,  0.143407000245927, -0.679996243628796,
                                -0.218935231510605, -1.011300921621369, -0.060161095794150,
                                -0.312199651281769, -0.013059628853734,  1.803974154386143,
                                 0.113368857520192, -0.808455918808323, -0.321367517113076,
                                 0.044683764470836,  0.002884869613486,  11.355406609492880,
                                 6.810469165524206, -0.326131992611388,  0.384905377112008,
                                -0.676916033339744, -0.231473638428127, -0.394941821226799,
                                -0.042811342537547, -0.113674526354245, -0.005032847528082,
                                 0.749001569329432,  0.075968023087371, -0.955980869770790,
                                -0.342542958420758,  0.015793482742856,  0.002756589843306,
                                 6.810469165524206,  6.599999999999996, -0.536958277196918,
                                -0.373358771258461,  0.201394427307996,  0.251417182733651,
                                -0.900292683641005, -0.256081447414162, -0.456713533877746,
                                 0.092743269321915, -0.679856458128015, -0.347004570729636,
                                 0.409437646916564,  0.003862674504106,  1.260429675501189,
                                 0.597580939217312,  11.355406609492881,  6.810469165524210,
                                -0.701779780093292, -0.539764229407697,  0.139324611969954,
                                 0.513469158718047, -0.633344721902684, -0.324052541090836,
                                 0.044739671757408,  0.147105430660877, -0.813774353872009,
                                -0.429642642463298,  0.092308964231217, -0.003313636635569,
                                 1.232450495831034,  0.848054376223924,  6.810469165524210,
                                 6.599999999999999, -1.319160308447654, -0.266812559717889,
                                -0.757921148375210, -0.162264994112707, -1.569430962075086,
                                -0.167738299145436,  0.435475675083160, -0.196260493697408,
                                 0.134937962480680, -0.081774698051687, -0.174970404078763,
                                 0.296699105153162, -1.148788746525135, -0.411010723920264,
                                 11.355406609492887,  6.810469165524212, -0.815677318887998,
                                -0.330468806717416, -0.337084670944434, -0.250662609723244,
                                -1.056471902677355, -0.009799322073675, -0.321388006972768,
                                -0.234039401376685,  0.016879740411486, -0.153688295804525,
                                 0.278606764435792,  0.491925389828287, -1.014542141369606,
                                -0.543228387545275,  6.810469165524212,  6.600000000000001,
                                -0.413981086074508, -0.068015534462517, -0.925989007661265,
                                 0.242410752577289,  1.138091873192165,  0.015514068559474,
                                -0.788088508709087, -0.216096696190022,  0.758727915461444,
                                 0.010342712372983,  0.385828753192194, -0.101004480240536,
                                 2.115903328825262,  0.347634953919531,  11.355406609492883,
                                 6.810469165524212, -0.234700009168212, -0.079785979756825,
                                 0.060611644186298,  0.408482375778464,  0.510627056375780,
                                -0.094766289135099, -1.056790398591652, -0.071610180212265,
                                 0.340418037583853, -0.063177526090066, -0.025254851744291,
                                -0.170200989907694,  1.199577824637524,  0.407795007645995,
                                 6.810469165524212,  6.599999999999996,  2.342395843418173,
                                 0.546714522383383, -0.127764702069294, -0.284398732695293,
                                 0.134937962480680, -0.081774698051687,  0.290317116722107,
                                -0.130840329131605, -1.681879264142319, -0.099592717435697,
                                 0.789391616381524, -0.225133564452930, -0.135499937362057,
                                -0.132239626241963,  11.355406609492887,  6.810469165524212,
                                 1.572579670340961,  0.691096286111266, -0.330996051046759,
                                -0.465171972464421,  0.016879740411486, -0.153688295804525,
                                -0.214258671315179, -0.156026267584457, -1.070538353020260,
                                 0.118274257763428, -0.069317206043934, -0.387402298471895,
                                -0.262290102658071, -0.183833140639475,  6.810469165524212,
                                 6.600000000000001, -0.563941524105369, -0.540111603189660,
                                 0.409437646916564,  0.003862674504106,  0.478681687927967,
                                 0.335869290612154,  0.190297305782394, -0.038643028884131,
                                 0.127933919603684, -0.199167793480364,  1.013445760359183,
                                 0.259078153833460, -0.679289189207454, -0.385102923679521,
                                 11.355406609492883,  6.810469165524209, -0.957247539580819,
                                -0.789260542451899,  0.092308964231217, -0.003313636635569,
                                 0.772901535177403,  0.412711791711410, -0.018641529898920,
                                -0.061293929442033, -0.424439204130257, -0.237517081692303,
                                 0.322404057695201,  0.506897112724169, -0.758018910181276,
                                -0.551779049709518,  6.810469165524209,  6.599999999999995,
                                 0.044683764470836,  0.002884869613486,  1.418545062001647,
                                 0.341657817119066, -0.900861027567096, -0.068415564207485,
                                 1.595687106551265,  0.066749214141305, -0.115713737525813,
                                -0.015582413259049, -0.804671076911183, -0.223081657977490,
                                -0.962525921210038,  0.129226542121668,  11.355406609492880,
                                 6.810469165524206,  0.015793482742856,  0.002756589843306,
                                 1.127274244662477,  0.356004296755035, -0.460800407568730,
                                -0.037157589750063,  0.581003134699473,  0.025723442921310,
                                -0.109142335814102, -0.004324329478050, -0.711920709615767,
                                -0.234224531689068, -0.403764208509244,  0.371355472930538,
                                 6.810469165524206,  6.599999999999996, -0.257822256687588,
                                -0.466410931190827,  1.282500064380729,  0.500294134362273,
                                 0.062574949147090, -0.021001984064259,  0.681428335746830,
                                 0.089866458500507, -1.214396493280733, -0.251795246391927,
                                 0.423143728635756,  0.201274583176208,  0.138856059126058,
                                 0.308808434644411,  11.355406609492885,  6.810469165524213,
                                -0.551728280898521, -0.781454319447199,  1.157487816591675,
                                 0.677815987942359, -0.024591708091914, -0.030866838046728,
                                 0.347357961581477,  0.100105854689305, -0.773371877195028,
                                -0.309881067801142,  0.442971872491077,  0.275561349009267,
                                 0.356146005704178,  0.518932170793810,  6.810469165524213,
                                 6.599999999999999};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14,
                              14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27,
                              27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28,
                              28, 28, 28, 28, 28, 29, 29, 29, 29, 29, 29, 29, 29,
                              29, 29, 29, 29, 29, 29, 29, 29, 30, 30, 30, 30, 30,
                              30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 31, 31,
                              31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                              31};

    std::vector<int32_t> cols{0, 1, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 28, 29, 30, 31, 0, 1, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
                              31, 2, 3, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
                              24, 25, 26, 27, 28, 29, 30, 31, 2, 3, 14, 15, 16,
                              17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
                              30, 31, 4, 5, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 24, 25, 26, 27, 28, 29, 30, 31, 4, 5, 14, 15,
                              16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28,
                              29, 30, 31, 6, 7, 14, 15, 16, 17, 18, 19, 20, 21,
                              22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 6, 7, 14,
                              15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,
                              28, 29, 30, 31, 8, 9, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 8, 9,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                              27, 28, 29, 30, 31, 10, 11, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 10,
                              11, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                              26, 27, 28, 29, 30, 31, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 28, 29, 30, 31, 0, 1, 2, 3, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1, 2, 3, 4,
                              5, 6, 7, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1, 2, 3,
                              4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 18, 19, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 20, 21, 0,
                              1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 20, 21,
                              0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 22,
                              23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
                              13, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
                              12, 13, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                              11, 12, 13, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8,
                              9, 10, 11, 12, 13, 28, 29, 0, 1, 2, 3, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 28, 29, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 10, 11, 12, 13, 30, 31, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 30, 31};
    
    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 32, 32, 1.0e-13));
}

TEST_F(CKineticEnergyIntegralsDriverTest, ComputeGGForLiH)
{
    CKineticEnergyIntegralsDriver kindrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                         MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 4);
    
    auto kinmat = kindrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 11.355406609492883,  6.810469165524211, -0.637022564798955,
                                -0.081205776011079, -0.383238356888778, -0.528270460663179,
                                -0.856255270379485, -0.295992520924920,  1.511439267830460,
                                 0.358393804959383, -0.989597589680544, -0.141511240266340,
                                -0.763475048708038, -0.115701614355616,  1.607436641539384,
                                 0.678567940611368, -0.478951498939479, -0.787360629111529,
                                 0.012330147034673,  0.000648617721663,  6.810469165524211,
                                 6.600000000000006, -0.439213450739592,  0.066396523277455,
                                -0.559069385414888, -0.762786950581587, -0.538980434872312,
                                -0.359589285962450,  0.797717036764468,  0.398767498615420,
                                -0.394531251592382, -0.143708998838687, -0.308157900054620,
                                -0.120573910108205,  1.171642257721966,  0.835045529047782,
                                -0.816026665204027, -1.140101858787724,  0.002902662141124,
                                 0.000524360444197, -0.637022564798955, -0.439213450739592,
                                 13.490419626365505,  3.010048625676243, -0.383238356888778,
                                -0.559069385414888, -0.856255270379486, -0.538980434872312,
                                 1.511439267830460,  0.797717036764468, -0.989597589680544,
                                -0.394531251592381, -0.763475048708038, -0.308157900054620,
                                 1.607436641539385,  1.171642257721965, -0.478951498939480,
                                -0.816026665204027,  0.012330147034673,  0.002902662141124,
                                -0.081205776011079,  0.066396523277455,  3.010048625676243,
                                 4.400000000000008, -0.528270460663179, -0.762786950581587,
                                -0.295992520924920, -0.359589285962451,  0.358393804959383,
                                 0.398767498615420, -0.141511240266339, -0.143708998838687,
                                -0.115701614355616, -0.120573910108205,  0.678567940611368,
                                 0.835045529047782, -0.787360629111529, -1.140101858787723,
                                 0.000648617721663,  0.000524360444197, -0.383238356888778,
                                -0.528270460663179,  11.355406609492880,  6.810469165524206,
                                 0.950156498892115, -0.128856248794283,  0.288710037251968,
                                -0.123253561894742,  0.853186471555649, -0.046757817015380,
                                 0.256033340727951, -0.014814647685693, -1.401466946814470,
                                 0.112305347545748,  0.191770158233951, -0.190580333315011,
                                -0.060913905567718, -0.001618514422920,  0.538711436742773,
                                 0.790504253806001, -0.559069385414888, -0.762786950581587,
                                 6.810469165524206,  6.599999999999996,  0.170756239803886,
                                -0.212869281334357,  0.101633057886128, -0.264790753783246,
                                 0.147166810602756, -0.107247967983888,  0.034157290560970,
                                -0.028377935833154, -0.242054486055867,  0.240565571485207,
                                 0.109637830800878, -0.399892035633363, -0.011166947081006,
                                -0.000877112398328,  0.830094859892198,  1.142643251639213,
                                -0.383238356888778, -0.559069385414888,  0.950156498892115,
                                 0.170756239803886,  13.490419626365505,  3.010048625676241,
                                 0.288710037251968,  0.101633057886128,  0.853186471555649,
                                 0.147166810602756,  0.256033340727951,  0.034157290560970,
                                -1.401466946814469, -0.242054486055867,  0.191770158233951,
                                 0.109637830800878, -0.060913905567719, -0.011166947081006,
                                 0.538711436742773,  0.830094859892197, -0.528270460663179,
                                -0.762786950581587, -0.128856248794283, -0.212869281334357,
                                 3.010048625676241,  4.400000000000005, -0.123253561894742,
                                -0.264790753783246, -0.046757817015380, -0.107247967983888,
                                -0.014814647685693, -0.028377935833154,  0.112305347545748,
                                 0.240565571485207, -0.190580333315011, -0.399892035633363,
                                -0.001618514422919, -0.000877112398327,  0.790504253806001,
                                 1.142643251639214, -0.856255270379486, -0.295992520924920,
                                 0.288710037251968, -0.123253561894742,  11.355406609492881,
                                 6.810469165524210, -0.599522409948277, -0.710548936222001,
                                 1.072664899293402,  0.114803826504725, -0.568018374251979,
                                -0.123478078027342,  1.258111187541444,  0.143829985581815,
                                -0.289972013358058, -0.014597291704476, -0.887678631149257,
                                 0.174141230356942, -1.737196072247894, -0.687791358943226,
                                -0.538980434872312, -0.359589285962451,  0.101633057886128,
                                -0.264790753783246,  6.810469165524210,  6.599999999999999,
                                -0.761716193997376, -0.987617750925904,  0.442934813613588,
                                 0.061312786854424, -0.436024629770185, -0.062119921857192,
                                 0.619188068284343,  0.049976411653896, -0.044875350087569,
                                -0.017930500381100, -0.233109417027465,  0.392088048869013,
                                -1.206986141049861, -0.843154118338054, -0.856255270379485,
                                -0.538980434872312,  0.288710037251968,  0.101633057886128,
                                -0.599522409948277, -0.761716193997376,  13.490419626365512,
                                 3.010048625676243,  1.072664899293402,  0.442934813613588,
                                -0.568018374251979, -0.436024629770185,  1.258111187541444,
                                 0.619188068284343, -0.289972013358058, -0.044875350087570,
                                -0.887678631149256, -0.233109417027465, -1.737196072247894,
                                -1.206986141049861, -0.295992520924920, -0.359589285962450,
                                -0.123253561894742, -0.264790753783246, -0.710548936222001,
                                -0.987617750925904,  3.010048625676243,  4.400000000000006,
                                 0.114803826504725,  0.061312786854424, -0.123478078027341,
                                -0.062119921857192,  0.143829985581815,  0.049976411653896,
                                -0.014597291704476, -0.017930500381100,  0.174141230356942,
                                 0.392088048869013, -0.687791358943226, -0.843154118338055,
                                 1.511439267830460,  0.358393804959383,  0.853186471555649,
                                -0.046757817015380,  1.072664899293402,  0.114803826504725,
                                 11.355406609492887,  6.810469165524212,  0.610789703271671,
                                -0.762657829251167, -0.257799877012967,  0.077112942067537,
                                 0.055421725931208,  0.117129024721686, -1.152845339121847,
                                -0.135317259329234,  0.464973345482458, -0.112430835529568,
                                -0.136075973810664,  0.028044204034386,  0.797717036764468,
                                 0.398767498615420,  0.147166810602756, -0.107247967983888,
                                 0.442934813613588,  0.061312786854424,  6.810469165524212,
                                 6.600000000000001, -0.372776239798070, -1.193373477729954,
                                 0.173327207405923,  0.052341480960432,  0.244653297034545,
                                 0.102299070772889, -0.605623822643531, -0.037378581065574,
                                 0.080973530417104, -0.216174916882127,  0.015686008404445,
                                 0.038737569118648,  1.511439267830460,  0.797717036764468,
                                 0.853186471555649,  0.147166810602756,  1.072664899293402,
                                 0.442934813613588,  0.610789703271671, -0.372776239798070,
                                 13.490419626365505,  3.010048625676243, -0.257799877012966,
                                 0.173327207405923,  0.055421725931207,  0.244653297034545,
                                -1.152845339121846, -0.605623822643531,  0.464973345482458,
                                 0.080973530417104, -0.136075973810664,  0.015686008404445,
                                 0.358393804959383,  0.398767498615420, -0.046757817015380,
                                -0.107247967983888,  0.114803826504725,  0.061312786854424,
                                -0.762657829251167, -1.193373477729954,  3.010048625676243,
                                 4.400000000000007,  0.077112942067538,  0.052341480960432,
                                 0.117129024721687,  0.102299070772889, -0.135317259329234,
                                -0.037378581065574, -0.112430835529568, -0.216174916882127,
                                 0.028044204034387,  0.038737569118648, -0.989597589680544,
                                -0.141511240266339,  0.256033340727951, -0.014814647685693,
                                -0.568018374251979, -0.123478078027341, -0.257799877012966,
                                 0.077112942067538,  11.355406609492883,  6.810469165524212,
                                 0.790988904152923, -0.803910821166806, -0.171866584675311,
                                 0.051408628045025,  0.236674322604991,  0.051449199178059,
                                -1.308614852609528,  0.075719310393543, -0.981350943099873,
                                -0.140331979930786, -0.394531251592381, -0.143708998838687,
                                 0.034157290560970, -0.028377935833154, -0.436024629770185,
                                -0.062119921857192,  0.173327207405923,  0.052341480960432,
                                 6.810469165524212,  6.599999999999996, -0.322400848695530,
                                -1.271333143357078,  0.115551471603949,  0.034894320640288,
                                 0.181676929070910,  0.025883300773830, -0.174581707311624,
                                 0.145042783147230, -0.391243491162445, -0.142511423848365,
                                -0.989597589680544, -0.394531251592382,  0.256033340727951,
                                 0.034157290560970, -0.568018374251979, -0.436024629770185,
                                -0.257799877012967,  0.173327207405923,  0.790988904152923,
                                -0.322400848695530,  13.490419626365515,  3.010048625676241,
                                -0.171866584675311,  0.115551471603949,  0.236674322604991,
                                 0.181676929070911, -1.308614852609528, -0.174581707311624,
                                -0.981350943099873, -0.391243491162445, -0.141511240266340,
                                -0.143708998838687, -0.014814647685693, -0.028377935833154,
                                -0.123478078027342, -0.062119921857192,  0.077112942067537,
                                 0.052341480960432, -0.803910821166806, -1.271333143357078,
                                 3.010048625676241,  4.400000000000006,  0.051408628045025,
                                 0.034894320640288,  0.051449199178059,  0.025883300773830,
                                 0.075719310393543,  0.145042783147230, -0.140331979930786,
                                -0.142511423848365, -0.763475048708038, -0.115701614355616,
                                -1.401466946814469,  0.112305347545748,  1.258111187541444,
                                 0.143829985581815,  0.055421725931207,  0.117129024721687,
                                -0.171866584675311,  0.051408628045025,  11.355406609492887,
                                 6.810469165524212,  0.564604931662331, -0.860265349852572,
                                 0.534639451815459,  0.071294336769308, -0.075503016431929,
                                -0.046882259266001,  1.695267114978335,  0.376307044589517,
                                -0.308157900054620, -0.120573910108205, -0.242054486055867,
                                 0.240565571485207,  0.619188068284343,  0.049976411653896,
                                 0.244653297034545,  0.102299070772889,  0.115551471603949,
                                 0.034894320640288,  6.810469165524212,  6.600000000000001,
                                -0.576653987326857, -1.278622703374029,  0.373606447004995,
                                -0.003076125041444, -0.012571803739018, -0.083060568835835,
                                 0.857485162026313,  0.415491172988495, -0.763475048708038,
                                -0.308157900054620, -1.401466946814470, -0.242054486055867,
                                 1.258111187541444,  0.619188068284343,  0.055421725931208,
                                 0.244653297034545, -0.171866584675311,  0.115551471603949,
                                 0.564604931662331, -0.576653987326857,  13.490419626365505,
                                 3.010048625676243,  0.534639451815458,  0.373606447004995,
                                -0.075503016431930, -0.012571803739018,  1.695267114978335,
                                 0.857485162026312, -0.115701614355616, -0.120573910108205,
                                 0.112305347545748,  0.240565571485207,  0.143829985581815,
                                 0.049976411653896,  0.117129024721686,  0.102299070772889,
                                 0.051408628045025,  0.034894320640288, -0.860265349852572,
                                -1.278622703374029,  3.010048625676243,  4.400000000000007,
                                 0.071294336769308, -0.003076125041444, -0.046882259266001,
                                -0.083060568835834,  0.376307044589516,  0.415491172988495,
                                 1.607436641539385,  0.678567940611368,  0.191770158233951,
                                -0.190580333315011, -0.289972013358058, -0.014597291704476,
                                -1.152845339121846, -0.135317259329234,  0.236674322604991,
                                 0.051449199178059,  0.534639451815458,  0.071294336769308,
                                 11.355406609492883,  6.810469165524209, -1.174633569775093,
                                -0.739500231435878,  0.430922489003504, -0.119894147219894,
                                -0.537341693698546, -0.273323853889495,  1.171642257721965,
                                 0.835045529047782,  0.109637830800878, -0.399892035633363,
                                -0.044875350087570, -0.017930500381100, -0.605623822643531,
                                -0.037378581065574,  0.181676929070911,  0.025883300773830,
                                 0.373606447004995, -0.003076125041444,  6.810469165524209,
                                 6.599999999999995, -0.850718971671055, -1.023179910015086,
                                 0.126865107332767, -0.263195969218338, -0.452114731282615,
                                -0.339660567114982,  1.607436641539384,  1.171642257721966,
                                 0.191770158233951,  0.109637830800878, -0.289972013358058,
                                -0.044875350087569, -1.152845339121847, -0.605623822643531,
                                 0.236674322604991,  0.181676929070910,  0.534639451815459,
                                 0.373606447004995, -1.174633569775093, -0.850718971671055,
                                 13.490419626365512,  3.010048625676241,  0.430922489003504,
                                 0.126865107332768, -0.537341693698546, -0.452114731282615,
                                 0.678567940611368,  0.835045529047782, -0.190580333315011,
                                -0.399892035633363, -0.014597291704476, -0.017930500381100,
                                -0.135317259329234, -0.037378581065574,  0.051449199178059,
                                 0.025883300773830,  0.071294336769308, -0.003076125041444,
                                -0.739500231435878, -1.023179910015086,  3.010048625676241,
                                 4.400000000000006, -0.119894147219894, -0.263195969218337,
                                -0.273323853889495, -0.339660567114982, -0.478951498939480,
                                -0.787360629111529, -0.060913905567719, -0.001618514422919,
                                -0.887678631149256,  0.174141230356942,  0.464973345482458,
                                -0.112430835529568, -1.308614852609528,  0.075719310393543,
                                -0.075503016431930, -0.046882259266001,  0.430922489003504,
                                -0.119894147219894,  11.355406609492880,  6.810469165524206,
                                 1.249576300414597, -0.120900507609159, -0.295203600232724,
                                -0.523639461281841, -0.816026665204027, -1.140101858787723,
                                -0.011166947081006, -0.000877112398327, -0.233109417027465,
                                 0.392088048869013,  0.080973530417104, -0.216174916882127,
                                -0.174581707311624,  0.145042783147230, -0.012571803739018,
                                -0.083060568835834,  0.126865107332768, -0.263195969218337,
                                 6.810469165524206,  6.599999999999996,  0.225646909634435,
                                -0.208557871357071, -0.538344964649262, -0.759043123036372,
                                -0.478951498939479, -0.816026665204027, -0.060913905567718,
                                -0.011166947081006, -0.887678631149257, -0.233109417027465,
                                 0.464973345482458,  0.080973530417104, -1.308614852609528,
                                -0.174581707311624, -0.075503016431929, -0.012571803739018,
                                 0.430922489003504,  0.126865107332767,  1.249576300414597,
                                 0.225646909634435,  13.490419626365505,  3.010048625676241,
                                -0.295203600232724, -0.538344964649262, -0.787360629111529,
                                -1.140101858787724, -0.001618514422920, -0.000877112398328,
                                 0.174141230356942,  0.392088048869013, -0.112430835529568,
                                -0.216174916882127,  0.075719310393543,  0.145042783147230,
                                -0.046882259266001, -0.083060568835835, -0.119894147219894,
                                -0.263195969218338, -0.120900507609159, -0.208557871357071,
                                 3.010048625676241,  4.400000000000005, -0.523639461281841,
                                -0.759043123036371,  0.012330147034673,  0.000648617721663,
                                 0.538711436742773,  0.790504253806001, -1.737196072247894,
                                -0.687791358943226, -0.136075973810664,  0.028044204034387,
                                -0.981350943099873, -0.140331979930786,  1.695267114978335,
                                 0.376307044589516, -0.537341693698546, -0.273323853889495,
                                -0.295203600232724, -0.523639461281841,  11.355406609492885,
                                 6.810469165524213, -0.637228930705207, -0.081216631727848,
                                 0.002902662141124,  0.000524360444197,  0.830094859892197,
                                 1.142643251639214, -1.206986141049861, -0.843154118338055,
                                 0.015686008404445,  0.038737569118648, -0.391243491162445,
                                -0.142511423848365,  0.857485162026312,  0.415491172988495,
                                -0.452114731282615, -0.339660567114982, -0.538344964649262,
                                -0.759043123036371,  6.810469165524213,  6.599999999999999,
                                -0.439262031709601,  0.066387747216799,  0.012330147034673,
                                 0.002902662141124,  0.538711436742773,  0.830094859892198,
                                -1.737196072247894, -1.206986141049861, -0.136075973810664,
                                 0.015686008404445, -0.981350943099873, -0.391243491162445,
                                 1.695267114978335,  0.857485162026313, -0.537341693698546,
                                -0.452114731282615, -0.295203600232724, -0.538344964649262,
                                -0.637228930705207, -0.439262031709601,  13.490419626365513,
                                 3.010048625676242,  0.000648617721663,  0.000524360444197,
                                 0.790504253806001,  1.142643251639213, -0.687791358943226,
                                -0.843154118338054,  0.028044204034386,  0.038737569118648,
                                -0.140331979930786, -0.142511423848365,  0.376307044589517,
                                 0.415491172988495, -0.273323853889495, -0.339660567114982,
                                -0.523639461281841, -0.759043123036372, -0.081216631727848,
                                 0.066387747216799,  3.010048625676242,  4.400000000000006};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14,
                              14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15,
                              16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,
                              17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19,
                              19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27,
                              27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 27, 27, 27, 27, 28, 28, 28, 28, 28, 28, 28,
                              28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28,
                              29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29,
                              29, 29, 29, 29, 29, 29, 29, 30, 30, 30, 30, 30, 30,
                              30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                              30, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                              31, 31, 31, 31, 31, 31, 31, 31, 32, 32, 32, 32, 32,
                              32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
                              32, 32, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33,
                              33, 33, 33, 33, 33, 33, 33, 33, 33, 34, 34, 34, 34,
                              34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34,
                              34, 34, 34, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35,
                              35, 35, 35, 35, 35, 35, 35, 35, 35, 35};

    std::vector<int32_t> cols{0, 1, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22, 23,
                              26, 27, 30, 31, 34, 35, 0, 1, 2, 3, 6, 7, 10, 11,
                              14, 15, 18, 19, 22, 23, 26, 27, 30, 31, 34, 35, 0,
                              1, 2, 3, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25,
                              28, 29, 32, 33, 0, 1, 2, 3, 4, 5, 8, 9, 12, 13, 16,
                              17, 20, 21, 24, 25, 28, 29, 32, 33, 2, 3, 4, 5, 6,
                              7, 10, 11, 14, 15, 18, 19, 22, 23, 26, 27, 30, 31,
                              34, 35, 2, 3, 4, 5, 6, 7, 10, 11, 14, 15, 18, 19,
                              22, 23, 26, 27, 30, 31, 34, 35, 0, 1, 4, 5, 6, 7,
                              8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 28, 29, 32,
                              33, 0, 1, 4, 5, 6, 7, 8, 9, 12, 13, 16, 17, 20, 21,
                              24, 25, 28, 29, 32, 33, 2, 3, 6, 7, 8, 9, 10, 11,
                              14, 15, 18, 19, 22, 23, 26, 27, 30, 31, 34, 35, 2,
                              3, 6, 7, 8, 9, 10, 11, 14, 15, 18, 19, 22, 23, 26,
                              27, 30, 31, 34, 35, 0, 1, 4, 5, 8, 9, 10, 11, 12,
                              13, 16, 17, 20, 21, 24, 25, 28, 29, 32, 33, 0, 1,
                              4, 5, 8, 9, 10, 11, 12, 13, 16, 17, 20, 21, 24, 25,
                              28, 29, 32, 33, 2, 3, 6, 7, 10, 11, 12, 13, 14, 15,
                              18, 19, 22, 23, 26, 27, 30, 31, 34, 35, 2, 3, 6, 7,
                              10, 11, 12, 13, 14, 15, 18, 19, 22, 23, 26, 27, 30,
                              31, 34, 35, 0, 1, 4, 5, 8, 9, 12, 13, 14, 15, 16,
                              17, 20, 21, 24, 25, 28, 29, 32, 33, 0, 1, 4, 5, 8,
                              9, 12, 13, 14, 15, 16, 17, 20, 21, 24, 25, 28, 29,
                              32, 33, 2, 3, 6, 7, 10, 11, 14, 15, 16, 17, 18, 19,
                              22, 23, 26, 27, 30, 31, 34, 35, 2, 3, 6, 7, 10, 11,
                              14, 15, 16, 17, 18, 19, 22, 23, 26, 27, 30, 31, 34,
                              35, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17, 18, 19, 20,
                              21, 24, 25, 28, 29, 32, 33, 0, 1, 4, 5, 8, 9, 12,
                              13, 16, 17, 18, 19, 20, 21, 24, 25, 28, 29, 32, 33,
                              2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 20, 21, 22, 23,
                              26, 27, 30, 31, 34, 35, 2, 3, 6, 7, 10, 11, 14, 15,
                              18, 19, 20, 21, 22, 23, 26, 27, 30, 31, 34, 35, 0,
                              1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 22, 23, 24,
                              25, 28, 29, 32, 33, 0, 1, 4, 5, 8, 9, 12, 13, 16,
                              17, 20, 21, 22, 23, 24, 25, 28, 29, 32, 33, 2, 3,
                              6, 7, 10, 11, 14, 15, 18, 19, 22, 23, 24, 25, 26,
                              27, 30, 31, 34, 35, 2, 3, 6, 7, 10, 11, 14, 15, 18,
                              19, 22, 23, 24, 25, 26, 27, 30, 31, 34, 35, 0, 1,
                              4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 26, 27,
                              28, 29, 32, 33, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17,
                              20, 21, 24, 25, 26, 27, 28, 29, 32, 33, 2, 3, 6, 7,
                              10, 11, 14, 15, 18, 19, 22, 23, 26, 27, 28, 29, 30,
                              31, 34, 35, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22,
                              23, 26, 27, 28, 29, 30, 31, 34, 35, 0, 1, 4, 5, 8,
                              9, 12, 13, 16, 17, 20, 21, 24, 25, 28, 29, 30, 31,
                              32, 33, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21,
                              24, 25, 28, 29, 30, 31, 32, 33, 2, 3, 6, 7, 10, 11,
                              14, 15, 18, 19, 22, 23, 26, 27, 30, 31, 32, 33, 34,
                              35, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22, 23, 26,
                              27, 30, 31, 32, 33, 34, 35, 0, 1, 4, 5, 8, 9, 12,
                              13, 16, 17, 20, 21, 24, 25, 28, 29, 32, 33, 34, 35,
                              0, 1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25,
                              28, 29, 32, 33, 34, 35};

    ASSERT_EQ(kinmat, CSparseMatrix(intvals, rows, cols, 36, 36, 1.0e-13));
}
