//
//                     V.E.L.O.X. C.H.E.M. MP
//      ---------------------------------------------------
//           An Electronic Structure Code for Nanoscale
//
//  Created by Zilvinas Rinkevicius (rinkevic@kth.se), KTH, Sweden.
//  Copyright Â© 2018 by Velox Chem MP developers. All rights reserved.

#include "OverlapIntegralsDriverTest.hpp"

#include "OverlapIntegralsDriver.hpp"
#include "MoleculeSetter.hpp"
#include "MolecularBasisSetter.hpp"

TEST_F(COverlapIntegralsDriverTest, ComputeSSForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 0);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.950707129188576,  0.153183585372556,
                                 0.323354079718979,  0.950707129188576,  1.000000000000001,
                                 0.229357720620491,  0.422732158345182,  0.153183585372556,
                                 0.229357720620491,  1.000000000000000,  0.803613898079232,
                                 0.323354079718979,  0.422732158345182,  0.803613898079232,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3};

    std::vector<int32_t> cols{0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3};
   
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 4, 4, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeSPForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 1);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.950707129188576, -0.125134719350771,
                                -0.244070992159223, -0.229413652143080, -0.447463485625242,
                                -0.083423146233847, -0.162713994772815,  0.950707129188576,
                                 1.000000000000001, -0.142493870385353, -0.272234258592489,
                                -0.261238762373148, -0.499096140752897, -0.094995913590236,
                                -0.181489505728326, -0.125134719350771, -0.142493870385353,
                                 1.000000000000000,  0.696850865854261, -0.244070992159223,
                                -0.272234258592489,  0.696850865854261,  1.000000000000000,
                                -0.229413652143080, -0.261238762373148,  1.000000000000000,
                                 0.696850865854261, -0.447463485625242, -0.499096140752897,
                                 0.696850865854261,  1.000000000000000, -0.083423146233847,
                                -0.094995913590236,  1.000000000000000,  0.696850865854261,
                                -0.162713994772815, -0.181489505728326,  0.696850865854261,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2,
                              2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6,
                              6, 6, 7, 7, 7, 7};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0,
                              1, 2, 3, 0, 1, 2, 3, 0, 1, 4, 5, 0, 1, 4, 5, 0, 1,
                              6, 7, 0, 1, 6, 7};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 8, 8, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputePSForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 0);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 1.000000000000000,  0.803613898079232,  0.140112388097761,
                                 0.199963795522407,  0.256872711512562,  0.366600291791080,
                                 0.093408258731841,  0.133309197014938,  0.803613898079232,
                                 1.000000000000000,  0.158551722313387,  0.222278341352162,
                                 0.290678157574543,  0.407510292478964,  0.105701148208925,
                                 0.148185560901441,  0.140112388097761,  0.158551722313387,
                                 1.000000000000000,  0.920751180279673,  0.199963795522407,
                                 0.222278341352162,  0.920751180279673,  1.000000000000000,
                                 0.256872711512562,  0.290678157574543,  1.000000000000000,
                                 0.920751180279672,  0.366600291791080,  0.407510292478964,
                                 0.920751180279672,  1.000000000000000,  0.093408258731841,
                                 0.105701148208925,  1.000000000000000,  0.920751180279673,
                                 0.133309197014938,  0.148185560901441,  0.920751180279673,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2,
                              2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6,
                              6, 6, 7, 7, 7, 7};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0,
                              1, 2, 3, 0, 1, 2, 3, 0, 1, 4, 5, 0, 1, 4, 5, 0, 1,
                              6, 7, 0, 1, 6, 7};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 8, 8, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputePPForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 1);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 1.000000000000000,  0.920751180279673,  0.037681201297685,
                                 0.176458528283385, -0.209976714372338, -0.218139464739689,
                                -0.076355168862668, -0.079323441723523,  0.920751180279673,
                                 1.000000000000000,  0.092847174786485,  0.271046743741918,
                                -0.227242299131736, -0.262431566067970, -0.082633563320631,
                                -0.095429660388353,  0.037681201297685,  0.092847174786485,
                                 1.000000000000000,  0.696850865854261, -0.209976714372338,
                                -0.227242299131736, -0.076355168862668, -0.082633563320631,
                                 0.176458528283385,  0.271046743741918,  0.696850865854261,
                                 1.000000000000000, -0.218139464739689, -0.262431566067970,
                                -0.079323441723523, -0.095429660388353, -0.209976714372338,
                                -0.218139464739689,  1.000000000000000,  0.920751180279672,
                                -0.232743355090933, -0.104478661154094, -0.139984476248226,
                                -0.145426309826460, -0.227242299131736, -0.262431566067970,
                                 0.920751180279672,  1.000000000000000, -0.199813361974084,
                                -0.066933303466831, -0.151494866087824, -0.174954377378647,
                                -0.209976714372338, -0.227242299131736, -0.232743355090933,
                                -0.199813361974084,  1.000000000000000,  0.696850865854261,
                                -0.139984476248226, -0.151494866087824, -0.218139464739689,
                                -0.262431566067970, -0.104478661154094, -0.066933303466831,
                                 0.696850865854261,  1.000000000000000, -0.145426309826460,
                                -0.174954377378647, -0.076355168862668, -0.079323441723523,
                                -0.139984476248226, -0.145426309826460,  1.000000000000000,
                                 0.920751180279673,  0.101310508683242,  0.242561396386321,
                                -0.082633563320631, -0.095429660388353, -0.151494866087824,
                                -0.174954377378647,  0.920751180279673,  1.000000000000000,
                                 0.161708477553677,  0.350571460732212, -0.076355168862668,
                                -0.082633563320631, -0.139984476248226, -0.151494866087824,
                                 0.101310508683242,  0.161708477553677,  1.000000000000000,
                                 0.696850865854261, -0.079323441723523, -0.095429660388353,
                                -0.145426309826460, -0.174954377378647,  0.242561396386321,
                                 0.350571460732212,  0.696850865854261,  1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2,
                              2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4,
                              4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6,
                              6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8,
                              8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11};

    std::vector<int32_t> cols{0, 1, 2, 3, 6, 7, 10, 11, 0, 1, 2, 3, 6, 7, 10, 11,
                              0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 2,
                              3, 4, 5, 6, 7, 10, 11, 2, 3, 4, 5, 6, 7, 10, 11, 0,
                              1, 4, 5, 6, 7, 8, 9, 0, 1, 4, 5, 6, 7, 8, 9, 2, 3,
                              6, 7, 8, 9, 10, 11, 2, 3, 6, 7, 8, 9, 10, 11, 0, 1,
                              4, 5, 8, 9, 10, 11, 0, 1, 4, 5, 8, 9, 10, 11};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 12, 12, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeSDForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 2);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 1.000000000000000,  0.950707129188576,  0.070045944830421,
                                 0.123763530098943,  0.192626348283657,  0.340349707772094,
                                 0.160079136867962,  0.282842341864830,  0.128417565522438,
                                 0.226899805181396, -0.029185810346009, -0.051568137541226,
                                 0.950707129188576,  1.000000000000001,  0.059083830826388,
                                 0.116876987139276,  0.162480534772568,  0.321411714633009,
                                 0.135026926461463,  0.267104216614945,  0.108320356515045,
                                 0.214274476422006, -0.024618262844328, -0.048698744641365,
                                 0.070045944830421,  0.059083830826388,  1.000000000000000,
                                 0.605807395054961,  0.123763530098943,  0.116876987139276,
                                 0.605807395054961,  1.000000000000001,  0.192626348283657,
                                 0.162480534772568,  1.000000000000000,  0.605807395054961,
                                 0.340349707772094,  0.321411714633009,  0.605807395054961,
                                 1.000000000000001,  0.160079136867962,  0.135026926461463,
                                 1.000000000000000,  0.605807395054961,  0.282842341864830,
                                 0.267104216614945,  0.605807395054961,  1.000000000000001,
                                 0.128417565522438,  0.108320356515045,  1.000000000000000,
                                 0.605807395054961,  0.226899805181396,  0.214274476422006,
                                 0.605807395054961,  1.000000000000001, -0.029185810346009,
                                -0.024618262844328,  1.000000000000000,  0.605807395054961,
                                -0.051568137541226, -0.048698744641365,  0.605807395054961,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4,
                              4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8,
                              8, 9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3,
                              4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 0, 1, 2, 3,
                              0, 1, 4, 5, 0, 1, 4, 5, 0, 1, 6, 7, 0, 1, 6, 7, 0,
                              1, 8, 9, 0, 1, 8, 9, 0, 1, 10, 11, 0, 1, 10, 11};
   
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 12, 12, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeDSForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 0);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.803613898079232,  0.086098695887285,
                                 0.116740346877976,  0.236771413690033,  0.321035953914433,
                                 0.196765208270956,  0.266791946502188,  0.157847609126688,
                                 0.214023969276289, -0.035874456619702, -0.048641811199157,
                                 0.803613898079232,  1.000000000000000,  0.052038740763044,
                                 0.077917991426184,  0.143106537098372,  0.214274476422006,
                                 0.118926466410172,  0.178069477743297,  0.095404358065582,
                                 0.142849650948004, -0.021682808651269, -0.032465829760910,
                                 0.086098695887285,  0.052038740763044,  1.000000000000000,
                                 0.892931005151188,  0.116740346877976,  0.077917991426184,
                                 0.892931005151188,  1.000000000000000,  0.236771413690033,
                                 0.143106537098372,  1.000000000000000,  0.892931005151188,
                                 0.321035953914433,  0.214274476422006,  0.892931005151188,
                                 1.000000000000000,  0.196765208270956,  0.118926466410172,
                                 1.000000000000001,  0.892931005151189,  0.266791946502188,
                                 0.178069477743297,  0.892931005151189,  1.000000000000001,
                                 0.157847609126688,  0.095404358065582,  1.000000000000000,
                                 0.892931005151188,  0.214023969276289,  0.142849650948004,
                                 0.892931005151188,  1.000000000000000, -0.035874456619702,
                                -0.021682808651269,  1.000000000000001,  0.892931005151188,
                                -0.048641811199157, -0.032465829760910,  0.892931005151188,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4,
                              4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8,
                              8, 9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3,
                              4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 0, 1, 2, 3,
                              0, 1, 4, 5, 0, 1, 4, 5, 0, 1, 6, 7, 0, 1, 6, 7, 0,
                              1, 8, 9, 0, 1, 8, 9, 0, 1, 10, 11, 0, 1, 10, 11};

    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 12, 12, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputePDForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 2);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.920751180279673, -0.018876443537726,
                                -0.087832297680010, -0.051910219728747, -0.241538818620027,
                                 0.218618675422472,  0.265078542418122,  0.117672789865464,
                                 0.109960049660739,  0.097848586590727,  0.196724839501361,
                                 0.920751180279673,  1.000000000000000, -0.038613710789097,
                                -0.116367157264684, -0.106187704670016, -0.320009682477881,
                                 0.195041065234992,  0.294445996716595,  0.094012371054134,
                                 0.112668445664584,  0.113473330897451,  0.241127544698825,
                                 1.000000000000000,  0.920751180279672,  0.117672789865464,
                                 0.109960049660739,  0.199007769660785,  0.080674376688232,
                                 0.005166890865905, -0.218064767306290,  0.132671846440524,
                                 0.053782917792155, -0.049030329110610, -0.045816687358642,
                                 0.920751180279672,  1.000000000000000,  0.094012371054134,
                                 0.112668445664584,  0.123694241534569,  0.043104215955011,
                                -0.070598518172100, -0.307176576769892,  0.082462827689713,
                                 0.028736143970008, -0.039171821272556, -0.046945185693577,
                                 1.000000000000000,  0.920751180279673, -0.081802297063618,
                                -0.181730287274897,  0.117672789865464,  0.109960049660739,
                                 0.145745783614981,  0.176719028278748, -0.149970877949967,
                                -0.333172193337310, -0.100890812231838, -0.164471120170828,
                                 0.920751180279673,  1.000000000000000, -0.100653462117342,
                                -0.225763665744564,  0.094012371054134,  0.112668445664584,
                                 0.130027376823328,  0.196297331144397, -0.184531347215127,
                                -0.413900053865034, -0.104137484554099, -0.194893649697576,
                                -0.018876443537726, -0.038613710789097,  0.117672789865464,
                                 0.094012371054134, -0.081802297063618, -0.100653462117342,
                                 1.000000000000000,  0.605807395054961, -0.087832297680010,
                                -0.116367157264684,  0.109960049660739,  0.112668445664584,
                                -0.181730287274897, -0.225763665744564,  0.605807395054961,
                                 1.000000000000001, -0.051910219728747, -0.106187704670016,
                                 0.199007769660785,  0.123694241534569,  0.117672789865464,
                                 0.094012371054134,  1.000000000000000,  0.605807395054961,
                                -0.241538818620027, -0.320009682477881,  0.080674376688232,
                                 0.043104215955011,  0.109960049660739,  0.112668445664584,
                                 0.605807395054961,  1.000000000000001,  0.218618675422472,
                                 0.195041065234992,  0.005166890865905, -0.070598518172100,
                                 0.145745783614981,  0.130027376823328,  1.000000000000000,
                                 0.605807395054961,  0.265078542418122,  0.294445996716595,
                                -0.218064767306290, -0.307176576769892,  0.176719028278748,
                                 0.196297331144397,  0.605807395054961,  1.000000000000001,
                                 0.117672789865464,  0.094012371054134,  0.132671846440524,
                                 0.082462827689713, -0.149970877949967, -0.184531347215127,
                                 1.000000000000000,  0.605807395054961,  0.109960049660739,
                                 0.112668445664584,  0.053782917792155,  0.028736143970008,
                                -0.333172193337310, -0.413900053865034,  0.605807395054961,
                                 1.000000000000001,  0.097848586590727,  0.113473330897451,
                                -0.049030329110610, -0.039171821272556, -0.100890812231838,
                                -0.104137484554099,  1.000000000000000,  0.605807395054961,
                                 0.196724839501361,  0.241127544698825, -0.045816687358642,
                                -0.046945185693577, -0.164471120170828, -0.194893649697576,
                                 0.605807395054961,  1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7,
                              7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9,
                              9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11,
                              11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12,
                              13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14,
                              14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 6,
                              7, 8, 9, 10, 11, 12, 13, 14, 15, 2, 3, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 2, 3, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
                              0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0,
                              1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1,
                              2, 3, 4, 5, 10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1,
                              2, 3, 4, 5, 12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1,
                              2, 3, 4, 5, 14, 15, 0, 1, 2, 3, 4, 5, 14, 15};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 16, 16, 1.0e-13));
}


TEST_F(COverlapIntegralsDriverTest, ComputeDPForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 1);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.696850865854261,  0.022253517944352,
                                 0.053526096316628,  0.061197174346969,  0.147196764870727,
                                -0.241318448500686, -0.273874014400366, -0.129177126827294,
                                -0.132360922037642, -0.109712215496293, -0.158502416588094,
                                 0.696850865854261,  1.000000000000000,  0.058135273839438,
                                 0.095013386038893,  0.159872003058454,  0.261286811606957,
                                -0.172724396150433, -0.240414149586956, -0.071194189614673,
                                -0.091993400663574, -0.129272204622372, -0.196879815814088,
                                 1.000000000000000,  0.696850865854261, -0.129177126827294,
                                -0.132360922037642, -0.216166445363472, -0.175408091279593,
                                -0.000808520075027,  0.096733678590652, -0.144110963575648,
                                -0.116938727519729,  0.053823802844706,  0.055150384182351,
                                 0.696850865854261,  1.000000000000000, -0.071194189614673,
                                -0.091993400663574, -0.050331319178279, -0.035194444950837,
                                 0.145212969487047,  0.250808624673700, -0.033554212785519,
                                -0.023462963300558,  0.029664245672780,  0.038330583609822,
                                 1.000000000000000,  0.696850865854261,  0.092097152747117,
                                 0.140453199946597, -0.129177126827294, -0.132360922037642,
                                -0.160878965667124, -0.182582676266911,  0.168844780036381,
                                 0.257497533235428,  0.112286060884588,  0.145777648039833,
                                 0.696850865854261,  1.000000000000000,  0.119563906038553,
                                 0.184335261178146, -0.071194189614673, -0.091993400663574,
                                -0.115149597433622, -0.160276099724637,  0.219200494404015,
                                 0.337947978826602,  0.107755466601179,  0.159129998622596,
                                 0.022253517944352,  0.058135273839438, -0.129177126827294,
                                -0.071194189614673,  0.092097152747117,  0.119563906038553,
                                 1.000000000000000,  0.892931005151188,  0.053526096316628,
                                 0.095013386038893, -0.132360922037642, -0.091993400663574,
                                 0.140453199946597,  0.184335261178146,  0.892931005151188,
                                 1.000000000000000,  0.061197174346969,  0.159872003058454,
                                -0.216166445363472, -0.050331319178279, -0.129177126827294,
                                -0.071194189614673,  1.000000000000000,  0.892931005151188,
                                 0.147196764870727,  0.261286811606957, -0.175408091279593,
                                -0.035194444950837, -0.132360922037642, -0.091993400663574,
                                 0.892931005151188,  1.000000000000000, -0.241318448500686,
                                -0.172724396150433, -0.000808520075027,  0.145212969487047,
                                -0.160878965667124, -0.115149597433622,  1.000000000000001,
                                 0.892931005151189, -0.273874014400366, -0.240414149586956,
                                 0.096733678590652,  0.250808624673700, -0.182582676266911,
                                -0.160276099724637,  0.892931005151189,  1.000000000000001,
                                -0.129177126827294, -0.071194189614673, -0.144110963575648,
                                -0.033554212785519,  0.168844780036381,  0.219200494404015,
                                 1.000000000000000,  0.892931005151188, -0.132360922037642,
                                -0.091993400663574, -0.116938727519729, -0.023462963300558,
                                 0.257497533235428,  0.337947978826602,  0.892931005151188,
                                 1.000000000000000, -0.109712215496293, -0.129272204622372,
                                 0.053823802844706,  0.029664245672780,  0.112286060884588,
                                 0.107755466601179,  1.000000000000001,  0.892931005151188,
                                -0.158502416588094, -0.196879815814088,  0.055150384182351,
                                 0.038330583609822,  0.145777648039833,  0.159129998622596,
                                 0.892931005151188,  1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7,
                              7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9,
                              9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11,
                              11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12,
                              13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14,
                              14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 6,
                              7, 8, 9, 10, 11, 12, 13, 14, 15, 2, 3, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 2, 3, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
                              0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0,
                              1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1,
                              2, 3, 4, 5, 10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1,
                              2, 3, 4, 5, 12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1,
                              2, 3, 4, 5, 14, 15, 0, 1, 2, 3, 4, 5, 14, 15};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 16, 16, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeDDForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 2);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.892931005151188,  0.026250570366999,
                                 0.133713364896979, -0.030487789470413, -0.079144079705505,
                                 0.178096940500837,  0.128031415967137, -0.136370874989311,
                                -0.163314836179654, -0.016479852869762, -0.008108857567527,
                                 0.892931005151188,  1.000000000000000,  0.065910808836957,
                                 0.224778860572808, -0.061084447271136, -0.112176973896449,
                                 0.158192811943730,  0.157198985185560, -0.159919021122644,
                                -0.217634300212303, -0.012416790948353, -0.008976152612296,
                                 0.026250570366999,  0.065910808836957,  1.000000000000000,
                                 0.605807395054961, -0.030487789470413, -0.061084447271136,
                                 0.178096940500837,  0.158192811943730, -0.136370874989311,
                                -0.159919021122644, -0.016479852869762, -0.012416790948353,
                                 0.133713364896979,  0.224778860572808,  0.605807395054961,
                                 1.000000000000001, -0.079144079705505, -0.112176973896449,
                                 0.128031415967137,  0.157198985185560, -0.163314836179654,
                                -0.217634300212303, -0.008108857567527, -0.008976152612296,
                                -0.030487789470413, -0.079144079705505,  1.000000000000000,
                                 0.892931005151188, -0.046504381778306, -0.055153188945702,
                                 0.127971955347766,  0.007419005504175,  0.123449046045478,
                                 0.025755791302793,  0.163562632224418,  0.176694451166073,
                                -0.061084447271136, -0.112176973896449,  0.892931005151188,
                                 1.000000000000000, -0.079858894878255, -0.042916190770990,
                                 0.063413706890322, -0.013063926653470,  0.072223933640378,
                                 0.015109856897366,  0.180406726187426,  0.232444952022592,
                                -0.030487789470413, -0.061084447271136, -0.046504381778306,
                                -0.079858894878255,  1.000000000000000,  0.605807395054961,
                                 0.127971955347766,  0.063413706890321,  0.123449046045478,
                                 0.072223933640378,  0.163562632224418,  0.180406726187426,
                                -0.079144079705505, -0.112176973896449, -0.055153188945702,
                                -0.042916190770990,  0.605807395054961,  1.000000000000001,
                                 0.007419005504175, -0.013063926653470,  0.025755791302793,
                                 0.015109856897366,  0.176694451166073,  0.232444952022592,
                                 0.178096940500837,  0.128031415967137,  0.127971955347766,
                                 0.007419005504175,  1.000000000000001,  0.892931005151189,
                                -0.207615781838812, -0.166012927233609,  0.085314636898511,
                                 0.004946003669450, -0.074207058542015, -0.053346423319640,
                                 0.158192811943730,  0.157198985185560,  0.063413706890321,
                                -0.013063926653470,  0.892931005151189,  1.000000000000001,
                                -0.220016658415391, -0.177730938443126,  0.042275804593548,
                                -0.008709284435647, -0.065913671643221, -0.065499577160650,
                                 0.178096940500837,  0.158192811943730,  0.127971955347766,
                                 0.063413706890322, -0.207615781838812, -0.220016658415391,
                                 1.000000000000000,  0.605807395054961,  0.085314636898511,
                                 0.042275804593548, -0.074207058542015, -0.065913671643221,
                                 0.128031415967137,  0.157198985185560,  0.007419005504175,
                                -0.013063926653470, -0.166012927233609, -0.177730938443126,
                                 0.605807395054961,  1.000000000000001,  0.004946003669450,
                                -0.008709284435647, -0.053346423319640, -0.065499577160650,
                                -0.136370874989311, -0.163314836179654,  0.123449046045478,
                                 0.025755791302793,  0.085314636898511,  0.004946003669450,
                                 1.000000000000000,  0.892931005151188, -0.149378586816204,
                                -0.076616348364697, -0.169467882005405, -0.147528778524980,
                                -0.159919021122644, -0.217634300212303,  0.072223933640378,
                                 0.015109856897366,  0.042275804593548, -0.008709284435647,
                                 0.892931005151188,  1.000000000000000, -0.140045506245237,
                                -0.055507738185461, -0.165799384268911, -0.187875860926815,
                                -0.136370874989311, -0.159919021122644,  0.123449046045478,
                                 0.072223933640378,  0.085314636898511,  0.042275804593548,
                                -0.149378586816204, -0.140045506245237,  1.000000000000000,
                                 0.605807395054961, -0.169467882005405, -0.165799384268910,
                                -0.163314836179654, -0.217634300212303,  0.025755791302793,
                                 0.015109856897366,  0.004946003669450, -0.008709284435647,
                                -0.076616348364697, -0.055507738185461,  0.605807395054961,
                                 1.000000000000001, -0.147528778524980, -0.187875860926815,
                                -0.016479852869762, -0.008108857567527,  0.163562632224418,
                                 0.176694451166073, -0.074207058542015, -0.053346423319640,
                                -0.169467882005405, -0.147528778524980,  1.000000000000001,
                                 0.892931005151188, -0.006434471158029,  0.117630797388051,
                                -0.012416790948353, -0.008976152612296,  0.180406726187426,
                                 0.232444952022592, -0.065913671643221, -0.065499577160650,
                                -0.165799384268910, -0.187875860926815,  0.892931005151188,
                                 1.000000000000000,  0.041284173456057,  0.206976157891753,
                                -0.016479852869762, -0.012416790948353,  0.163562632224418,
                                 0.180406726187426, -0.074207058542015, -0.065913671643221,
                                -0.169467882005405, -0.165799384268911, -0.006434471158029,
                                 0.041284173456057,  1.000000000000000,  0.605807395054961,
                                -0.008108857567527, -0.008976152612296,  0.176694451166073,
                                 0.232444952022592, -0.053346423319640, -0.065499577160650,
                                -0.147528778524980, -0.187875860926815,  0.117630797388051,
                                 0.206976157891753,  0.605807395054961,  1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7,
                              7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
                              9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13,
                              13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14,
                              14, 14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17,
                              17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18,
                              18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 0, 1, 2,
                              3, 6, 7, 10, 11, 14, 15, 18, 19, 0, 1, 2, 3, 4, 5,
                              8, 9, 12, 13, 16, 17, 0, 1, 2, 3, 4, 5, 8, 9, 12,
                              13, 16, 17, 2, 3, 4, 5, 6, 7, 10, 11, 14, 15, 18,
                              19, 2, 3, 4, 5, 6, 7, 10, 11, 14, 15, 18, 19, 0, 1,
                              4, 5, 6, 7, 8, 9, 12, 13, 16, 17, 0, 1, 4, 5, 6, 7,
                              8, 9, 12, 13, 16, 17, 2, 3, 6, 7, 8, 9, 10, 11, 14,
                              15, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11, 14, 15, 18,
                              19, 0, 1, 4, 5, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1,
                              4, 5, 8, 9, 10, 11, 12, 13, 16, 17, 2, 3, 6, 7, 10,
                              11, 12, 13, 14, 15, 18, 19, 2, 3, 6, 7, 10, 11, 12,
                              13, 14, 15, 18, 19, 0, 1, 4, 5, 8, 9, 12, 13, 14,
                              15, 16, 17, 0, 1, 4, 5, 8, 9, 12, 13, 14, 15, 16,
                              17, 2, 3, 6, 7, 10, 11, 14, 15, 16, 17, 18, 19, 2,
                              3, 6, 7, 10, 11, 14, 15, 16, 17, 18, 19, 0, 1, 4,
                              5, 8, 9, 12, 13, 16, 17, 18, 19, 0, 1, 4, 5, 8, 9,
                              12, 13, 16, 17, 18, 19};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeSFForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 3);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.950707129188576, -0.006171812284956,
                                -0.009682513119081, -0.110863799833474, -0.173926254843384,
                                -0.172103948607980, -0.270001526829375, -0.051286297137360,
                                -0.080459388901378, -0.114735965738653, -0.180001017886250,
                                 0.046193249930614,  0.072469272851410,  0.031544818345330,
                                 0.049488400386414,  0.950707129188576,  1.000000000000001,
                                -0.003754662969264, -0.007681939477131, -0.067444728492686,
                                -0.137990100995361, -0.104700579484193, -0.214214570362804,
                                -0.031200359278864, -0.063835096147639, -0.069800386322796,
                                -0.142809713575203,  0.028101970205286,  0.057495875414734,
                                 0.019190499620684,  0.039263246216446, -0.006171812284956,
                                -0.003754662969264,  1.000000000000000,  0.527975968559032,
                                -0.009682513119081, -0.007681939477131,  0.527975968559032,
                                 1.000000000000000, -0.110863799833474, -0.067444728492686,
                                 1.000000000000000,  0.527975968559032, -0.173926254843384,
                                -0.137990100995361,  0.527975968559032,  1.000000000000000,
                                -0.172103948607980, -0.104700579484193,  1.000000000000000,
                                 0.527975968559032, -0.270001526829375, -0.214214570362804,
                                 0.527975968559032,  1.000000000000000, -0.051286297137360,
                                -0.031200359278864,  1.000000000000000,  0.527975968559032,
                                -0.080459388901378, -0.063835096147639,  0.527975968559032,
                                 1.000000000000000, -0.114735965738653, -0.069800386322796,
                                 1.000000000000000,  0.527975968559032, -0.180001017886250,
                                -0.142809713575203,  0.527975968559032,  1.000000000000000,
                                 0.046193249930614,  0.028101970205286,  1.000000000000000,
                                 0.527975968559032,  0.072469272851410,  0.057495875414734,
                                 0.527975968559032,  1.000000000000000,  0.031544818345330,
                                 0.019190499620684,  1.000000000000000,  0.527975968559032,
                                 0.049488400386414,  0.039263246216446,  0.527975968559032,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6,
                              6, 7, 7, 7, 7, 8, 8, 8, 8, 9, 9, 9, 9, 10, 10, 10,
                              10, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13,
                              14, 14, 14, 14, 15, 15, 15, 15};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                              15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 4, 5, 0, 1,
                              4, 5, 0, 1, 6, 7, 0, 1, 6, 7, 0, 1, 8, 9, 0, 1, 8,
                              9, 0, 1, 10, 11, 0, 1, 10, 11, 0, 1, 12, 13, 0, 1,
                              12, 13, 0, 1, 14, 15, 0, 1, 14, 15};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 16, 16, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeFSForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 0);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 1.000000000000000,  0.803613898079232,  0.008163908647711,
                                 0.010480463602502,  0.146647676952973,  0.188259779355567,
                                 0.227654512074315,  0.292252759149766,  0.067840145710420,
                                 0.087090168274462,  0.151769674716210,  0.194835172766511,
                                -0.061103198730405, -0.078441574731486, -0.041726644199412,
                                -0.053566813968343,  0.803613898079232,  1.000000000000000,
                                 0.002624958283833,  0.004181518211981,  0.047151928204208,
                                 0.075112297109723,  0.073198221967978,  0.116603642857421,
                                 0.021812781125244,  0.034747425165160,  0.048798814645319,
                                 0.077735761904947, -0.019646636751753, -0.031296790462384,
                                -0.013416453450702, -0.021372204194568,  0.008163908647711,
                                 0.002624958283833,  1.000000000000000,  0.867095998733913,
                                 0.010480463602502,  0.004181518211981,  0.867095998733913,
                                 1.000000000000000,  0.146647676952973,  0.047151928204208,
                                 0.999999999999999,  0.867095998733913,  0.188259779355567,
                                 0.075112297109723,  0.867095998733913,  1.000000000000000,
                                 0.227654512074315,  0.073198221967978,  1.000000000000000,
                                 0.867095998733913,  0.292252759149766,  0.116603642857421,
                                 0.867095998733913,  1.000000000000000,  0.067840145710420,
                                 0.021812781125244,  0.999999999999999,  0.867095998733913,
                                 0.087090168274462,  0.034747425165160,  0.867095998733913,
                                 1.000000000000000,  0.151769674716210,  0.048798814645319,
                                 1.000000000000000,  0.867095998733913,  0.194835172766511,
                                 0.077735761904947,  0.867095998733913,  1.000000000000000,
                                -0.061103198730405, -0.019646636751753,  1.000000000000000,
                                 0.867095998733913, -0.078441574731486, -0.031296790462384,
                                 0.867095998733913,  1.000000000000000, -0.041726644199412,
                                -0.013416453450702,  1.000000000000000,  0.867095998733913,
                                -0.053566813968343, -0.021372204194568,  0.867095998733913,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6,
                              6, 7, 7, 7, 7, 8, 8, 8, 8, 9, 9, 9, 9, 10, 10, 10,
                              10, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13,
                              14, 14, 14, 14, 15, 15, 15, 15};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                              15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 4, 5, 0, 1,
                              4, 5, 0, 1, 6, 7, 0, 1, 6, 7, 0, 1, 8, 9, 0, 1, 8,
                              9, 0, 1, 10, 11, 0, 1, 10, 11, 0, 1, 12, 13, 0, 1,
                              12, 13, 0, 1, 14, 15, 0, 1, 14, 15};

    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 16, 16, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputePFForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 3);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.920751180279673, -0.041325259871892,
                                -0.061698069646942,  0.026370152065035,  0.121112945088820,
                                 0.007789241306343,  0.135000880135648, -0.195924717974885,
                                -0.276830199392535, -0.127397338495509, -0.122054404446679,
                                -0.149779298454479, -0.272437053235527, -0.056636314762694,
                                -0.113040856837526,  0.920751180279673,  1.000000000000000,
                                -0.031814169962600, -0.062477762245171,  0.044207777681556,
                                 0.137388173467904,  0.042078273165233,  0.158960628606563,
                                -0.146245598708266, -0.277499705611841, -0.078145723755318,
                                -0.111304307473376, -0.129584951196787, -0.284685762870534,
                                -0.051931772717155, -0.119607233558850,  1.000000000000000,
                                 0.920751180279672, -0.010384335759504, -0.008551322784019,
                                -0.116651888808426, -0.041843974373862, -0.046490217036863,
                                 0.150309742613623,  0.127972061250599,  0.271617756569799,
                                -0.030993478024575,  0.100206495075748,  0.048604953670177,
                                 0.017434989322443,  0.053075493881909,  0.043706760896099,
                                 0.920751180279672,  1.000000000000000, -0.005961048530857,
                                -0.007405325905145, -0.051106655492976, -0.018505719742509,
                                 0.028469460614585,  0.191842041668062,  0.122079090718638,
                                 0.289581108215195,  0.018979640409723,  0.127894694445375,
                                 0.021294439788740,  0.007710716559379,  0.030467581379934,
                                 0.037849443515183,  1.000000000000000,  0.920751180279673,
                                 0.081810462058462,  0.133771336313937,  0.124342974525957,
                                 0.251490675788843, -0.127397338495509, -0.122054404446679,
                                -0.130616478649924, -0.184553466261690,  0.113953690052600,
                                 0.236712883841214,  0.156378029921923,  0.228172207594093,
                                -0.016360897136923, -0.041140344166168,  0.920751180279673,
                                 1.000000000000000,  0.066382799458626,  0.137559538783442,
                                 0.114983423964221,  0.266546493023916, -0.078145723755318,
                                -0.111304307473376, -0.097497065805511, -0.184999803741227,
                                 0.107199709627997,  0.251714218167709,  0.118837805759116,
                                 0.230099997128396, -0.017483568443975, -0.044675059564117,
                                -0.041325259871892, -0.031814169962600, -0.010384335759504,
                                -0.005961048530857,  0.081810462058462,  0.066382799458626,
                                 1.000000000000000,  0.527975968559032, -0.061698069646942,
                                -0.062477762245171, -0.008551322784019, -0.007405325905145,
                                 0.133771336313937,  0.137559538783442,  0.527975968559032,
                                 1.000000000000000,  0.026370152065035,  0.044207777681556,
                                -0.116651888808426, -0.051106655492976,  0.124342974525957,
                                 0.114983423964221,  1.000000000000000,  0.527975968559032,
                                 0.121112945088820,  0.137388173467904, -0.041843974373862,
                                -0.018505719742509,  0.251490675788843,  0.266546493023916,
                                 0.527975968559032,  1.000000000000000,  0.007789241306343,
                                 0.042078273165233, -0.046490217036863,  0.028469460614585,
                                -0.127397338495509, -0.078145723755318,  1.000000000000000,
                                 0.527975968559032,  0.135000880135648,  0.158960628606563,
                                 0.150309742613623,  0.191842041668062, -0.122054404446679,
                                -0.111304307473376,  0.527975968559032,  1.000000000000000,
                                -0.195924717974885, -0.146245598708266,  0.127972061250599,
                                 0.122079090718638, -0.130616478649924, -0.097497065805511,
                                 1.000000000000000,  0.527975968559032, -0.276830199392535,
                                -0.277499705611841,  0.271617756569799,  0.289581108215195,
                                -0.184553466261690, -0.184999803741227,  0.527975968559032,
                                 1.000000000000000, -0.127397338495509, -0.078145723755318,
                                -0.030993478024575,  0.018979640409723,  0.113953690052600,
                                 0.107199709627997,  1.000000000000000,  0.527975968559032,
                                -0.122054404446679, -0.111304307473376,  0.100206495075748,
                                 0.127894694445375,  0.236712883841214,  0.251714218167709,
                                 0.527975968559032,  1.000000000000000, -0.149779298454479,
                                -0.129584951196787,  0.048604953670177,  0.021294439788740,
                                 0.156378029921923,  0.118837805759116,  1.000000000000000,
                                 0.527975968559032, -0.272437053235527, -0.284685762870534,
                                 0.017434989322443,  0.007710716559379,  0.228172207594093,
                                 0.230099997128396,  0.527975968559032,  1.000000000000000,
                                -0.056636314762694, -0.051931772717155,  0.053075493881909,
                                 0.030467581379934, -0.016360897136923, -0.017483568443975,
                                 1.000000000000000,  0.527975968559032, -0.113040856837526,
                                -0.119607233558850,  0.043706760896099,  0.037849443515183,
                                -0.041140344166168, -0.044675059564117,  0.527975968559032,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8,
                              8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10,
                              10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15,
                              15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17,
                              17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
                              16, 17, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2,
                              3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3,
                              4, 5, 10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1, 2, 3,
                              4, 5, 12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1, 2, 3,
                              4, 5, 14, 15, 0, 1, 2, 3, 4, 5, 14, 15, 0, 1, 2, 3,
                              4, 5, 16, 17, 0, 1, 2, 3, 4, 5, 16, 17, 0, 1, 2, 3,
                              4, 5, 18, 19, 0, 1, 2, 3, 4, 5, 18, 19};

    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeFPForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 1);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 1.000000000000000,  0.696850865854261, -0.050256057304913,
                                -0.062521135490474,  0.036297850204581,  0.085221924868774,
                                 0.015855041245491,  0.080194136068031, -0.237454657288036,
                                -0.287719063935479, -0.151403609846881, -0.154951644353911,
                                -0.184673648075870, -0.253671592657958, -0.070349542888506,
                                -0.101479476278326,  0.696850865854261,  1.000000000000000,
                                -0.026404843949182, -0.041651841496781,  0.052866357976361,
                                 0.091592115645269,  0.059336444890244,  0.105973752404375,
                                -0.118276324376705, -0.184999803741227, -0.051373592380125,
                                -0.074202871648917, -0.117211948986843, -0.189790508580356,
                                -0.048738185031415, -0.079738155705900,  1.000000000000000,
                                 0.696850865854261, -0.012268822657015, -0.011855408385065,
                                -0.135016336047360, -0.103113774619239, -0.045170341499209,
                                 0.051499315330616,  0.159795606551257,  0.238278458390060,
                                -0.030113560999473,  0.034332876887077,  0.056256806686400,
                                 0.042964072758016,  0.062707315802522,  0.060594309523666,
                                 0.696850865854261,  1.000000000000000, -0.003571771706646,
                                -0.004936883936763, -0.016234504347098, -0.012337146495006,
                                 0.067106672074760,  0.127894694445375,  0.117262716485472,
                                 0.193054072143463,  0.044737781383173,  0.085263129630250,
                                 0.006764376811291,  0.005140477706253,  0.018255722056191,
                                 0.025232962343455,  1.000000000000000,  0.696850865854261,
                                 0.100092143269148,  0.130219860242120,  0.154621292821486,
                                 0.224631891422236, -0.151403609846881, -0.154951644353911,
                                -0.158303104858691, -0.191812709290319,  0.142024716117892,
                                 0.209320506362957,  0.189898777060323,  0.233647064518022,
                                -0.020761311927443, -0.034020254726378,  0.696850865854261,
                                 1.000000000000000,  0.057397025532375,  0.091706359188962,
                                 0.108462930827850,  0.177697662015944, -0.051373592380125,
                                -0.074202871648917, -0.078850882917803, -0.123333202494151,
                                 0.102147771873681,  0.167809478778473,  0.097583561900101,
                                 0.153399998085597, -0.017818160452397, -0.029783373042745,
                                -0.050256057304913, -0.026404843949182, -0.012268822657015,
                                -0.003571771706646,  0.100092143269148,  0.057397025532375,
                                 1.000000000000000,  0.867095998733913, -0.062521135490474,
                                -0.041651841496781, -0.011855408385065, -0.004936883936763,
                                 0.130219860242120,  0.091706359188962,  0.867095998733913,
                                 1.000000000000000,  0.036297850204581,  0.052866357976361,
                                -0.135016336047360, -0.016234504347098,  0.154621292821486,
                                 0.108462930827850,  0.999999999999999,  0.867095998733913,
                                 0.085221924868774,  0.091592115645269, -0.103113774619239,
                                -0.012337146495006,  0.224631891422236,  0.177697662015944,
                                 0.867095998733913,  1.000000000000000,  0.015855041245491,
                                 0.059336444890244, -0.045170341499209,  0.067106672074760,
                                -0.151403609846881, -0.051373592380125,  1.000000000000000,
                                 0.867095998733913,  0.080194136068031,  0.105973752404375,
                                 0.051499315330616,  0.127894694445375, -0.154951644353911,
                                -0.074202871648917,  0.867095998733913,  1.000000000000000,
                                -0.237454657288036, -0.118276324376705,  0.159795606551257,
                                 0.117262716485472, -0.158303104858691, -0.078850882917803,
                                 0.999999999999999,  0.867095998733913, -0.287719063935479,
                                -0.184999803741227,  0.238278458390060,  0.193054072143463,
                                -0.191812709290319, -0.123333202494151,  0.867095998733913,
                                 1.000000000000000, -0.151403609846881, -0.051373592380125,
                                -0.030113560999473,  0.044737781383173,  0.142024716117892,
                                 0.102147771873681,  1.000000000000000,  0.867095998733913,
                                -0.154951644353911, -0.074202871648917,  0.034332876887077,
                                 0.085263129630250,  0.209320506362957,  0.167809478778473,
                                 0.867095998733913,  1.000000000000000, -0.184673648075870,
                                -0.117211948986843,  0.056256806686400,  0.006764376811291,
                                 0.189898777060323,  0.097583561900101,  1.000000000000000,
                                 0.867095998733913, -0.253671592657958, -0.189790508580356,
                                 0.042964072758016,  0.005140477706253,  0.233647064518022,
                                 0.153399998085597,  0.867095998733913,  1.000000000000000,
                                -0.070349542888506, -0.048738185031415,  0.062707315802522,
                                 0.018255722056191, -0.020761311927443, -0.017818160452397,
                                 1.000000000000000,  0.867095998733913, -0.101479476278326,
                                -0.079738155705900,  0.060594309523666,  0.025232962343455,
                                -0.034020254726378, -0.029783373042745,  0.867095998733913,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8,
                              8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10,
                              10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15,
                              15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17,
                              17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
                              16, 17, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 2, 3, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2,
                              3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3,
                              4, 5, 10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1, 2, 3,
                              4, 5, 12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1, 2, 3,
                              4, 5, 14, 15, 0, 1, 2, 3, 4, 5, 14, 15, 0, 1, 2, 3,
                              4, 5, 16, 17, 0, 1, 2, 3, 4, 5, 16, 17, 0, 1, 2, 3,
                              4, 5, 18, 19, 0, 1, 2, 3, 4, 5, 18, 19};

    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeDFForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 3);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.892931005151188, -0.048192694575249,
                                -0.118530775798295, -0.036085542112265, -0.181755366945650,
                                 0.009571869188176,  0.069492271208128, -0.210813575662786,
                                -0.166996321203654,  0.129358260674865,  0.167868399394157,
                                 0.026176872928789,  0.011260325221278,  0.084918735235353,
                                 0.183228991950306,  0.892931005151188,  1.000000000000000,
                                -0.063307711523339, -0.161541695741060, -0.075513486532698,
                                -0.265383788812954,  0.035668152664172,  0.091777491078059,
                                -0.153330625159897, -0.182784761112817,  0.122857878797769,
                                 0.202305086530416,  0.014110364749076,  0.010597639756444,
                                 0.101769469078301,  0.247425642527569,  1.000000000000000,
                                 0.892931005151188, -0.069487346596204, -0.055028397522238,
                                 0.023600530591198,  0.028070807234913, -0.055064959226667,
                                -0.158666975743468, -0.037521648746262,  0.076640850473685,
                                -0.067502610823609,  0.017694291095710, -0.153240286696322,
                                -0.063688676776732, -0.094527785740302, -0.100992376446992,
                                 0.892931005151188,  1.000000000000000, -0.050531711651485,
                                -0.060228044314460,  0.033098110008849,  0.018424995820662,
                                -0.061433657328037, -0.243368767880118,  0.015188656979809,
                                 0.119551901187269, -0.012079168258297,  0.032339735671483,
                                -0.098026870993948, -0.038178933882668, -0.082334909705934,
                                -0.115300380555309,  1.000000000000001,  0.892931005151189,
                                -0.019305260594540, -0.013054167496736, -0.143575634003801,
                                -0.061760942077841,  0.032600500260357,  0.015260227399778,
                                 0.157461351305349, -0.076351801384183,  0.021733666840238,
                                 0.010173484933185,  0.059823180834917,  0.025733725865767,
                                 0.098671331927650,  0.066721300538871,  0.892931005151189,
                                 1.000000000000001, -0.012876885667927, -0.013880307484382,
                                -0.077392917419307, -0.058126226578496,  0.036383165713939,
                                -0.008241458158595,  0.050722896026307, -0.171910526817983,
                                 0.024255443809293, -0.005494305439063,  0.032247048924711,
                                 0.024219261074373,  0.065815193413851,  0.070943793809064,
                                 1.000000000000000,  0.892931005151188,  0.137274440231774,
                                 0.119380410533607,  0.126046558047970,  0.058708107717264,
                                -0.067502610823609,  0.017694291095710, -0.025014432497508,
                                 0.051093900315790,  0.001187216459674, -0.173412218323226,
                                 0.162590699238329,  0.053527049094418, -0.027096914225495,
                                -0.036793597053011,  0.892931005151188,  1.000000000000000,
                                 0.105377038852461,  0.132606253809389,  0.086862323459946,
                                 0.035746293847666, -0.012079168258297,  0.032339735671483,
                                 0.010125771319873,  0.079701267458179, -0.051367683779456,
                                -0.270318547606354,  0.090161352960414,  0.030858489332894,
                                -0.027681600247846, -0.043066386670831,  1.000000000000001,
                                 0.892931005151188, -0.065585589226710, -0.174912585624769,
                                 0.026176872928789,  0.011260325221278, -0.163858397742646,
                                -0.186957397168747,  0.087838989859494,  0.069581800501523,
                                 0.185905903090164,  0.167058259833809,  0.015831922529833,
                                -0.159422388590116, -0.052143521732794, -0.120230275918422,
                                 0.892931005151188,  1.000000000000000, -0.091348142487031,
                                -0.239598668033110,  0.014110364749076,  0.010597639756444,
                                -0.143664573738223, -0.221696741504415,  0.063887760483290,
                                 0.076160317130340,  0.142013482359823,  0.190890394278495,
                                -0.047527929780364, -0.244365136629340, -0.065437362853549,
                                -0.163141177966059, -0.048192694575249, -0.063307711523339,
                                -0.069487346596204, -0.050531711651485, -0.019305260594540,
                                -0.012876885667927,  0.137274440231774,  0.105377038852461,
                                -0.065585589226710, -0.091348142487031,  1.000000000000000,
                                 0.527975968559032, -0.118530775798295, -0.161541695741060,
                                -0.055028397522238, -0.060228044314460, -0.013054167496736,
                                -0.013880307484382,  0.119380410533607,  0.132606253809389,
                                -0.174912585624769, -0.239598668033110,  0.527975968559032,
                                 1.000000000000000, -0.036085542112265, -0.075513486532698,
                                 0.023600530591198,  0.033098110008849, -0.143575634003801,
                                -0.077392917419307,  0.126046558047970,  0.086862323459946,
                                 0.026176872928789,  0.014110364749076,  1.000000000000000,
                                 0.527975968559032, -0.181755366945650, -0.265383788812954,
                                 0.028070807234913,  0.018424995820662, -0.061760942077841,
                                -0.058126226578496,  0.058708107717264,  0.035746293847666,
                                 0.011260325221278,  0.010597639756444,  0.527975968559032,
                                 1.000000000000000,  0.009571869188176,  0.035668152664172,
                                -0.055064959226667, -0.061433657328037,  0.032600500260357,
                                 0.036383165713939, -0.067502610823609, -0.012079168258297,
                                -0.163858397742646, -0.143664573738223,  1.000000000000000,
                                 0.527975968559032,  0.069492271208128,  0.091777491078059,
                                -0.158666975743468, -0.243368767880118,  0.015260227399778,
                                -0.008241458158595,  0.017694291095710,  0.032339735671483,
                                -0.186957397168747, -0.221696741504415,  0.527975968559032,
                                 1.000000000000000, -0.210813575662786, -0.153330625159897,
                                -0.037521648746262,  0.015188656979809,  0.157461351305349,
                                 0.050722896026307, -0.025014432497508,  0.010125771319873,
                                 0.087838989859494,  0.063887760483290,  1.000000000000000,
                                 0.527975968559032, -0.166996321203654, -0.182784761112817,
                                 0.076640850473685,  0.119551901187269, -0.076351801384183,
                                -0.171910526817983,  0.051093900315790,  0.079701267458179,
                                 0.069581800501523,  0.076160317130340,  0.527975968559032,
                                 1.000000000000000,  0.129358260674865,  0.122857878797769,
                                -0.067502610823609, -0.012079168258297,  0.021733666840238,
                                 0.024255443809293,  0.001187216459674, -0.051367683779456,
                                 0.185905903090164,  0.142013482359823,  1.000000000000000,
                                 0.527975968559032,  0.167868399394157,  0.202305086530416,
                                 0.017694291095710,  0.032339735671483,  0.010173484933185,
                                -0.005494305439063, -0.173412218323226, -0.270318547606354,
                                 0.167058259833809,  0.190890394278495,  0.527975968559032,
                                 1.000000000000000,  0.026176872928789,  0.014110364749076,
                                -0.153240286696322, -0.098026870993948,  0.059823180834917,
                                 0.032247048924711,  0.162590699238329,  0.090161352960414,
                                 0.015831922529833, -0.047527929780364,  1.000000000000000,
                                 0.527975968559032,  0.011260325221278,  0.010597639756444,
                                -0.063688676776732, -0.038178933882668,  0.025733725865767,
                                 0.024219261074373,  0.053527049094418,  0.030858489332894,
                                -0.159422388590116, -0.244365136629340,  0.527975968559032,
                                 1.000000000000000,  0.084918735235353,  0.101769469078301,
                                -0.094527785740302, -0.082334909705934,  0.098671331927650,
                                 0.065815193413851, -0.027096914225495, -0.027681600247846,
                                -0.052143521732794, -0.065437362853549,  1.000000000000000,
                                 0.527975968559032,  0.183228991950306,  0.247425642527569,
                                -0.100992376446992, -0.115300380555309,  0.066721300538871,
                                 0.070943793809064, -0.036793597053011, -0.043066386670831,
                                -0.120230275918422, -0.163141177966059,  0.527975968559032,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19,
                              19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22,
                              22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 23};

    std::vector<int32_t> cols{0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 0, 1, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 2, 3, 10, 11, 12, 13, 14,
                              15, 16, 17, 18, 19, 20, 21, 22, 23, 2, 3, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 4,
                              5, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
                              22, 23, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 6, 7, 10, 11, 12, 13, 14, 15,
                              16, 17, 18, 19, 20, 21, 22, 23, 6, 7, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                              11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14,
                              15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14, 15, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18,
                              19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18, 19, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22,
                              23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22, 23};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 24, 24, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeFDForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 2);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.605807395054961,  0.054543101767814,
                                 0.087886248302264,  0.042542935532571,  0.104118475483686,
                                -0.012715343944610, -0.049303313908778,  0.230195455568257,
                                 0.215289051052512, -0.143466779088400, -0.171682292239835,
                                -0.028176580417606, -0.019931556972307, -0.095409155399526,
                                -0.141445855433664,  0.605807395054961,  1.000000000000001,
                                 0.078881234985442,  0.131898242249843,  0.121730627215164,
                                 0.216684956199423, -0.046160743862862, -0.074936007671360,
                                 0.109092298746632,  0.149243132494306, -0.110548027026855,
                                -0.165181411456373, -0.007266202197080, -0.008652936627040,
                                -0.121827615216944, -0.202022191157606,  1.000000000000000,
                                 0.605807395054961,  0.075875215442422,  0.070950962248398,
                                -0.027423331427833, -0.046346504610139,  0.060719136616991,
                                 0.084835399721424,  0.037856101441732, -0.019994780506032,
                                 0.070652303824579,  0.017857073124845,  0.166726408416221,
                                 0.138353360579615,  0.104339961344361,  0.115276026749018,
                                 0.605807395054961,  1.000000000000001,  0.035947791229989,
                                 0.049175992258720, -0.017864095231826, -0.015043946091178,
                                 0.106696455762884,  0.198709766878710, -0.051727121030135,
                                -0.097613718562815, -0.012232963104161, -0.026405283603873,
                                 0.040215520160111,  0.031172968978664,  0.066221736086145,
                                 0.094142366503075,  1.000000000000000,  0.605807395054961,
                                 0.020984018845078,  0.018108438929981,  0.154543684745005,
                                 0.109321152941631, -0.037198568356434, -0.051205246996880,
                                -0.167915279525479, -0.073724475681595, -0.024799045570956,
                                -0.034136831331253, -0.064393201977085, -0.045550480392346,
                                -0.107251651874844, -0.092554243419902,  0.605807395054961,
                                 1.000000000000001,  0.008506588245896,  0.011333223603224,
                                 0.039853866047467,  0.047459865263572, -0.008944961524590,
                                 0.006729122408351,  0.053856544612895,  0.140364357372367,
                                -0.005963307683060,  0.004486081605568, -0.016605777519778,
                                -0.019774943859822, -0.043478117701246, -0.057925365083142,
                                 1.000000000000000,  0.605807395054961, -0.150352124490782,
                                -0.147824122989927, -0.137743775045190, -0.122468682810906,
                                 0.070652303824579,  0.017857073124845,  0.025237400961155,
                                -0.013329853670688,  0.001842216763175,  0.069954505450719,
                                -0.175556790879774, -0.127534857650207,  0.030246486988888,
                                 0.038674100142830,  0.605807395054961,  1.000000000000001,
                                -0.078087394586635, -0.108272552845000, -0.037118740780333,
                                -0.029186726707457, -0.012232963104161, -0.026405283603873,
                                -0.034484747353423, -0.065075812375210,  0.116890591683018,
                                 0.220714169881937, -0.033692078728470, -0.025195851032903,
                                 0.024181013217003,  0.035163557469645,  1.000000000000000,
                                 0.605807395054961,  0.074599108885577,  0.126725239179253,
                                -0.028176580417606, -0.019931556972307,  0.180784908039845,
                                 0.201000488652836, -0.095914773153440, -0.089703771271880,
                                -0.203452447474220, -0.199151873353002, -0.013340615629014,
                                 0.064587554155278,  0.058795741088922,  0.090894481439681,
                                 0.605807395054961,  1.000000000000000,  0.116461101486041,
                                 0.195631493243872, -0.007266202197080, -0.008652936627040,
                                 0.122940100396624,  0.181014631441172, -0.045455124477763,
                                -0.062184638539294, -0.109498007752791, -0.155861354260336,
                                 0.107319326190956,  0.199523298555793,  0.079977909483215,
                                 0.133204214017809,  0.054543101767814,  0.078881234985442,
                                 0.075875215442422,  0.035947791229989,  0.020984018845078,
                                 0.008506588245896, -0.150352124490782, -0.078087394586635,
                                 0.074599108885577,  0.116461101486041,  1.000000000000000,
                                 0.867095998733913,  0.087886248302264,  0.131898242249843,
                                 0.070950962248398,  0.049175992258720,  0.018108438929981,
                                 0.011333223603224, -0.147824122989927, -0.108272552845000,
                                 0.126725239179253,  0.195631493243872,  0.867095998733913,
                                 1.000000000000000,  0.042542935532571,  0.121730627215164,
                                -0.027423331427833, -0.017864095231826,  0.154543684745005,
                                 0.039853866047467, -0.137743775045190, -0.037118740780333,
                                -0.028176580417606, -0.007266202197080,  0.999999999999999,
                                 0.867095998733913,  0.104118475483686,  0.216684956199423,
                                -0.046346504610139, -0.015043946091178,  0.109321152941631,
                                 0.047459865263572, -0.122468682810906, -0.029186726707457,
                                -0.019931556972307, -0.008652936627040,  0.867095998733913,
                                 1.000000000000000, -0.012715343944610, -0.046160743862862,
                                 0.060719136616991,  0.106696455762884, -0.037198568356434,
                                -0.008944961524590,  0.070652303824579, -0.012232963104161,
                                 0.180784908039845,  0.122940100396624,  1.000000000000000,
                                 0.867095998733913, -0.049303313908778, -0.074936007671360,
                                 0.084835399721424,  0.198709766878710, -0.051205246996880,
                                 0.006729122408351,  0.017857073124845, -0.026405283603873,
                                 0.201000488652836,  0.181014631441172,  0.867095998733913,
                                 1.000000000000000,  0.230195455568257,  0.109092298746632,
                                 0.037856101441732, -0.051727121030135, -0.167915279525479,
                                 0.053856544612895,  0.025237400961155, -0.034484747353423,
                                -0.095914773153440, -0.045455124477763,  0.999999999999999,
                                 0.867095998733913,  0.215289051052512,  0.149243132494306,
                                -0.019994780506032, -0.097613718562815, -0.073724475681595,
                                 0.140364357372367, -0.013329853670688, -0.065075812375210,
                                -0.089703771271880, -0.062184638539294,  0.867095998733913,
                                 1.000000000000000, -0.143466779088400, -0.110548027026855,
                                 0.070652303824579, -0.012232963104161, -0.024799045570956,
                                -0.005963307683060,  0.001842216763175,  0.116890591683018,
                                -0.203452447474220, -0.109498007752791,  1.000000000000000,
                                 0.867095998733913, -0.171682292239835, -0.165181411456373,
                                 0.017857073124845, -0.026405283603873, -0.034136831331253,
                                 0.004486081605568,  0.069954505450719,  0.220714169881937,
                                -0.199151873353002, -0.155861354260336,  0.867095998733913,
                                 1.000000000000000, -0.028176580417606, -0.007266202197080,
                                 0.166726408416221,  0.040215520160111, -0.064393201977085,
                                -0.016605777519778, -0.175556790879774, -0.033692078728470,
                                -0.013340615629014,  0.107319326190956,  1.000000000000000,
                                 0.867095998733913, -0.019931556972307, -0.008652936627040,
                                 0.138353360579615,  0.031172968978664, -0.045550480392346,
                                -0.019774943859822, -0.127534857650207, -0.025195851032903,
                                 0.064587554155278,  0.199523298555793,  0.867095998733913,
                                 1.000000000000000, -0.095409155399526, -0.121827615216944,
                                 0.104339961344361,  0.066221736086145, -0.107251651874844,
                                -0.043478117701246,  0.030246486988888,  0.024181013217003,
                                 0.058795741088922,  0.079977909483215,  1.000000000000000,
                                 0.867095998733913, -0.141445855433664, -0.202022191157606,
                                 0.115276026749018,  0.094142366503075, -0.092554243419902,
                                -0.057925365083142,  0.038674100142830,  0.035163557469645,
                                 0.090894481439681,  0.133204214017809,  0.867095998733913,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19,
                              19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22,
                              22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 23};

    std::vector<int32_t> cols{0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 0, 1, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 2, 3, 10, 11, 12, 13, 14,
                              15, 16, 17, 18, 19, 20, 21, 22, 23, 2, 3, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 4,
                              5, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
                              22, 23, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 6, 7, 10, 11, 12, 13, 14, 15,
                              16, 17, 18, 19, 20, 21, 22, 23, 6, 7, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                              11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14,
                              15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14, 15, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18,
                              19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18, 19, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22,
                              23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22, 23};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 24, 24, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeFFForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 3);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.867095998733913, -0.026206740851928,
                                 0.065326145719012, -0.079818562354576, -0.107048887779994,
                                -0.096658006494733, -0.051789728870117, -0.028476941756805,
                                -0.012180463926395,  0.185886482758801,  0.110020381433137,
                                -0.108237490771801, -0.158004523860654,  0.001705787953135,
                                 0.000381349598797,  0.867095998733913,  1.000000000000000,
                                 0.003979390903014,  0.136965076932772, -0.100241884736763,
                                -0.155724854093627, -0.073387156619847, -0.065408217428623,
                                -0.019726646662781, -0.014398172251002,  0.149238050827686,
                                 0.141080512550526, -0.144575844413036, -0.230971127604670,
                                 0.000859100287635,  0.000388378257661, -0.026206740851928,
                                 0.003979390903014,  1.000000000000000,  0.527975968559032,
                                -0.079818562354576, -0.100241884736763, -0.096658006494734,
                                -0.073387156619847, -0.028476941756805, -0.019726646662781,
                                 0.185886482758801,  0.149238050827686, -0.108237490771801,
                                -0.144575844413036,  0.001705787953135,  0.000859100287635,
                                 0.065326145719012,  0.136965076932772,  0.527975968559032,
                                 1.000000000000000, -0.107048887779994, -0.155724854093627,
                                -0.051789728870117, -0.065408217428623, -0.012180463926395,
                                -0.014398172251002,  0.110020381433137,  0.141080512550526,
                                -0.158004523860654, -0.230971127604670,  0.000381349598797,
                                 0.000388378257661, -0.079818562354576, -0.107048887779994,
                                 0.999999999999999,  0.867095998733913, -0.032172431615270,
                                -0.040893621948473, -0.024438895789712, -0.029340342257152,
                                -0.119715878614882,  0.007450513329043,  0.045532909915434,
                                -0.038555878912511,  0.028449029186813,  0.002645824285130,
                                 0.141376334239227,  0.165413114499176, -0.100241884736763,
                                -0.155724854093627,  0.867095998733913,  1.000000000000000,
                                -0.056370409440336, -0.035590364704081, -0.016936892903362,
                                -0.050554316796204, -0.044180375013568,  0.030440439667082,
                                 0.004023629108336, -0.074705661963733,  0.010888125711189,
                                 0.001421239276225,  0.161265837974336,  0.238516266062904,
                                -0.079818562354576, -0.100241884736763, -0.032172431615270,
                                -0.056370409440336,  1.000000000000000,  0.527975968559032,
                                -0.024438895789712, -0.016936892903362, -0.119715878614882,
                                -0.044180375013568,  0.045532909915434,  0.004023629108336,
                                 0.028449029186813,  0.010888125711189,  0.141376334239227,
                                 0.161265837974336, -0.107048887779994, -0.155724854093627,
                                -0.040893621948473, -0.035590364704081,  0.527975968559032,
                                 1.000000000000000, -0.029340342257152, -0.050554316796204,
                                 0.007450513329043,  0.030440439667082, -0.038555878912511,
                                -0.074705661963733,  0.002645824285130,  0.001421239276225,
                                 0.165413114499176,  0.238516266062904, -0.096658006494734,
                                -0.051789728870117, -0.024438895789712, -0.029340342257152,
                                 1.000000000000000,  0.867095998733913, -0.168700722293334,
                                -0.160792453902339,  0.059772519773506,  0.000872810873875,
                                -0.008192852088301, -0.003299619417246, -0.070190285995435,
                                 0.036919488570546, -0.119085420688426, -0.089332022222784,
                                -0.073387156619847, -0.065408217428623, -0.016936892903362,
                                -0.050554316796204,  0.867095998733913,  1.000000000000000,
                                -0.179003046997340, -0.208981620898678,  0.032079649292818,
                                -0.013065917531965,  0.006577491526558, -0.012479606579333,
                                -0.012852319647350,  0.074367917994561, -0.110265405813272,
                                -0.118038180263324, -0.096658006494733, -0.073387156619847,
                                -0.024438895789712, -0.016936892903362, -0.168700722293334,
                                -0.179003046997340,  1.000000000000000,  0.527975968559032,
                                 0.059772519773506,  0.032079649292818, -0.008192852088301,
                                 0.006577491526558, -0.070190285995435, -0.012852319647350,
                                -0.119085420688426, -0.110265405813272, -0.051789728870117,
                                -0.065408217428623, -0.029340342257152, -0.050554316796204,
                                -0.160792453902339, -0.208981620898678,  0.527975968559032,
                                 1.000000000000000,  0.000872810873875, -0.013065917531965,
                                -0.003299619417246, -0.012479606579333,  0.036919488570546,
                                 0.074367917994561, -0.089332022222784, -0.118038180263324,
                                -0.028476941756805, -0.012180463926395, -0.119715878614882,
                                 0.007450513329043,  0.059772519773506,  0.000872810873875,
                                 0.999999999999999,  0.867095998733913, -0.027958434662861,
                                -0.160399824420195,  0.039848346515671,  0.000581873915917,
                                 0.049881616089534, -0.003104380553768,  0.145548813423668,
                                 0.062255704512687, -0.019726646662781, -0.014398172251002,
                                -0.044180375013568,  0.030440439667082,  0.032079649292818,
                                -0.013065917531965,  0.867095998733913,  1.000000000000000,
                                -0.133964268756286, -0.221328119195027,  0.021386432861879,
                                -0.008710611687977,  0.018408489588987, -0.012683516527951,
                                 0.100825082943104,  0.073590658171787, -0.028476941756805,
                                -0.019726646662781, -0.119715878614882, -0.044180375013568,
                                 0.059772519773506,  0.032079649292818, -0.027958434662861,
                                -0.133964268756286,  1.000000000000000,  0.527975968559032,
                                 0.039848346515671,  0.021386432861879,  0.049881616089534,
                                 0.018408489588987,  0.145548813423668,  0.100825082943104,
                                -0.012180463926395, -0.014398172251002,  0.007450513329043,
                                 0.030440439667082,  0.000872810873875, -0.013065917531965,
                                -0.160399824420195, -0.221328119195027,  0.527975968559032,
                                 1.000000000000000,  0.000581873915917, -0.008710611687977,
                                -0.003104380553768, -0.012683516527951,  0.062255704512687,
                                 0.073590658171787,  0.185886482758801,  0.110020381433137,
                                 0.045532909915434, -0.038555878912511, -0.008192852088301,
                                -0.003299619417246,  0.039848346515671,  0.000581873915917,
                                 1.000000000000000,  0.867095998733913, -0.161873345553083,
                                -0.158042771054634,  0.101587693063624, -0.020976569398219,
                                -0.030413619941611, -0.031273772653183,  0.149238050827686,
                                 0.141080512550526,  0.004023629108336, -0.074705661963733,
                                 0.006577491526558, -0.012479606579333,  0.021386432861879,
                                -0.008710611687977,  0.867095998733913,  1.000000000000000,
                                -0.184484289936138, -0.198581948749234,  0.028187525407153,
                                -0.048828069842659, -0.034739283647219, -0.042557904577148,
                                 0.185886482758801,  0.149238050827686,  0.045532909915434,
                                 0.004023629108336, -0.008192852088301,  0.006577491526558,
                                 0.039848346515671,  0.021386432861879, -0.161873345553083,
                                -0.184484289936138,  1.000000000000000,  0.527975968559032,
                                 0.101587693063624,  0.028187525407153, -0.030413619941611,
                                -0.034739283647219,  0.110020381433137,  0.141080512550526,
                                -0.038555878912511, -0.074705661963733, -0.003299619417246,
                                -0.012479606579333,  0.000581873915917, -0.008710611687977,
                                -0.158042771054634, -0.198581948749234,  0.527975968559032,
                                 1.000000000000000, -0.020976569398219, -0.048828069842659,
                                -0.031273772653183, -0.042557904577148, -0.108237490771801,
                                -0.158004523860654,  0.028449029186813,  0.002645824285130,
                                -0.070190285995435,  0.036919488570546,  0.049881616089534,
                                -0.003104380553768,  0.101587693063624, -0.020976569398219,
                                 1.000000000000000,  0.867095998733913,  0.024251476271909,
                                -0.035646070449633, -0.086590654319443, -0.108562871126559,
                                -0.144575844413036, -0.230971127604670,  0.010888125711189,
                                 0.001421239276225, -0.012852319647350,  0.074367917994561,
                                 0.018408489588987, -0.012683516527951,  0.028187525407153,
                                -0.048828069842659,  0.867095998733913,  1.000000000000000,
                                -0.034775626779811, -0.032771573472902, -0.103652570188151,
                                -0.157266741684756, -0.108237490771801, -0.144575844413036,
                                 0.028449029186813,  0.010888125711189, -0.070190285995435,
                                -0.012852319647350,  0.049881616089534,  0.018408489588987,
                                 0.101587693063624,  0.028187525407153,  0.024251476271909,
                                -0.034775626779811,  1.000000000000000,  0.527975968559032,
                                -0.086590654319443, -0.103652570188151, -0.158004523860654,
                                -0.230971127604670,  0.002645824285130,  0.001421239276225,
                                 0.036919488570546,  0.074367917994561, -0.003104380553768,
                                -0.012683516527951, -0.020976569398219, -0.048828069842659,
                                -0.035646070449633, -0.032771573472902,  0.527975968559032,
                                 1.000000000000000, -0.108562871126559, -0.157266741684756,
                                 0.001705787953135,  0.000381349598797,  0.141376334239227,
                                 0.165413114499176, -0.119085420688426, -0.089332022222784,
                                 0.145548813423668,  0.062255704512687, -0.030413619941611,
                                -0.031273772653183, -0.086590654319443, -0.108562871126559,
                                 1.000000000000000,  0.867095998733913, -0.034591471491132,
                                 0.063451637425408,  0.000859100287635,  0.000388378257661,
                                 0.161265837974336,  0.238516266062904, -0.110265405813272,
                                -0.118038180263324,  0.100825082943104,  0.073590658171787,
                                -0.034739283647219, -0.042557904577148, -0.103652570188151,
                                -0.157266741684756,  0.867095998733913,  1.000000000000000,
                                -0.000243481283793,  0.135056019555137,  0.001705787953135,
                                 0.000859100287635,  0.141376334239227,  0.161265837974336,
                                -0.119085420688426, -0.110265405813272,  0.145548813423668,
                                 0.100825082943104, -0.030413619941611, -0.034739283647219,
                                -0.086590654319443, -0.103652570188151, -0.034591471491132,
                                -0.000243481283793,  1.000000000000000,  0.527975968559032,
                                 0.000381349598797,  0.000388378257661,  0.165413114499176,
                                 0.238516266062904, -0.089332022222784, -0.118038180263324,
                                 0.062255704512687,  0.073590658171787, -0.031273772653183,
                                -0.042557904577148, -0.108562871126559, -0.157266741684756,
                                 0.063451637425408,  0.135056019555137,  0.527975968559032,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
                              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,
                              17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,
                              21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
                              22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25,
                              25, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26,
                              26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 27, 27, 27, 27, 27};

    std::vector<int32_t> cols{0, 1, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22, 23,
                              26, 27, 0, 1, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19,
                              22, 23, 26, 27, 0, 1, 2, 3, 4, 5, 8, 9, 12, 13, 16,
                              17, 20, 21, 24, 25, 0, 1, 2, 3, 4, 5, 8, 9, 12, 13,
                              16, 17, 20, 21, 24, 25, 2, 3, 4, 5, 6, 7, 10, 11,
                              14, 15, 18, 19, 22, 23, 26, 27, 2, 3, 4, 5, 6, 7,
                              10, 11, 14, 15, 18, 19, 22, 23, 26, 27, 0, 1, 4, 5,
                              6, 7, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 0, 1,
                              4, 5, 6, 7, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25,
                              2, 3, 6, 7, 8, 9, 10, 11, 14, 15, 18, 19, 22, 23,
                              26, 27, 2, 3, 6, 7, 8, 9, 10, 11, 14, 15, 18, 19,
                              22, 23, 26, 27, 0, 1, 4, 5, 8, 9, 10, 11, 12, 13,
                              16, 17, 20, 21, 24, 25, 0, 1, 4, 5, 8, 9, 10, 11,
                              12, 13, 16, 17, 20, 21, 24, 25, 2, 3, 6, 7, 10, 11,
                              12, 13, 14, 15, 18, 19, 22, 23, 26, 27, 2, 3, 6, 7,
                              10, 11, 12, 13, 14, 15, 18, 19, 22, 23, 26, 27, 0,
                              1, 4, 5, 8, 9, 12, 13, 14, 15, 16, 17, 20, 21, 24,
                              25, 0, 1, 4, 5, 8, 9, 12, 13, 14, 15, 16, 17, 20,
                              21, 24, 25, 2, 3, 6, 7, 10, 11, 14, 15, 16, 17, 18,
                              19, 22, 23, 26, 27, 2, 3, 6, 7, 10, 11, 14, 15, 16,
                              17, 18, 19, 22, 23, 26, 27, 0, 1, 4, 5, 8, 9, 12,
                              13, 16, 17, 18, 19, 20, 21, 24, 25, 0, 1, 4, 5, 8,
                              9, 12, 13, 16, 17, 18, 19, 20, 21, 24, 25, 2, 3, 6,
                              7, 10, 11, 14, 15, 18, 19, 20, 21, 22, 23, 26, 27,
                              2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 20, 21, 22, 23,
                              26, 27, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21,
                              22, 23, 24, 25, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17,
                              20, 21, 22, 23, 24, 25, 2, 3, 6, 7, 10, 11, 14, 15,
                              18, 19, 22, 23, 24, 25, 26, 27, 2, 3, 6, 7, 10, 11,
                              14, 15, 18, 19, 22, 23, 24, 25, 26, 27, 0, 1, 4, 5,
                              8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 26, 27, 0, 1,
                              4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 26, 27};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 28, 28, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeSGForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(0, 4);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.950707129188576, -0.008598432506308,
                                -0.011752667651245,  0.010032016389096,  0.013712145138825,
                                 0.109521697769087,  0.149698461148112,  0.103641051531136,
                                 0.141660568106738, -0.019505844042999, -0.026661336485017,
                                 0.069094034354091,  0.094440378737825, -0.045634040737120,
                                -0.062374358811714, -0.051274750433156, -0.070084297376218,
                                -0.008526778902089, -0.011654728754152,  0.950707129188576,
                                 1.000000000000001, -0.003677459212751, -0.007773576190495,
                                 0.004290587972340,  0.009069634923309,  0.046841279054240,
                                 0.099015170671601,  0.044326188464320,  0.093698660767439,
                                -0.008342444489246, -0.017634628720632,  0.029550792309546,
                                 0.062465773844959, -0.019517199605933, -0.041256321113167,
                                -0.021929671858628, -0.046355911830246, -0.003646813719311,
                                -0.007708796388907, -0.008598432506308, -0.003677459212751,
                                 1.000000000000000,  0.461270704598038, -0.011752667651245,
                                -0.007773576190495,  0.461270704598038,  1.000000000000001,
                                 0.010032016389096,  0.004290587972340,  1.000000000000000,
                                 0.461270704598038,  0.013712145138825,  0.009069634923309,
                                 0.461270704598038,  1.000000000000001,  0.109521697769087,
                                 0.046841279054240,  1.000000000000000,  0.461270704598038,
                                 0.149698461148112,  0.099015170671601,  0.461270704598038,
                                 1.000000000000001,  0.103641051531136,  0.044326188464320,
                                 1.000000000000001,  0.461270704598038,  0.141660568106738,
                                 0.093698660767439,  0.461270704598038,  1.000000000000001,
                                -0.019505844042999, -0.008342444489246,  1.000000000000001,
                                 0.461270704598038, -0.026661336485017, -0.017634628720632,
                                 0.461270704598038,  1.000000000000001,  0.069094034354091,
                                 0.029550792309546,  1.000000000000000,  0.461270704598038,
                                 0.094440378737825,  0.062465773844959,  0.461270704598038,
                                 1.000000000000001, -0.045634040737120, -0.019517199605933,
                                 1.000000000000001,  0.461270704598038, -0.062374358811714,
                                -0.041256321113167,  0.461270704598038,  1.000000000000001,
                                -0.051274750433156, -0.021929671858628,  1.000000000000000,
                                 0.461270704598038, -0.070084297376218, -0.046355911830246,
                                 0.461270704598038,  1.000000000000001, -0.008526778902089,
                                -0.003646813719311,  1.000000000000001,  0.461270704598038,
                                -0.011654728754152, -0.007708796388907,  0.461270704598038,
                                 1.000000000000002};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4,
                              4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8, 8,
                              9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11, 12, 12,
                              12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15,
                              15, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18,
                              19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                              15, 16, 17, 18, 19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 0, 1, 2, 3,
                              0, 1, 2, 3, 0, 1, 4, 5, 0, 1, 4, 5, 0, 1, 6, 7, 0,
                              1, 6, 7, 0, 1, 8, 9, 0, 1, 8, 9, 0, 1, 10, 11, 0,
                              1, 10, 11, 0, 1, 12, 13, 0, 1, 12, 13, 0, 1, 14, 15,
                              0, 1, 14, 15, 0, 1, 16, 17, 0, 1, 16, 17, 0, 1, 18,
                              19, 0, 1, 18, 19};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeGSForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 0);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.803613898079232, -0.012013279925530,
                                -0.014550456988883,  0.014016208304396,  0.016976399230234,
                                 0.153017984644765,  0.185335030724430,  0.144801853466473,
                                 0.175383671556422, -0.027252544519057, -0.033008219180797,
                                 0.096534568977649,  0.116922447704282, -0.063757493601985,
                                -0.077222929468512, -0.071638398000249, -0.086768262732306,
                                -0.011913169259484, -0.014429203180642,  0.803613898079232,
                                 1.000000000000000, -0.002046107370312, -0.003454922751331,
                                 0.002387247054363,  0.004030948854804,  0.026062093625789,
                                 0.044006742520712,  0.024662718379099,  0.041643849229973,
                                -0.004641665935188, -0.007837612764726,  0.016441812252732,
                                 0.027762566153315, -0.010859205677412, -0.018336142716963,
                                -0.012201484944521, -0.020602627480109, -0.002029056475560,
                                -0.003426131728403, -0.012013279925530, -0.002046107370312,
                                 1.000000000000000,  0.843105045632668, -0.014550456988883,
                                -0.003454922751331,  0.843105045632668,  1.000000000000000,
                                 0.014016208304396,  0.002387247054363,  1.000000000000000,
                                 0.843105045632668,  0.016976399230234,  0.004030948854804,
                                 0.843105045632668,  1.000000000000000,  0.153017984644765,
                                 0.026062093625789,  1.000000000000000,  0.843105045632668,
                                 0.185335030724430,  0.044006742520712,  0.843105045632668,
                                 1.000000000000000,  0.144801853466473,  0.024662718379099,
                                 1.000000000000000,  0.843105045632668,  0.175383671556422,
                                 0.041643849229973,  0.843105045632668,  1.000000000000000,
                                -0.027252544519057, -0.004641665935188,  1.000000000000000,
                                 0.843105045632668, -0.033008219180797, -0.007837612764726,
                                 0.843105045632668,  1.000000000000000,  0.096534568977649,
                                 0.016441812252732,  1.000000000000000,  0.843105045632668,
                                 0.116922447704282,  0.027762566153315,  0.843105045632668,
                                 1.000000000000000, -0.063757493601985, -0.010859205677412,
                                 1.000000000000000,  0.843105045632668, -0.077222929468512,
                                -0.018336142716963,  0.843105045632668,  1.000000000000000,
                                -0.071638398000249, -0.012201484944521,  1.000000000000000,
                                 0.843105045632668, -0.086768262732306, -0.020602627480109,
                                 0.843105045632668,  0.999999999999999, -0.011913169259484,
                                -0.002029056475560,  1.000000000000000,  0.843105045632668,
                                -0.014429203180642, -0.003426131728403,  0.843105045632668,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4,
                              4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8, 8,
                              9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 11, 12, 12,
                              12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15,
                              15, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18,
                              19, 19, 19, 19};

    std::vector<int32_t> cols{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
                              15, 16, 17, 18, 19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 0, 1, 2, 3,
                              0, 1, 2, 3, 0, 1, 4, 5, 0, 1, 4, 5, 0, 1, 6, 7, 0,
                              1, 6, 7, 0, 1, 8, 9, 0, 1, 8, 9, 0, 1, 10, 11, 0,
                              1, 10, 11, 0, 1, 12, 13, 0, 1, 12, 13, 0, 1, 14, 15,
                              0, 1, 14, 15, 0, 1, 16, 17, 0, 1, 16, 17, 0, 1, 18,
                              19, 0, 1, 18, 19};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 20, 20, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputePGForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(1, 4);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.920751180279673,  0.036684133785619,
                                 0.057195949774966,  0.065771478029235,  0.086238699836113,
                                -0.009582746670101, -0.083689189809114,  0.055393467620995,
                                 0.011626771271940,  0.141326800592460,  0.211620829104295,
                                 0.114821935974022,  0.117497351297333,  0.137750857263860,
                                 0.223326985168588,  0.088571639621622,  0.157651515319334,
                                 0.000884368048200,  0.006710461271344,  0.920751180279673,
                                 1.000000000000000,  0.022559689292169,  0.050317297342838,
                                 0.036347068152373,  0.073763988388080, -0.023178532763060,
                                -0.082490424338192,  0.015273528896946,  0.000589703222948,
                                 0.084717339302226,  0.185044664689603,  0.055142451320433,
                                 0.095431783834466,  0.086863353254335,  0.197571693626278,
                                 0.059385822741256,  0.141213549754613,  0.001884388542568,
                                 0.006591017173565,  1.000000000000000,  0.920751180279672,
                                -0.014493577662208, -0.010318186729275,  0.010741183355411,
                                 0.003346980932961,  0.039525341742333, -0.072988812860726,
                                -0.077115519108396, -0.230419093754311, -0.110379604945258,
                                -0.132600274627086, -0.051410346072264, -0.153612729169541,
                                -0.016468892392639,  0.030412005358636, -0.054899381594320,
                                -0.017106791435132, -0.014372797848356, -0.010232201839864,
                                 0.920751180279672,  1.000000000000000, -0.005825710684502,
                                -0.007493662936354,  0.003236324653065,  0.001216320017501,
                                -0.009539279066358, -0.081571344844252, -0.075127625983966,
                                -0.216917728246462, -0.057949351629461, -0.111559339875629,
                                -0.050085083989311, -0.144611818830975,  0.003974699610983,
                                 0.033988060351772, -0.016541214893444, -0.006216746756116,
                                -0.005777163095465, -0.007431215745217,  1.000000000000000,
                                 0.920751180279673, -0.013994467842652, -0.016043730176461,
                                -0.129565667816026, -0.186835754542611, -0.109279302511850,
                                -0.200759323525146,  0.114821935974022,  0.117497351297333,
                                 0.094217867061640,  0.141080552736196, -0.040291479024023,
                                -0.086287688142505, -0.155104026513706, -0.199035015986709,
                                 0.025119066736451,  0.057297662606364,  0.039363249656512,
                                 0.059103250958257,  0.920751180279673,  1.000000000000000,
                                -0.007154008661732, -0.013369375920540, -0.075863420862226,
                                -0.162408829267500, -0.074841302305932, -0.180532603521896,
                                 0.055142451320433,  0.095431783834466,  0.056478226201484,
                                 0.123363109793069, -0.030678513870081, -0.078936783305774,
                                -0.084624570943785, -0.169579107093925,  0.020006783349078,
                                 0.052745336204467,  0.023636563085365,  0.051702489582589,
                                 0.036684133785619,  0.022559689292169, -0.014493577662208,
                                -0.005825710684502, -0.013994467842652, -0.007154008661732,
                                 1.000000000000000,  0.461270704598038,  0.057195949774966,
                                 0.050317297342838, -0.010318186729275, -0.007493662936354,
                                -0.016043730176461, -0.013369375920540,  0.461270704598038,
                                 1.000000000000001,  0.065771478029235,  0.036347068152373,
                                 0.010741183355411,  0.003236324653065, -0.129565667816026,
                                -0.075863420862226,  1.000000000000000,  0.461270704598038,
                                 0.086238699836113,  0.073763988388080,  0.003346980932961,
                                 0.001216320017501, -0.186835754542611, -0.162408829267500,
                                 0.461270704598038,  1.000000000000001, -0.009582746670101,
                                -0.023178532763060,  0.039525341742333, -0.009539279066358,
                                -0.109279302511850, -0.074841302305932,  1.000000000000000,
                                 0.461270704598038, -0.083689189809114, -0.082490424338192,
                                -0.072988812860726, -0.081571344844252, -0.200759323525146,
                                -0.180532603521896,  0.461270704598038,  1.000000000000001,
                                 0.055393467620995,  0.015273528896946, -0.077115519108396,
                                -0.075127625983966,  0.114821935974022,  0.055142451320433,
                                 1.000000000000001,  0.461270704598038,  0.011626771271940,
                                 0.000589703222948, -0.230419093754311, -0.216917728246462,
                                 0.117497351297333,  0.095431783834466,  0.461270704598038,
                                 1.000000000000001,  0.141326800592460,  0.084717339302226,
                                -0.110379604945258, -0.057949351629461,  0.094217867061640,
                                 0.056478226201484,  1.000000000000001,  0.461270704598038,
                                 0.211620829104295,  0.185044664689603, -0.132600274627086,
                                -0.111559339875629,  0.141080552736196,  0.123363109793069,
                                 0.461270704598038,  1.000000000000001,  0.114821935974022,
                                 0.055142451320433, -0.051410346072264, -0.050085083989311,
                                -0.040291479024023, -0.030678513870081,  1.000000000000000,
                                 0.461270704598038,  0.117497351297333,  0.095431783834466,
                                -0.153612729169541, -0.144611818830975, -0.086287688142505,
                                -0.078936783305774,  0.461270704598038,  1.000000000000001,
                                 0.137750857263860,  0.086863353254335, -0.016468892392639,
                                 0.003974699610983, -0.155104026513706, -0.084624570943785,
                                 1.000000000000001,  0.461270704598038,  0.223326985168588,
                                 0.197571693626278,  0.030412005358636,  0.033988060351772,
                                -0.199035015986709, -0.169579107093925,  0.461270704598038,
                                 1.000000000000001,  0.088571639621622,  0.059385822741256,
                                -0.054899381594320, -0.016541214893444,  0.025119066736451,
                                 0.020006783349078,  1.000000000000000,  0.461270704598038,
                                 0.157651515319334,  0.141213549754613, -0.017106791435132,
                                -0.006216746756116,  0.057297662606364,  0.052745336204467,
                                 0.461270704598038,  1.000000000000001,  0.000884368048200,
                                 0.001884388542568, -0.014372797848356, -0.005777163095465,
                                 0.039363249656512,  0.023636563085365,  1.000000000000001,
                                 0.461270704598038,  0.006710461271344,  0.006591017173565,
                                -0.010232201839864, -0.007431215745217,  0.059103250958257,
                                 0.051702489582589,  0.461270704598038,  1.000000000000002};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10,
                              10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11,
                              11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13,
                              13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14,
                              15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16,
                              16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18,
                              18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19,
                              19, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21,
                              21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 23,
                              23, 23, 23, 23, 23, 23, 23};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 0, 1, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 2,
                              3, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 2, 3, 6, 7, 8, 9, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3,
                              4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4,
                              5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5,
                              10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1, 2, 3, 4, 5,
                              12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1, 2, 3, 4, 5,
                              14, 15, 0, 1, 2, 3, 4, 5, 14, 15, 0, 1, 2, 3, 4, 5,
                              16, 17, 0, 1, 2, 3, 4, 5, 16, 17, 0, 1, 2, 3, 4, 5,
                              18, 19, 0, 1, 2, 3, 4, 5, 18, 19, 0, 1, 2, 3, 4, 5,
                              20, 21, 0, 1, 2, 3, 4, 5, 20, 21, 0, 1, 2, 3, 4, 5,
                              22, 23, 0, 1, 2, 3, 4, 5, 22, 23};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 24, 24, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeGPForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 1);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.696850865854261, -0.048582125135964,
                                -0.062158152649149, -0.085640787923704, -0.100637778138628,
                                 0.018856949718915,  0.061790917344257, -0.066656011587540,
                                -0.044335700044870, -0.186381325684887, -0.233682690049012,
                                -0.146544370841782, -0.153787270310413, -0.183195594003280,
                                -0.239074620485013, -0.119052582378958, -0.163034817636014,
                                -0.001649402677376, -0.005031295470482,  0.696850865854261,
                                 1.000000000000000, -0.016027638029976, -0.027389267494634,
                                -0.024004508504422, -0.040152029542973,  0.024132812566691,
                                 0.044902099620941, -0.002517577831916, -0.000320993776866,
                                -0.059214607824178, -0.100725557358652, -0.032315893446609,
                                -0.051946483475117, -0.062666169734870, -0.107544408222638,
                                -0.044371380802657, -0.076866920370206, -0.001933252620127,
                                -0.003587695324701,  1.000000000000000,  0.696850865854261,
                                 0.018093002429259,  0.016421582176613, -0.013023055587283,
                                -0.009320892109371, -0.040270983066144,  0.022225572338113,
                                 0.112009556681415,  0.203675924652056,  0.142637071756431,
                                 0.160857015091668,  0.074673037787610,  0.135783949768037,
                                 0.016779576277560, -0.009260655140880,  0.066562284112780,
                                 0.047640115225676,  0.017942227409015,  0.016284735658475,
                                 0.696850865854261,  1.000000000000000,  0.002769732995827,
                                 0.004079033444105, -0.000805135162360, -0.000662080757069,
                                 0.021786914887220,  0.044401816111339,  0.065660498865669,
                                 0.118075055637231,  0.036766347391962,  0.060725213052670,
                                 0.043773665910446,  0.078716703758154, -0.009077881203008,
                                -0.018500756713058,  0.004115135274287,  0.003383968313908,
                                 0.002746651887528,  0.004045041498737,  1.000000000000000,
                                 0.696850865854261,  0.018015345783842,  0.019885362984782,
                                 0.170227321217971,  0.209482066095596,  0.147447093366762,
                                 0.205292717915330, -0.146544370841782, -0.153787270310413,
                                -0.124254217123258, -0.155788460032675,  0.055464297447278,
                                 0.083820358547141,  0.201571508527780,  0.234453974922638,
                                -0.034892505241683, -0.054577590082876, -0.051926589221372,
                                -0.065193657233311,  0.696850865854261,  1.000000000000000,
                                 0.004438602011807,  0.007277366485506,  0.052205368736358,
                                 0.088404169206259,  0.056558411838370,  0.098269502347739,
                                -0.032315893446609, -0.051946483475117, -0.039476405216119,
                                -0.067150371572435,  0.024412333373592,  0.042967742452398,
                                 0.055350241815468,  0.092307174092644, -0.016235803803501,
                                -0.028710924447220, -0.016539618977689, -0.028143270646423,
                                -0.048582125135964, -0.016027638029976,  0.018093002429259,
                                 0.002769732995827,  0.018015345783842,  0.004438602011807,
                                 1.000000000000000,  0.843105045632668, -0.062158152649149,
                                -0.027389267494634,  0.016421582176613,  0.004079033444105,
                                 0.019885362984782,  0.007277366485506,  0.843105045632668,
                                 1.000000000000000, -0.085640787923704, -0.024004508504422,
                                -0.013023055587283, -0.000805135162360,  0.170227321217971,
                                 0.052205368736358,  1.000000000000000,  0.843105045632668,
                                -0.100637778138628, -0.040152029542973, -0.009320892109371,
                                -0.000662080757069,  0.209482066095596,  0.088404169206259,
                                 0.843105045632668,  1.000000000000000,  0.018856949718915,
                                 0.024132812566691, -0.040270983066144,  0.021786914887220,
                                 0.147447093366762,  0.056558411838370,  1.000000000000000,
                                 0.843105045632668,  0.061790917344257,  0.044902099620941,
                                 0.022225572338113,  0.044401816111339,  0.205292717915330,
                                 0.098269502347739,  0.843105045632668,  1.000000000000000,
                                -0.066656011587540, -0.002517577831916,  0.112009556681415,
                                 0.065660498865669, -0.146544370841782, -0.032315893446609,
                                 1.000000000000000,  0.843105045632668, -0.044335700044870,
                                -0.000320993776866,  0.203675924652056,  0.118075055637231,
                                -0.153787270310413, -0.051946483475117,  0.843105045632668,
                                 1.000000000000000, -0.186381325684887, -0.059214607824178,
                                 0.142637071756431,  0.036766347391962, -0.124254217123258,
                                -0.039476405216119,  1.000000000000000,  0.843105045632668,
                                -0.233682690049012, -0.100725557358652,  0.160857015091668,
                                 0.060725213052670, -0.155788460032675, -0.067150371572435,
                                 0.843105045632668,  1.000000000000000, -0.146544370841782,
                                -0.032315893446609,  0.074673037787610,  0.043773665910446,
                                 0.055464297447278,  0.024412333373592,  1.000000000000000,
                                 0.843105045632668, -0.153787270310413, -0.051946483475117,
                                 0.135783949768037,  0.078716703758154,  0.083820358547141,
                                 0.042967742452398,  0.843105045632668,  1.000000000000000,
                                -0.183195594003280, -0.062666169734870,  0.016779576277560,
                                -0.009077881203008,  0.201571508527780,  0.055350241815468,
                                 1.000000000000000,  0.843105045632668, -0.239074620485013,
                                -0.107544408222638, -0.009260655140880, -0.018500756713058,
                                 0.234453974922638,  0.092307174092644,  0.843105045632668,
                                 1.000000000000000, -0.119052582378958, -0.044371380802657,
                                 0.066562284112780,  0.004115135274287, -0.034892505241683,
                                -0.016235803803501,  1.000000000000000,  0.843105045632668,
                                -0.163034817636014, -0.076866920370206,  0.047640115225676,
                                 0.003383968313908, -0.054577590082876, -0.028710924447220,
                                 0.843105045632668,  0.999999999999999, -0.001649402677376,
                                -0.001933252620127,  0.017942227409015,  0.002746651887528,
                                -0.051926589221372, -0.016539618977689,  1.000000000000000,
                                 0.843105045632668, -0.005031295470482, -0.003587695324701,
                                 0.016284735658475,  0.004045041498737, -0.065193657233311,
                                -0.028143270646423,  0.843105045632668,  1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7,
                              8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10,
                              10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11,
                              11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13,
                              13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14,
                              15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16,
                              16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18,
                              18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19,
                              19, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21,
                              21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 23,
                              23, 23, 23, 23, 23, 23, 23};

    std::vector<int32_t> cols{0, 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 0, 1, 6, 7, 8, 9, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 2,
                              3, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 2, 3, 6, 7, 8, 9, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 0, 1, 2, 3,
                              4, 5, 6, 7, 0, 1, 2, 3, 4, 5, 6, 7, 0, 1, 2, 3, 4,
                              5, 8, 9, 0, 1, 2, 3, 4, 5, 8, 9, 0, 1, 2, 3, 4, 5,
                              10, 11, 0, 1, 2, 3, 4, 5, 10, 11, 0, 1, 2, 3, 4, 5,
                              12, 13, 0, 1, 2, 3, 4, 5, 12, 13, 0, 1, 2, 3, 4, 5,
                              14, 15, 0, 1, 2, 3, 4, 5, 14, 15, 0, 1, 2, 3, 4, 5,
                              16, 17, 0, 1, 2, 3, 4, 5, 16, 17, 0, 1, 2, 3, 4, 5,
                              18, 19, 0, 1, 2, 3, 4, 5, 18, 19, 0, 1, 2, 3, 4, 5,
                              20, 21, 0, 1, 2, 3, 4, 5, 20, 21, 0, 1, 2, 3, 4, 5,
                              22, 23, 0, 1, 2, 3, 4, 5, 22, 23};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 24, 24, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeDGForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(2, 4);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.892931005151188, -0.035942415937939,
                                -0.060638547440046,  0.072340961792068,  0.162882287014036,
                                 0.013713832966291,  0.115274196122890,  0.022459140058988,
                                -0.047435245516128,  0.204111119165449,  0.170333467724208,
                                -0.093881388556695, -0.147556097137416, -0.032687907133129,
                                -0.014571958201470, -0.129124610280075, -0.251926145964626,
                                -0.079371462337663, -0.142991164350927,  0.892931005151188,
                                 1.000000000000000, -0.029670105419852, -0.068933378817561,
                                 0.072441582793314,  0.190723216399373,  0.036308297730328,
                                 0.148659626117507, -0.010570520039172, -0.062106702294233,
                                 0.117279698370071,  0.165831785080540, -0.076960819989845,
                                -0.162400164282021, -0.013411121097679, -0.012305382112759,
                                -0.116407573990895, -0.292121573604014, -0.068619275447229,
                                -0.163422213160314,  1.000000000000000,  0.892931005151188,
                                 0.061537101891343,  0.050762834739171,  0.069562475300250,
                                 0.020528859588001,  0.020168709725662,  0.069793668310725,
                                 0.106131005460443,  0.190206697461651, -0.058303098474334,
                                -0.191482892396841,  0.008109330257787, -0.057375533424759,
                                 0.035249031273098, -0.125500332655964,  0.091548116721840,
                                 0.037366981211033,  0.001329889113362,  0.005981717891998,
                                 0.892931005151188,  1.000000000000000,  0.035716868126747,
                                 0.048505457065767,  0.027441066890521,  0.009892417545556,
                                 0.018604381809537,  0.096728878061302,  0.083143659118346,
                                 0.228561618295110, -0.075437193402650, -0.232682167104457,
                                -0.020772922519676, -0.067645463513191, -0.023474839237945,
                                -0.174752785540353,  0.044665877057131,  0.018938013355694,
                                 0.002963911251545,  0.006353685857844,  1.000000000000001,
                                 0.892931005151189, -0.031717007800158, -0.019383834893868,
                                 0.019035275782663,  0.009262524728056,  0.060416749575079,
                                 0.047780476169614, -0.043774786607055,  0.135548424257790,
                                -0.017816807729650,  0.195180503563768, -0.029183191071370,
                                 0.090365616171860, -0.025173645656283, -0.019908531737339,
                                -0.097291409555833, -0.047341793054511, -0.031452699401824,
                                -0.019222302936420,  0.892931005151189,  1.000000000000001,
                                -0.015366372132983, -0.017636344652640,  0.008158334965977,
                                 0.008009530389103,  0.026133374195345,  0.056297098502386,
                                 0.020475495948937,  0.194371122293959,  0.055485341896116,
                                 0.252539262235042,  0.013650330632625,  0.129580748195973,
                                -0.010888905914727, -0.023457124375994, -0.041698156492770,
                                -0.040937599766527, -0.015238319031875, -0.017489375113868,
                                 1.000000000000000,  0.892931005151188, -0.023641938395037,
                                -0.014211028641772, -0.136164580626432, -0.044409751506991,
                                -0.020133162997346,  0.120698064150608,  0.008109330257787,
                                -0.057375533424759, -0.038868732316222, -0.127655261597894,
                                 0.099373230245620,  0.238019641982283, -0.057090172572625,
                                 0.094338596226990,  0.025317815261530,  0.013544779044509,
                                 0.066096683151585,  0.052444536433430,  0.892931005151188,
                                 1.000000000000000, -0.011347449535196, -0.012887967437745,
                                -0.057205926453651, -0.021780491908144,  0.024497546963259,
                                 0.167908292821492, -0.020772922519676, -0.067645463513191,
                                -0.050291462268433, -0.155121444736305,  0.100454427884743,
                                 0.284932837889436,  0.013377208991266,  0.131711840846595,
                                 0.015005517905639,  0.007073626314377,  0.037430087005483,
                                 0.049840770889465,  1.000000000000001,  0.892931005151188,
                                 0.076558248266515,  0.141953571949402,  0.097570607581594,
                                 0.240288143093313, -0.032687907133129, -0.014571958201470,
                                 0.132152418150248,  0.170477065796384, -0.085046299652270,
                                -0.070972278218420, -0.173148344530283, -0.164586863106405,
                                -0.051117182847748,  0.086373145689975,  0.078789183449044,
                                 0.165260572357923, -0.029028296813802, -0.058088426018424,
                                 0.892931005151188,  1.000000000000000,  0.067562237271675,
                                 0.162598338461340,  0.104551460449481,  0.282880703973352,
                                -0.013411121097679, -0.012305382112759,  0.095292331969171,
                                 0.183172197534223, -0.048866540987530, -0.069096577116892,
                                -0.104264914600172, -0.168274872249930,  0.009709574219932,
                                 0.124253951593869,  0.074864440166937,  0.192611635318871,
                                -0.027072191546358, -0.066908517691461, -0.035942415937939,
                                -0.029670105419852,  0.061537101891343,  0.035716868126747,
                                -0.031717007800158, -0.015366372132983, -0.023641938395037,
                                -0.011347449535196,  0.076558248266515,  0.067562237271675,
                                 1.000000000000000,  0.461270704598038, -0.060638547440046,
                                -0.068933378817561,  0.050762834739171,  0.048505457065767,
                                -0.019383834893868, -0.017636344652640, -0.014211028641772,
                                -0.012887967437745,  0.141953571949402,  0.162598338461340,
                                 0.461270704598038,  1.000000000000001,  0.072340961792068,
                                 0.072441582793314,  0.069562475300250,  0.027441066890521,
                                 0.019035275782663,  0.008158334965977, -0.136164580626432,
                                -0.057205926453651,  0.097570607581594,  0.104551460449481,
                                 1.000000000000000,  0.461270704598038,  0.162882287014036,
                                 0.190723216399373,  0.020528859588001,  0.009892417545556,
                                 0.009262524728056,  0.008009530389103, -0.044409751506991,
                                -0.021780491908144,  0.240288143093313,  0.282880703973352,
                                 0.461270704598038,  1.000000000000001,  0.013713832966291,
                                 0.036308297730328,  0.020168709725662,  0.018604381809537,
                                 0.060416749575079,  0.026133374195345, -0.020133162997346,
                                 0.024497546963259, -0.032687907133129, -0.013411121097679,
                                 1.000000000000000,  0.461270704598038,  0.115274196122890,
                                 0.148659626117507,  0.069793668310725,  0.096728878061302,
                                 0.047780476169614,  0.056297098502386,  0.120698064150608,
                                 0.167908292821492, -0.014571958201470, -0.012305382112759,
                                 0.461270704598038,  1.000000000000001,  0.022459140058988,
                                -0.010570520039172,  0.106131005460443,  0.083143659118346,
                                -0.043774786607055,  0.020475495948937,  0.008109330257787,
                                -0.020772922519676,  0.132152418150248,  0.095292331969171,
                                 1.000000000000001,  0.461270704598038, -0.047435245516128,
                                -0.062106702294233,  0.190206697461651,  0.228561618295110,
                                 0.135548424257790,  0.194371122293959, -0.057375533424759,
                                -0.067645463513191,  0.170477065796384,  0.183172197534223,
                                 0.461270704598038,  1.000000000000001,  0.204111119165449,
                                 0.117279698370071, -0.058303098474334, -0.075437193402650,
                                -0.017816807729650,  0.055485341896116, -0.038868732316222,
                                -0.050291462268433, -0.085046299652270, -0.048866540987530,
                                 1.000000000000001,  0.461270704598038,  0.170333467724208,
                                 0.165831785080540, -0.191482892396841, -0.232682167104457,
                                 0.195180503563768,  0.252539262235042, -0.127655261597894,
                                -0.155121444736305, -0.070972278218420, -0.069096577116892,
                                 0.461270704598038,  1.000000000000001, -0.093881388556695,
                                -0.076960819989845,  0.008109330257787, -0.020772922519676,
                                -0.029183191071370,  0.013650330632625,  0.099373230245620,
                                 0.100454427884743, -0.173148344530283, -0.104264914600172,
                                 1.000000000000000,  0.461270704598038, -0.147556097137416,
                                -0.162400164282021, -0.057375533424759, -0.067645463513191,
                                 0.090365616171860,  0.129580748195973,  0.238019641982283,
                                 0.284932837889436, -0.164586863106405, -0.168274872249930,
                                 0.461270704598038,  1.000000000000001, -0.032687907133129,
                                -0.013411121097679,  0.035249031273098, -0.023474839237945,
                                -0.025173645656283, -0.010888905914727, -0.057090172572625,
                                 0.013377208991266, -0.051117182847748,  0.009709574219932,
                                 1.000000000000001,  0.461270704598038, -0.014571958201470,
                                -0.012305382112759, -0.125500332655964, -0.174752785540353,
                                -0.019908531737339, -0.023457124375994,  0.094338596226990,
                                 0.131711840846595,  0.086373145689975,  0.124253951593869,
                                 0.461270704598038,  1.000000000000001, -0.129124610280075,
                                -0.116407573990895,  0.091548116721840,  0.044665877057131,
                                -0.097291409555833, -0.041698156492770,  0.025317815261530,
                                 0.015005517905639,  0.078789183449044,  0.074864440166937,
                                 1.000000000000000,  0.461270704598038, -0.251926145964626,
                                -0.292121573604014,  0.037366981211033,  0.018938013355694,
                                -0.047341793054511, -0.040937599766527,  0.013544779044509,
                                 0.007073626314377,  0.165260572357923,  0.192611635318871,
                                 0.461270704598038,  1.000000000000001, -0.079371462337663,
                                -0.068619275447229,  0.001329889113362,  0.002963911251545,
                                -0.031452699401824, -0.015238319031875,  0.066096683151585,
                                 0.037430087005483, -0.029028296813802, -0.027072191546358,
                                 1.000000000000001,  0.461270704598038, -0.142991164350927,
                                -0.163422213160314,  0.005981717891998,  0.006353685857844,
                                -0.019222302936420, -0.017489375113868,  0.052444536433430,
                                 0.049840770889465, -0.058088426018424, -0.066908517691461,
                                 0.461270704598038,  1.000000000000002};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,
                              17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 27, 27, 27};

    std::vector<int32_t> cols{0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 24, 25, 26, 27, 0, 1, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                              27, 2, 3, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 24, 25, 26, 27, 2, 3, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                              26, 27, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 24, 25, 26, 27, 4, 5, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 6, 7, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 6, 7, 10,
                              11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
                              24, 25, 26, 27, 8, 9, 10, 11, 12, 13, 14, 15, 16,
                              17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              14, 15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14, 15, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              18, 19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22, 23, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 24, 25, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 26, 27};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 28, 28, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeGDForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 2);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.605807395054961, -0.044036393326649,
                                -0.057664223649619,  0.090981815503501,  0.140064404406893,
                                 0.021002656960651,  0.068781679082669,  0.021859619345693,
                                -0.019123141119481,  0.240952694484731,  0.231148359607367,
                                -0.115239464889111, -0.149877022639992, -0.037438912172191,
                                -0.026750813363960, -0.159926194041600, -0.225601981540993,
                                -0.097847583727229, -0.133211175855161,  0.605807395054961,
                                 1.000000000000001, -0.026619660456910, -0.045955585878374,
                                 0.071876501642185,  0.127148810932915,  0.051747451294759,
                                 0.099106417411671, -0.021398420674558, -0.041404468196155,
                                 0.072940717441492,  0.110554523387026, -0.064446540519330,
                                -0.108266776188014, -0.006101617730485, -0.008203588075173,
                                -0.110969184058915, -0.194747715736009, -0.062832757473426,
                                -0.108948142106876,  1.000000000000000,  0.605807395054961,
                                 0.072770986958302,  0.070416630951409,  0.079711285844155,
                                 0.055062690710691,  0.024048712088484,  0.035165304736614,
                                 0.128322015541488,  0.161084605195971, -0.076286046966459,
                                -0.144889761575074,  0.004269784590928, -0.039314178689388,
                                 0.034041006685802, -0.042135625560187,  0.107076931702597,
                                 0.089108473421018,  0.002052087484100,  0.005721042911565,
                                 0.605807395054961,  1.000000000000001,  0.021682084977066,
                                 0.032336971377178,  0.008112079891751,  0.006594945030371,
                                 0.031710311800800,  0.064485918707535,  0.084244319501237,
                                 0.152374412196740, -0.085047869488390, -0.155121444736304,
                                -0.025404530832611, -0.045096975675461, -0.057193275417121,
                                -0.116501857026902,  0.014882137080151,  0.012625342237130,
                                 0.002603199776909,  0.004235790571896,  1.000000000000000,
                                 0.605807395054961, -0.036841654285650, -0.030465017823042,
                                 0.021878186359033,  0.016245687086778,  0.068873210898582,
                                 0.051488174335649, -0.044138715604403,  0.035733082486057,
                                -0.008864267711055,  0.103828258764752, -0.029425810402936,
                                 0.023822054990705, -0.028697171207743, -0.021453405973187,
                                -0.111821841390615, -0.083033511776865, -0.036534640499936,
                                -0.030211142674517,  0.605807395054961,  1.000000000000001,
                                -0.008212342153441, -0.011757563101760,  0.003892635012798,
                                 0.005339686926069,  0.021037207906893,  0.037531399001590,
                                 0.062117196383880,  0.129580748195973,  0.087738763058009,
                                 0.168359508156695,  0.041411464255920,  0.086387165463982,
                                -0.008765503294539, -0.015638082917329, -0.019895690065413,
                                -0.027291733177685, -0.008143905968828, -0.011659583409245,
                                 1.000000000000000,  0.605807395054961, -0.027438530090578,
                                -0.022504329033893, -0.156917259704594, -0.114577103175243,
                                -0.017860835573834,  0.044584625147433,  0.004269784590928,
                                -0.039314178689388, -0.050857364644306, -0.096593174383383,
                                 0.124763861715715,  0.193846420770461, -0.058649940261574,
                                 0.022648195735133,  0.030286293908841,  0.029806299537751,
                                 0.077958836201167,  0.073846381214263,  0.605807395054961,
                                 1.000000000000001, -0.006017611118762, -0.008591978291830,
                                -0.017596252263613, -0.014520327938763,  0.054971473636524,
                                 0.111938861880994, -0.025404530832611, -0.045096975675461,
                                -0.056698579658927, -0.103414296490870,  0.105414761861746,
                                 0.189955225259624,  0.043066187568296,  0.087807893897730,
                                 0.005420582334818,  0.004715750876251,  0.022379837378584,
                                 0.033227180592977,  1.000000000000000,  0.605807395054961,
                                 0.094646734865014,  0.131095055722789,  0.124024342607112,
                                 0.201866830685608, -0.037438912172191, -0.026750813363960,
                                 0.159648133061406,  0.186234715928223, -0.100396956035305,
                                -0.096311816503070, -0.205118017979370, -0.204951351259329,
                                -0.053251185514195,  0.015725899244147,  0.098318542262307,
                                 0.144914803744174, -0.036169572753452, -0.052463372841193,
                                 0.605807395054961,  1.000000000000000,  0.062402251520776,
                                 0.108398892307560,  0.106140477231747,  0.188587135982235,
                                -0.006101617730485, -0.008203588075173,  0.074151213371577,
                                 0.122114798356148, -0.030391965600622, -0.046064384744594,
                                -0.071000081919379, -0.112183248166620,  0.039645909462631,
                                 0.082835967729246,  0.072863272551590,  0.128407756879247,
                                -0.025561593290674, -0.044605678460974, -0.044036393326649,
                                -0.026619660456910,  0.072770986958302,  0.021682084977066,
                                -0.036841654285650, -0.008212342153441, -0.027438530090578,
                                -0.006017611118762,  0.094646734865014,  0.062402251520776,
                                 1.000000000000000,  0.843105045632668, -0.057664223649619,
                                -0.045955585878374,  0.070416630951409,  0.032336971377178,
                                -0.030465017823042, -0.011757563101760, -0.022504329033893,
                                -0.008591978291830,  0.131095055722789,  0.108398892307560,
                                 0.843105045632668,  1.000000000000000,  0.090981815503501,
                                 0.071876501642185,  0.079711285844155,  0.008112079891751,
                                 0.021878186359033,  0.003892635012798, -0.156917259704594,
                                -0.017596252263613,  0.124024342607112,  0.106140477231747,
                                 1.000000000000000,  0.843105045632668,  0.140064404406893,
                                 0.127148810932915,  0.055062690710691,  0.006594945030371,
                                 0.016245687086778,  0.005339686926069, -0.114577103175243,
                                -0.014520327938763,  0.201866830685608,  0.188587135982235,
                                 0.843105045632668,  1.000000000000000,  0.021002656960651,
                                 0.051747451294759,  0.024048712088484,  0.031710311800800,
                                 0.068873210898582,  0.021037207906893, -0.017860835573834,
                                 0.054971473636524, -0.037438912172191, -0.006101617730485,
                                 1.000000000000000,  0.843105045632668,  0.068781679082669,
                                 0.099106417411671,  0.035165304736614,  0.064485918707535,
                                 0.051488174335649,  0.037531399001590,  0.044584625147433,
                                 0.111938861880994, -0.026750813363960, -0.008203588075173,
                                 0.843105045632668,  1.000000000000000,  0.021859619345693,
                                -0.021398420674558,  0.128322015541488,  0.084244319501237,
                                -0.044138715604403,  0.062117196383880,  0.004269784590928,
                                -0.025404530832611,  0.159648133061406,  0.074151213371577,
                                 1.000000000000000,  0.843105045632668, -0.019123141119481,
                                -0.041404468196155,  0.161084605195971,  0.152374412196740,
                                 0.035733082486057,  0.129580748195973, -0.039314178689388,
                                -0.045096975675461,  0.186234715928223,  0.122114798356148,
                                 0.843105045632668,  1.000000000000000,  0.240952694484731,
                                 0.072940717441492, -0.076286046966459, -0.085047869488390,
                                -0.008864267711055,  0.087738763058009, -0.050857364644306,
                                -0.056698579658927, -0.100396956035305, -0.030391965600622,
                                 1.000000000000000,  0.843105045632668,  0.231148359607367,
                                 0.110554523387026, -0.144889761575074, -0.155121444736304,
                                 0.103828258764752,  0.168359508156695, -0.096593174383383,
                                -0.103414296490870, -0.096311816503070, -0.046064384744594,
                                 0.843105045632668,  1.000000000000000, -0.115239464889111,
                                -0.064446540519330,  0.004269784590928, -0.025404530832611,
                                -0.029425810402936,  0.041411464255920,  0.124763861715715,
                                 0.105414761861746, -0.205118017979370, -0.071000081919379,
                                 1.000000000000000,  0.843105045632668, -0.149877022639992,
                                -0.108266776188014, -0.039314178689388, -0.045096975675461,
                                 0.023822054990705,  0.086387165463982,  0.193846420770461,
                                 0.189955225259624, -0.204951351259329, -0.112183248166620,
                                 0.843105045632668,  1.000000000000000, -0.037438912172191,
                                -0.006101617730485,  0.034041006685802, -0.057193275417121,
                                -0.028697171207743, -0.008765503294539, -0.058649940261574,
                                 0.043066187568296, -0.053251185514195,  0.039645909462631,
                                 1.000000000000000,  0.843105045632668, -0.026750813363960,
                                -0.008203588075173, -0.042135625560187, -0.116501857026902,
                                -0.021453405973187, -0.015638082917329,  0.022648195735133,
                                 0.087807893897730,  0.015725899244147,  0.082835967729246,
                                 0.843105045632668,  1.000000000000000, -0.159926194041600,
                                -0.110969184058915,  0.107076931702597,  0.014882137080151,
                                -0.111821841390615, -0.019895690065413,  0.030286293908841,
                                 0.005420582334818,  0.098318542262307,  0.072863272551590,
                                 1.000000000000000,  0.843105045632668, -0.225601981540993,
                                -0.194747715736009,  0.089108473421018,  0.012625342237130,
                                -0.083033511776865, -0.027291733177685,  0.029806299537751,
                                 0.004715750876251,  0.144914803744174,  0.128407756879247,
                                 0.843105045632668,  0.999999999999999, -0.097847583727229,
                                -0.062832757473426,  0.002052087484100,  0.002603199776909,
                                -0.036534640499936, -0.008143905968828,  0.077958836201167,
                                 0.022379837378584, -0.036169572753452, -0.025561593290674,
                                 1.000000000000000,  0.843105045632668, -0.133211175855161,
                                -0.108948142106876,  0.005721042911565,  0.004235790571896,
                                -0.030211142674517, -0.011659583409245,  0.073846381214263,
                                 0.033227180592977, -0.052463372841193, -0.044605678460974,
                                 0.843105045632668,  1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,
                              17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 27, 27, 27};

    std::vector<int32_t> cols{0, 1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 24, 25, 26, 27, 0, 1, 10, 11, 12, 13,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                              27, 2, 3, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 24, 25, 26, 27, 2, 3, 10, 11, 12,
                              13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                              26, 27, 4, 5, 10, 11, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 24, 25, 26, 27, 4, 5, 10, 11,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 6, 7, 10, 11, 12, 13, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 6, 7, 10,
                              11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
                              24, 25, 26, 27, 8, 9, 10, 11, 12, 13, 14, 15, 16,
                              17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 8, 9,
                              10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 12, 13, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              14, 15, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 14, 15, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 16, 17, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              18, 19, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 20, 21, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 22, 23, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 24, 25, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 26, 27};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 28, 28, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeFGForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(3, 4);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);

    std::vector<double> intvals{ 1.000000000000000,  0.867095998733913, -0.038133763462658,
                                -0.106235423592532,  0.043755657852632, -0.087425540472543,
                                 0.072506649702354,  0.103680822250076,  0.108009700880389,
                                 0.062352963436461,  0.032268760346610,  0.015007335821306,
                                -0.201010978708980, -0.130405007554342,  0.092948417292694,
                                 0.151640188615861, -0.002791619363521, -0.000530488062653,
                                 0.056034206613455,  0.159131478471356,  0.867095998733913,
                                 1.000000000000000, -0.053752055402366, -0.158629541496364,
                                -0.004897300047465, -0.161706981514408,  0.074606584154278,
                                 0.135497561090456,  0.065699966394589,  0.070735712966717,
                                 0.017810678608865,  0.016080741039598, -0.130789218527844,
                                -0.150675562245263,  0.105684266075369,  0.199628360563071,
                                -0.000975147043141, -0.000458536417740,  0.080220631734041,
                                 0.237752719302035,  0.999999999999999,  0.867095998733913,
                                -0.060127206740402, -0.054393143365885,  0.071911680542954,
                                 0.037480034711339, -0.025811134571428, -0.115125846701073,
                                 0.054232840776238,  0.050477384738846,  0.027958521069952,
                                -0.077929267750535,  0.031808646714640,  0.092310103486741,
                                -0.021809521962801,  0.000418633025541, -0.130683079545543,
                                -0.058033451680477, -0.132462494860459, -0.128293070819173,
                                 0.867095998733913,  1.000000000000000, -0.046956868367686,
                                -0.066451205116432,  0.054340892974460,  0.025577707137090,
                                -0.037101461933566, -0.197141998829435,  0.033293469610950,
                                 0.071763754034210, -0.032858232391467, -0.110900824618262,
                                 0.048533142354832,  0.133608582039167, -0.003960987644180,
                                 0.001732937903802, -0.087459515514096, -0.039176143309283,
                                -0.108559647650801, -0.157537657279766,  1.000000000000000,
                                 0.867095998733913,  0.093043921927851,  0.056154376530354,
                                 0.065565618696763,  0.007933864726982,  0.078321713779735,
                                 0.057125104932445,  0.126072502936294, -0.018182055485518,
                                -0.075333611300454,  0.025258552001988, -0.005077932867016,
                                 0.029985153196922, -0.071732335041587, -0.070684089438996,
                                 0.065773694854779,  0.006199955480939, -0.000476749951402,
                                 0.005779175984374,  0.867095998733913,  1.000000000000000,
                                 0.058849928334701,  0.063549735800116,  0.023070253468372,
                                 0.002579904368099,  0.056725402755963,  0.060298272417621,
                                 0.062646235423344, -0.088979289531484, -0.022116851175052,
                                 0.061896942281811,  0.009264483751993,  0.045806000572797,
                                -0.072679184104545, -0.068946776600150,  0.027033941534887,
                                -0.003537008619828,  0.003660012964025,  0.007434336255914,
                                 0.999999999999999,  0.867095998733913, -0.050656421023338,
                                -0.018977689752350,  0.019618616271189,  0.000895240732583,
                                 0.013210113758182, -0.027680547443586,  0.004660764085845,
                                 0.035650327366430,  0.096657366364336, -0.008138984412089,
                                 0.003107176057230,  0.023766884910953, -0.005504214065909,
                                 0.011533561434828, -0.100272927608298, -0.004575674855425,
                                -0.050234284181477, -0.018819542337747,  0.867095998733913,
                                 1.000000000000000, -0.025190243253428, -0.019213578986846,
                                 0.006103430826480, -0.001247023908494, -0.013621857128192,
                                -0.037582514185501,  0.037427714155464,  0.026109232074626,
                                 0.069359263563040, -0.079695930250142,  0.024951809436976,
                                 0.017406154716418,  0.005675773803413,  0.015659380910625,
                                -0.031195313113118,  0.006373677754525, -0.024980324559650,
                                -0.019053465828622,  1.000000000000000,  0.867095998733913,
                                -0.038441282189680, -0.016628040664598, -0.119965286581082,
                                -0.013798369601542,  0.082290081724975,  0.074146451275843,
                                -0.005077932867016,  0.029985153196922, -0.050222407533636,
                                 0.016839034667992,  0.130304113658807, -0.043169683149620,
                                 0.024359897397973,  0.039428588877448,  0.011825623568179,
                                 0.000398770724052,  0.100997020623348,  0.058371397453281,
                                 0.867095998733913,  1.000000000000000, -0.020022430573211,
                                -0.017849371014988, -0.043800016558086, -0.002219665405773,
                                 0.075542781034406,  0.073908460913907,  0.009264483751993,
                                 0.045806000572797, -0.014744567450035,  0.041264628187874,
                                 0.054925832296683, -0.127150956675481,  0.042089240670005,
                                 0.034938552591750,  0.006443895737033, -0.003128797373955,
                                 0.062193671966729,  0.065678101362272,  1.000000000000000,
                                 0.867095998733913,  0.127627268287447,  0.127374238541850,
                                 0.095757724257149,  0.055257555349091, -0.021809521962801,
                                 0.000418633025541, -0.016946462379725, -0.097288311400282,
                                -0.011649383779146,  0.032470528229390, -0.021729434713328,
                                 0.075921558519169, -0.069066686464316, -0.114295557867083,
                                 0.079048855325507,  0.038047303308373, -0.048243527904559,
                                -0.052134902201207,  0.867095998733913,  1.000000000000000,
                                 0.106870643427230,  0.156743448907119,  0.078354230633874,
                                 0.037936859169852, -0.003960987644179,  0.001732937903802,
                                -0.048111023736354, -0.141397467335523,  0.013690930163111,
                                 0.046208676924276,  0.031135974449840,  0.111573612215583,
                                -0.044957420761189, -0.193705005320227,  0.056201604457520,
                                 0.025830961182333, -0.042805752914826, -0.064499255794770,
                                 1.000000000000000,  0.867095998733913, -0.054105746842075,
                                -0.158765015585551, -0.002791619363521, -0.000530488062653,
                                -0.138549865044965, -0.162833346689649,  0.116645321601802,
                                 0.102517899303379, -0.164929219549341, -0.076704160864451,
                                 0.024347090915770,  0.034698247754256,  0.081825538522751,
                                 0.105968201286931,  0.057477748202306, -0.084817948183899,
                                -0.035292872174363, -0.105695572445406,  0.867095998733913,
                                 1.000000000000000, -0.079546996972637, -0.237435960847469,
                                -0.000975147043141, -0.000458536417740, -0.123639286670348,
                                -0.210062827714523,  0.091817188355134,  0.123008679817933,
                                -0.091032357334197, -0.082190454202390,  0.027052703139985,
                                 0.043299387892948,  0.078275784342867,  0.137629897761272,
                                -0.000104004799173, -0.159453064581797, -0.052759697068753,
                                -0.158162911936638, -0.038133763462658, -0.053752055402366,
                                -0.060127206740402, -0.046956868367686,  0.093043921927851,
                                 0.058849928334701, -0.050656421023338, -0.025190243253428,
                                -0.038441282189680, -0.020022430573211,  0.127627268287447,
                                 0.106870643427230, -0.054105746842075, -0.079546996972637,
                                 1.000000000000000,  0.461270704598038, -0.106235423592532,
                                -0.158629541496364, -0.054393143365885, -0.066451205116432,
                                 0.056154376530354,  0.063549735800116, -0.018977689752350,
                                -0.019213578986846, -0.016628040664598, -0.017849371014988,
                                 0.127374238541850,  0.156743448907119, -0.158765015585551,
                                -0.237435960847469,  0.461270704598038,  1.000000000000001,
                                 0.043755657852632, -0.004897300047465,  0.071911680542954,
                                 0.054340892974460,  0.065565618696763,  0.023070253468372,
                                 0.019618616271189,  0.006103430826480, -0.119965286581082,
                                -0.043800016558086,  0.095757724257149,  0.078354230633874,
                                -0.002791619363521, -0.000975147043141,  1.000000000000000,
                                 0.461270704598038, -0.087425540472543, -0.161706981514408,
                                 0.037480034711339,  0.025577707137090,  0.007933864726982,
                                 0.002579904368099,  0.000895240732583, -0.001247023908494,
                                -0.013798369601542, -0.002219665405773,  0.055257555349091,
                                 0.037936859169852, -0.000530488062653, -0.000458536417740,
                                 0.461270704598038,  1.000000000000001,  0.072506649702354,
                                 0.074606584154278, -0.025811134571428, -0.037101461933566,
                                 0.078321713779735,  0.056725402755963,  0.013210113758182,
                                -0.013621857128192,  0.082290081724975,  0.075542781034406,
                                -0.021809521962801, -0.003960987644179, -0.138549865044965,
                                -0.123639286670348,  1.000000000000000,  0.461270704598038,
                                 0.103680822250076,  0.135497561090456, -0.115125846701073,
                                -0.197141998829435,  0.057125104932445,  0.060298272417621,
                                -0.027680547443586, -0.037582514185501,  0.074146451275843,
                                 0.073908460913907,  0.000418633025541,  0.001732937903802,
                                -0.162833346689649, -0.210062827714523,  0.461270704598038,
                                 1.000000000000001,  0.108009700880389,  0.065699966394589,
                                 0.054232840776238,  0.033293469610950,  0.126072502936294,
                                 0.062646235423344,  0.004660764085845,  0.037427714155464,
                                -0.005077932867016,  0.009264483751993, -0.016946462379725,
                                -0.048111023736354,  0.116645321601802,  0.091817188355134,
                                 1.000000000000001,  0.461270704598038,  0.062352963436461,
                                 0.070735712966717,  0.050477384738846,  0.071763754034210,
                                -0.018182055485518, -0.088979289531484,  0.035650327366430,
                                 0.026109232074626,  0.029985153196922,  0.045806000572797,
                                -0.097288311400282, -0.141397467335523,  0.102517899303379,
                                 0.123008679817933,  0.461270704598038,  1.000000000000001,
                                 0.032268760346610,  0.017810678608865,  0.027958521069952,
                                -0.032858232391467, -0.075333611300454, -0.022116851175052,
                                 0.096657366364336,  0.069359263563040, -0.050222407533636,
                                -0.014744567450035, -0.011649383779146,  0.013690930163111,
                                -0.164929219549341, -0.091032357334197,  1.000000000000001,
                                 0.461270704598038,  0.015007335821306,  0.016080741039598,
                                -0.077929267750535, -0.110900824618262,  0.025258552001988,
                                 0.061896942281811, -0.008138984412089, -0.079695930250142,
                                 0.016839034667992,  0.041264628187874,  0.032470528229390,
                                 0.046208676924276, -0.076704160864451, -0.082190454202390,
                                 0.461270704598038,  1.000000000000001, -0.201010978708980,
                                -0.130789218527844,  0.031808646714640,  0.048533142354832,
                                -0.005077932867016,  0.009264483751993,  0.003107176057230,
                                 0.024951809436976,  0.130304113658807,  0.054925832296683,
                                -0.021729434713328,  0.031135974449840,  0.024347090915770,
                                 0.027052703139985,  1.000000000000000,  0.461270704598038,
                                -0.130405007554342, -0.150675562245263,  0.092310103486741,
                                 0.133608582039167,  0.029985153196922,  0.045806000572797,
                                 0.023766884910953,  0.017406154716418, -0.043169683149620,
                                -0.127150956675481,  0.075921558519169,  0.111573612215583,
                                 0.034698247754256,  0.043299387892948,  0.461270704598038,
                                 1.000000000000001,  0.092948417292694,  0.105684266075369,
                                -0.021809521962801, -0.003960987644180, -0.071732335041587,
                                -0.072679184104545, -0.005504214065909,  0.005675773803413,
                                 0.024359897397973,  0.042089240670005, -0.069066686464316,
                                -0.044957420761189,  0.081825538522751,  0.078275784342867,
                                 1.000000000000001,  0.461270704598038,  0.151640188615861,
                                 0.199628360563071,  0.000418633025541,  0.001732937903802,
                                -0.070684089438996, -0.068946776600150,  0.011533561434828,
                                 0.015659380910625,  0.039428588877448,  0.034938552591750,
                                -0.114295557867083, -0.193705005320227,  0.105968201286931,
                                 0.137629897761272,  0.461270704598038,  1.000000000000001,
                                -0.002791619363521, -0.000975147043141, -0.130683079545543,
                                -0.087459515514096,  0.065773694854779,  0.027033941534887,
                                -0.100272927608298, -0.031195313113118,  0.011825623568179,
                                 0.006443895737033,  0.079048855325507,  0.056201604457520,
                                 0.057477748202306, -0.000104004799173,  1.000000000000000,
                                 0.461270704598038, -0.000530488062653, -0.000458536417740,
                                -0.058033451680477, -0.039176143309283,  0.006199955480939,
                                -0.003537008619828, -0.004575674855425,  0.006373677754525,
                                 0.000398770724052, -0.003128797373955,  0.038047303308373,
                                 0.025830961182333, -0.084817948183899, -0.159453064581797,
                                 0.461270704598038,  1.000000000000001,  0.056034206613455,
                                 0.080220631734041, -0.132462494860459, -0.108559647650801,
                                -0.000476749951402,  0.003660012964025, -0.050234284181477,
                                -0.024980324559650,  0.100997020623348,  0.062193671966729,
                                -0.048243527904559, -0.042805752914826, -0.035292872174363,
                                -0.052759697068753,  1.000000000000001,  0.461270704598038,
                                 0.159131478471356,  0.237752719302035, -0.128293070819173,
                                -0.157537657279766,  0.005779175984374,  0.007434336255914,
                                -0.018819542337747, -0.019053465828622,  0.058371397453281,
                                 0.065678101362272, -0.052134902201207, -0.064499255794770,
                                -0.105695572445406, -0.158162911936638,  0.461270704598038,
                                 1.000000000000002};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14,
                              14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27,
                              27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28,
                              28, 28, 28, 28, 28, 29, 29, 29, 29, 29, 29, 29, 29,
                              29, 29, 29, 29, 29, 29, 29, 29, 30, 30, 30, 30, 30,
                              30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 31, 31,
                              31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                              31};

    std::vector<int32_t> cols{0, 1, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 28, 29, 30, 31, 0, 1, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
                              31, 2, 3, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
                              24, 25, 26, 27, 28, 29, 30, 31, 2, 3, 14, 15, 16,
                              17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
                              30, 31, 4, 5, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 24, 25, 26, 27, 28, 29, 30, 31, 4, 5, 14, 15,
                              16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28,
                              29, 30, 31, 6, 7, 14, 15, 16, 17, 18, 19, 20, 21,
                              22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 6, 7, 14,
                              15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,
                              28, 29, 30, 31, 8, 9, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 8, 9,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                              27, 28, 29, 30, 31, 10, 11, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 10,
                              11, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                              26, 27, 28, 29, 30, 31, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 28, 29, 30, 31, 0, 1, 2, 3, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1, 2, 3, 4,
                              5, 6, 7, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1, 2, 3,
                              4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 18, 19, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 20, 21, 0,
                              1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 20, 21,
                              0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 22,
                              23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
                              13, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
                              12, 13, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                              11, 12, 13, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8,
                              9, 10, 11, 12, 13, 28, 29, 0, 1, 2, 3, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 28, 29, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 10, 11, 12, 13, 30, 31, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 30, 31};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 32, 32, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeGFForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 3);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.527975968559032,  0.043393118676266,
                                 0.074224696007663, -0.045545041368746,  0.005357322494014,
                                -0.080934615245310, -0.103743152370368, -0.116827433178561,
                                -0.092135082232594, -0.034754480453872, -0.025030457431983,
                                 0.218180672745729,  0.183212369076686, -0.104613379533047,
                                -0.146812908490922,  0.002951743182618,  0.001381996907056,
                                -0.063856333965774, -0.110759596193347,  0.527975968559032,
                                 1.000000000000000,  0.071497203780953,  0.129520478265914,
                                 0.060123231593827,  0.132033197518657, -0.069000112329083,
                                -0.110633295354403, -0.040993308593151, -0.057755467786809,
                                -0.009820632759258, -0.013129870077616,  0.085870914077558,
                                 0.123026081402620, -0.100989388680623, -0.162995873855955,
                                 0.000341171160734,  0.000374393417316, -0.107103252137933,
                                -0.194124282416380,  1.000000000000000,  0.527975968559032,
                                 0.065909122596563,  0.065564048033265, -0.079073335021909,
                                -0.076208943731048,  0.028815427789906,  0.050782161430779,
                                -0.058306504235156, -0.046390651299378, -0.026036163012161,
                                 0.044712061310252, -0.036514219795682, -0.066994911472943,
                                 0.022695738640325,  0.005724138917268,  0.142532619464178,
                                 0.122804390704418,  0.145659804542201,  0.151490912132617,
                                 0.527975968559032,  1.000000000000000,  0.035992117938419,
                                 0.054257181776093, -0.023996446023356, -0.020884110425404,
                                 0.078423588802659,  0.160965768001491, -0.033805751823958,
                                -0.058594859803471,  0.052334045216802,  0.090550144122876,
                                -0.061985958075838, -0.109090950417582, -0.000346164434811,
                                -0.001414937873415,  0.037118392361848,  0.031987187065964,
                                 0.084933743087348,  0.128628958536292,  1.000000000000000,
                                 0.527975968559032, -0.100873529328345, -0.082501204877872,
                                -0.069457242991459, -0.032779808251075, -0.085453766551918,
                                -0.079264534901489, -0.136136598996739, -0.088930296369684,
                                 0.079857339212575,  0.031938327902152,  0.004682599669262,
                                -0.012472245482378,  0.080422134595899,  0.101405671838939,
                                -0.070225144565602, -0.038404580135552,  0.000148891527573,
                                -0.005050715670241,  0.527975968559032,  1.000000000000000,
                                -0.036914322555353, -0.051888141999655, -0.004898271583649,
                                -0.002106483095673, -0.037460348275517, -0.049233333264836,
                                 0.014721405416735,  0.072651285675835, -0.018029720389371,
                                -0.050538641742980, -0.020270187366220, -0.037400442853662,
                                 0.046144051204704,  0.056294807360010, -0.003574169360888,
                                 0.002887955444801, -0.003845305494199, -0.006070110134421,
                                 1.000000000000000,  0.527975968559032,  0.054309526312729,
                                 0.035473526885291, -0.020714920128522, -0.008708336513568,
                                -0.012328485544180,  0.018613666346847, -0.008470382797899,
                                -0.051914908343612, -0.106842974578599, -0.098018349272057,
                                -0.005646921865266, -0.034609938895741,  0.005136868976742,
                                -0.007755694311186,  0.105876258434666,  0.044509275513793,
                                 0.053856946926790,  0.035177914161247,  0.527975968559032,
                                 1.000000000000000,  0.012362723525546,  0.015687821550145,
                                -0.000476722183697,  0.001018190757620,  0.018512076961291,
                                 0.030685994335129, -0.023000544210570, -0.021318098719581,
                                 0.008167259414271,  0.065071454563096, -0.015333696140380,
                                -0.014212065813054, -0.007713365400538, -0.012785830972971,
                                 0.002436580050006, -0.005204086094504,  0.012259700829500,
                                 0.015557089703893,  1.000000000000000,  0.527975968559032,
                                 0.041277472621373,  0.028156179186600,  0.127309309425898,
                                 0.062231183488823, -0.091443330418663, -0.105442086572776,
                                 0.004682599669262, -0.012472245482378,  0.053238226141717,
                                 0.021292218601435, -0.140038765387790, -0.078536758467703,
                                -0.029123210124457, -0.058633970706321, -0.012848779504999,
                                -0.009151759925748, -0.109339218484411, -0.087222924390427,
                                 0.527975968559032,  1.000000000000000,  0.010880723155269,
                                 0.014573950405448,  0.008415401573828,  0.001812349214617,
                                -0.048462467637451, -0.060346005637835, -0.020270187366220,
                                -0.037400442853662, -0.012019813592914, -0.033692427828653,
                                 0.031613228221918,  0.103818321387220, -0.025610664285919,
                                -0.028527208733728, -0.000097382972483,  0.002554652358250,
                                -0.038352046097481, -0.053625945204120,  1.000000000000000,
                                 0.527975968559032, -0.140547235379011, -0.149097223273692,
                                -0.105912613546243, -0.109806667270100,  0.022695738640325,
                                 0.005724138917268,  0.021230558828566,  0.066217591830105,
                                 0.010848401255067, -0.018630025545938,  0.019809985152323,
                                -0.042417684235987,  0.073828642759884,  0.062135036950027,
                                -0.086556820318372, -0.078865094918631,  0.053343810703941,
                                 0.059681008386030,  0.527975968559032,  1.000000000000000,
                                -0.084342817302880, -0.127980490115482, -0.035398231269264,
                                -0.030975315803320, -0.000346164434811, -0.001414937873415,
                                 0.065369157177809,  0.115450548631294, -0.021805852173667,
                                -0.037729226717865, -0.051097658345140, -0.091099472895779,
                                 0.077737029340285,  0.158159474552552, -0.024347969730718,
                                -0.021090891487452,  0.034539782224176,  0.052663421828813,
                                 1.000000000000000,  0.527975968559032,  0.061817260137333,
                                 0.109804908217524,  0.002951743182618,  0.001381996907056,
                                 0.153032511759837,  0.172197867807754, -0.128028256973528,
                                -0.128267690407786,  0.177634011208679,  0.127933449096800,
                                -0.027426287537796, -0.037648275885935, -0.090829312283280,
                                -0.108930698495416, -0.060054213776060, -0.001435826553955,
                                 0.040389277392472,  0.072818306932917,  0.527975968559032,
                                 1.000000000000000,  0.106867569986123,  0.193865650221248,
                                 0.000341171160734,  0.000374393417316,  0.108230623213774,
                                 0.171515580608918, -0.067736092996392, -0.100436166495776,
                                 0.050194345213983,  0.067108224841148, -0.023009611020994,
                                -0.035353802170856, -0.070479895600514, -0.112374340955511,
                                 0.058446218762684,  0.130192882049485,  0.071150010968418,
                                 0.129139476825838,  0.043393118676266,  0.071497203780953,
                                 0.065909122596563,  0.035992117938419, -0.100873529328345,
                                -0.036914322555353,  0.054309526312729,  0.012362723525546,
                                 0.041277472621373,  0.010880723155269, -0.140547235379011,
                                -0.084342817302880,  0.061817260137333,  0.106867569986123,
                                 1.000000000000000,  0.843105045632668,  0.074224696007663,
                                 0.129520478265914,  0.065564048033265,  0.054257181776093,
                                -0.082501204877872, -0.051888141999655,  0.035473526885291,
                                 0.015687821550145,  0.028156179186600,  0.014573950405448,
                                -0.149097223273692, -0.127980490115482,  0.109804908217524,
                                 0.193865650221248,  0.843105045632668,  1.000000000000000,
                                -0.045545041368746,  0.060123231593827, -0.079073335021909,
                                -0.023996446023356, -0.069457242991459, -0.004898271583649,
                                -0.020714920128522, -0.000476722183697,  0.127309309425898,
                                 0.008415401573828, -0.105912613546243, -0.035398231269264,
                                 0.002951743182618,  0.000341171160734,  1.000000000000000,
                                 0.843105045632668,  0.005357322494014,  0.132033197518657,
                                -0.076208943731048, -0.020884110425404, -0.032779808251075,
                                -0.002106483095673, -0.008708336513568,  0.001018190757620,
                                 0.062231183488823,  0.001812349214617, -0.109806667270100,
                                -0.030975315803320,  0.001381996907056,  0.000374393417316,
                                 0.843105045632668,  1.000000000000000, -0.080934615245310,
                                -0.069000112329083,  0.028815427789906,  0.078423588802659,
                                -0.085453766551918, -0.037460348275517, -0.012328485544180,
                                 0.018512076961291, -0.091443330418663, -0.048462467637451,
                                 0.022695738640325, -0.000346164434811,  0.153032511759837,
                                 0.108230623213774,  1.000000000000000,  0.843105045632668,
                                -0.103743152370368, -0.110633295354403,  0.050782161430779,
                                 0.160965768001491, -0.079264534901489, -0.049233333264836,
                                 0.018613666346847,  0.030685994335129, -0.105442086572776,
                                -0.060346005637835,  0.005724138917268, -0.001414937873415,
                                 0.172197867807754,  0.171515580608918,  0.843105045632668,
                                 1.000000000000000, -0.116827433178561, -0.040993308593151,
                                -0.058306504235156, -0.033805751823958, -0.136136598996739,
                                 0.014721405416735, -0.008470382797899, -0.023000544210570,
                                 0.004682599669262, -0.020270187366220,  0.021230558828566,
                                 0.065369157177809, -0.128028256973528, -0.067736092996392,
                                 1.000000000000000,  0.843105045632668, -0.092135082232594,
                                -0.057755467786809, -0.046390651299378, -0.058594859803471,
                                -0.088930296369684,  0.072651285675835, -0.051914908343612,
                                -0.021318098719581, -0.012472245482378, -0.037400442853662,
                                 0.066217591830105,  0.115450548631294, -0.128267690407786,
                                -0.100436166495776,  0.843105045632668,  1.000000000000000,
                                -0.034754480453872, -0.009820632759258, -0.026036163012161,
                                 0.052334045216802,  0.079857339212575, -0.018029720389371,
                                -0.106842974578599,  0.008167259414271,  0.053238226141717,
                                -0.012019813592914,  0.010848401255067, -0.021805852173667,
                                 0.177634011208679,  0.050194345213983,  1.000000000000000,
                                 0.843105045632668, -0.025030457431983, -0.013129870077616,
                                 0.044712061310252,  0.090550144122876,  0.031938327902152,
                                -0.050538641742980, -0.098018349272057,  0.065071454563096,
                                 0.021292218601435, -0.033692427828653, -0.018630025545938,
                                -0.037729226717865,  0.127933449096800,  0.067108224841148,
                                 0.843105045632668,  1.000000000000000,  0.218180672745729,
                                 0.085870914077558, -0.036514219795682, -0.061985958075838,
                                 0.004682599669262, -0.020270187366220, -0.005646921865266,
                                -0.015333696140380, -0.140038765387790,  0.031613228221918,
                                 0.019809985152323, -0.051097658345140, -0.027426287537796,
                                -0.023009611020994,  1.000000000000000,  0.843105045632668,
                                 0.183212369076686,  0.123026081402620, -0.066994911472943,
                                -0.109090950417582, -0.012472245482378, -0.037400442853662,
                                -0.034609938895741, -0.014212065813054, -0.078536758467703,
                                 0.103818321387220, -0.042417684235987, -0.091099472895779,
                                -0.037648275885935, -0.035353802170856,  0.843105045632668,
                                 1.000000000000000, -0.104613379533047, -0.100989388680623,
                                 0.022695738640325, -0.000346164434811,  0.080422134595899,
                                 0.046144051204704,  0.005136868976742, -0.007713365400538,
                                -0.029123210124457, -0.025610664285919,  0.073828642759884,
                                 0.077737029340285, -0.090829312283280, -0.070479895600514,
                                 1.000000000000000,  0.843105045632668, -0.146812908490922,
                                -0.162995873855955,  0.005724138917268, -0.001414937873415,
                                 0.101405671838939,  0.056294807360010, -0.007755694311186,
                                -0.012785830972971, -0.058633970706321, -0.028527208733728,
                                 0.062135036950027,  0.158159474552552, -0.108930698495416,
                                -0.112374340955511,  0.843105045632668,  1.000000000000000,
                                 0.002951743182618,  0.000341171160734,  0.142532619464178,
                                 0.037118392361848, -0.070225144565602, -0.003574169360888,
                                 0.105876258434666,  0.002436580050006, -0.012848779504999,
                                -0.000097382972483, -0.086556820318372, -0.024347969730718,
                                -0.060054213776060,  0.058446218762684,  1.000000000000000,
                                 0.843105045632668,  0.001381996907056,  0.000374393417316,
                                 0.122804390704418,  0.031987187065964, -0.038404580135552,
                                 0.002887955444801,  0.044509275513793, -0.005204086094504,
                                -0.009151759925748,  0.002554652358250, -0.078865094918631,
                                -0.021090891487452, -0.001435826553955,  0.130192882049485,
                                 0.843105045632668,  0.999999999999999, -0.063856333965774,
                                -0.107103252137933,  0.145659804542201,  0.084933743087348,
                                 0.000148891527573, -0.003845305494199,  0.053856946926790,
                                 0.012259700829500, -0.109339218484411, -0.038352046097481,
                                 0.053343810703941,  0.034539782224176,  0.040389277392472,
                                 0.071150010968418,  1.000000000000000,  0.843105045632668,
                                -0.110759596193347, -0.194124282416380,  0.151490912132617,
                                 0.128628958536292, -0.005050715670241, -0.006070110134421,
                                 0.035177914161247,  0.015557089703893, -0.087222924390427,
                                -0.053625945204120,  0.059681008386030,  0.052663421828813,
                                 0.072818306932917,  0.129139476825838,  0.843105045632668,
                                 1.000000000000000};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14,
                              14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27,
                              27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28,
                              28, 28, 28, 28, 28, 29, 29, 29, 29, 29, 29, 29, 29,
                              29, 29, 29, 29, 29, 29, 29, 29, 30, 30, 30, 30, 30,
                              30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 31, 31,
                              31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                              31};

    std::vector<int32_t> cols{0, 1, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 28, 29, 30, 31, 0, 1, 14, 15, 16, 17,
                              18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
                              31, 2, 3, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23,
                              24, 25, 26, 27, 28, 29, 30, 31, 2, 3, 14, 15, 16,
                              17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
                              30, 31, 4, 5, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                              23, 24, 25, 26, 27, 28, 29, 30, 31, 4, 5, 14, 15,
                              16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28,
                              29, 30, 31, 6, 7, 14, 15, 16, 17, 18, 19, 20, 21,
                              22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 6, 7, 14,
                              15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27,
                              28, 29, 30, 31, 8, 9, 14, 15, 16, 17, 18, 19, 20,
                              21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 8, 9,
                              14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,
                              27, 28, 29, 30, 31, 10, 11, 14, 15, 16, 17, 18, 19,
                              20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 10,
                              11, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,
                              26, 27, 28, 29, 30, 31, 12, 13, 14, 15, 16, 17, 18,
                              19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31,
                              12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                              25, 26, 27, 28, 29, 30, 31, 0, 1, 2, 3, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 10, 11, 12, 13, 14, 15, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1, 2, 3, 4,
                              5, 6, 7, 8, 9, 10, 11, 12, 13, 16, 17, 0, 1, 2, 3,
                              4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 18, 19, 0, 1, 2,
                              3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 18, 19, 0, 1,
                              2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 20, 21, 0,
                              1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 20, 21,
                              0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 22,
                              23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,
                              22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,
                              13, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
                              12, 13, 24, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
                              11, 12, 13, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                              10, 11, 12, 13, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8,
                              9, 10, 11, 12, 13, 28, 29, 0, 1, 2, 3, 4, 5, 6, 7,
                              8, 9, 10, 11, 12, 13, 28, 29, 0, 1, 2, 3, 4, 5, 6,
                              7, 8, 9, 10, 11, 12, 13, 30, 31, 0, 1, 2, 3, 4, 5,
                              6, 7, 8, 9, 10, 11, 12, 13, 30, 31};
    
    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 32, 32, 1.0e-13));
}

TEST_F(COverlapIntegralsDriverTest, ComputeGGForLiH)
{
    COverlapIntegralsDriver ovldrv(mpi::master(), mpi::nodes(MPI_COMM_WORLD),
                                   MPI_COMM_WORLD);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH(4, 4);
    
    auto ovlmat = ovldrv.compute(mlih, mbas, MPI_COMM_WORLD);
    
    std::vector<double> intvals{ 1.000000000000000,  0.843105045632668, -0.055496994840473,
                                 0.020071737867079, -0.062763355512840, -0.096415390067853,
                                -0.076421193249462, -0.044352959128561,  0.121745520079686,
                                 0.048821651713753, -0.069085233651331, -0.017705342589381,
                                -0.053584942017817, -0.014843436423879,  0.156934496888330,
                                 0.102925672496562, -0.088772723047987, -0.144100022311385,
                                 0.000690690361473,  0.000067247499286,  0.843105045632668,
                                 1.000000000000000, -0.033028214091975,  0.069462645752387,
                                -0.084813381840832, -0.152917561569099, -0.060410708933242,
                                -0.061148402208465,  0.081308468657452,  0.061856546048328,
                                -0.036394987735896, -0.020676481157118, -0.028950024762574,
                                -0.017795874907692,  0.135082870921951,  0.143166781382951,
                                -0.125484983897907, -0.228886295825567,  0.000223071472951,
                                 0.000063002767837, -0.055496994840473, -0.033028214091975,
                                 1.000000000000000,  0.461270704598038, -0.062763355512840,
                                -0.084813381840832, -0.076421193249462, -0.060410708933242,
                                 0.121745520079686,  0.081308468657452, -0.069085233651331,
                                -0.036394987735896, -0.053584942017817, -0.028950024762574,
                                 0.156934496888330,  0.135082870921951, -0.088772723047987,
                                -0.125484983897907,  0.000690690361473,  0.000223071472951,
                                 0.020071737867079,  0.069462645752387,  0.461270704598038,
                                 1.000000000000001, -0.096415390067853, -0.152917561569099,
                                -0.044352959128561, -0.061148402208465,  0.048821651713753,
                                 0.061856546048328, -0.017705342589381, -0.020676481157118,
                                -0.014843436423879, -0.017795874907692,  0.102925672496562,
                                 0.143166781382951, -0.144100022311385, -0.228886295825567,
                                 0.000067247499286,  0.000063002767837, -0.062763355512840,
                                -0.096415390067853,  1.000000000000000,  0.843105045632668,
                                 0.049927117537202, -0.019017355178641,  0.016842211389276,
                                -0.035529651690601,  0.043075764801511, -0.013476329533438,
                                 0.012239760377358, -0.003386316170432, -0.070562385382988,
                                 0.030478977244050,  0.012934767747597, -0.053696865731972,
                                -0.003142795974059, -0.000125041691225,  0.092120259206873,
                                 0.144425947571114, -0.084813381840832, -0.152917561569099,
                                 0.843105045632668,  1.000000000000000, -0.002615886299848,
                                -0.021686367780928, -0.006111486647262, -0.069153721502858,
                                 0.003231691920528, -0.025624687028482,  0.000274525129992,
                                -0.005826486720479, -0.001865793587456,  0.057098166204491,
                                -0.012005852455757, -0.103862143057002, -0.000755804331155,
                                -0.000061493878019,  0.126566133807291,  0.229191648347056,
                                -0.062763355512840, -0.084813381840832,  0.049927117537202,
                                -0.002615886299848,  1.000000000000000,  0.461270704598038,
                                 0.016842211389276, -0.006111486647262,  0.043075764801511,
                                 0.003231691920528,  0.012239760377358,  0.000274525129993,
                                -0.070562385382988, -0.001865793587456,  0.012934767747597,
                                -0.012005852455757, -0.003142795974059, -0.000755804331155,
                                 0.092120259206873,  0.126566133807291, -0.096415390067853,
                                -0.152917561569099, -0.019017355178641, -0.021686367780928,
                                 0.461270704598038,  1.000000000000001, -0.035529651690601,
                                -0.069153721502858, -0.013476329533438, -0.025624687028482,
                                -0.003386316170432, -0.005826486720479,  0.030478977244050,
                                 0.057098166204491, -0.053696865731972, -0.103862143057002,
                                -0.000125041691225, -0.000061493878019,  0.144425947571114,
                                 0.229191648347056, -0.076421193249462, -0.044352959128561,
                                 0.016842211389276, -0.035529651690601,  1.000000000000000,
                                 0.843105045632668, -0.087319523999711, -0.117423218639064,
                                 0.074244681422582,  0.005454705934782, -0.055289171780790,
                                -0.005016646618541,  0.095101857692808,  0.002929876968848,
                                -0.014174304535443, -0.002283614193004, -0.048491018732049,
                                 0.052536354847653, -0.164610418387558, -0.103946591107599,
                                -0.060410708933242, -0.061148402208465, -0.006111486647262,
                                -0.069153721502858,  0.843105045632668,  1.000000000000000,
                                -0.113604346680650, -0.171285376257124,  0.036788570995070,
                                -0.006427606396415, -0.037855550045600,  0.009295255704204,
                                 0.050082778985501, -0.018030269810945, -0.003786242173829,
                                -0.003319850679576,  0.003819100651585,  0.103482714075258,
                                -0.137953859601490, -0.144207401090086, -0.076421193249462,
                                -0.060410708933242,  0.016842211389276, -0.006111486647262,
                                -0.087319523999711, -0.113604346680650,  1.000000000000000,
                                 0.461270704598038,  0.074244681422582,  0.036788570995070,
                                -0.055289171780790, -0.037855550045600,  0.095101857692808,
                                 0.050082778985501, -0.014174304535443, -0.003786242173829,
                                -0.048491018732049,  0.003819100651585, -0.164610418387558,
                                -0.137953859601490, -0.044352959128561, -0.061148402208465,
                                -0.035529651690601, -0.069153721502858, -0.117423218639064,
                                -0.171285376257124,  0.461270704598038,  1.000000000000001,
                                 0.005454705934782, -0.006427606396415, -0.005016646618541,
                                 0.009295255704204,  0.002929876968848, -0.018030269810945,
                                -0.002283614193004, -0.003319850679576,  0.052536354847653,
                                 0.103482714075258, -0.103946591107599, -0.144207401090086,
                                 0.121745520079686,  0.048821651713753,  0.043075764801511,
                                -0.013476329533438,  0.074244681422582,  0.005454705934782,
                                 1.000000000000000,  0.843105045632668, -0.012568291802321,
                                -0.145345897605440,  0.003921365971525,  0.004541902035801,
                                 0.020820057998299,  0.010489739578436, -0.090222308360489,
                                -0.001354222388850,  0.022997964889309, -0.027777218351006,
                                -0.003656724530162,  0.004667545918657,  0.081308468657452,
                                 0.061856546048328,  0.003231691920528, -0.025624687028482,
                                 0.036788570995070, -0.006427606396415,  0.843105045632668,
                                 1.000000000000000, -0.096626631708488, -0.232971165295964,
                                 0.018453152183280, -0.002565479308989,  0.026334021283378,
                                 0.005462305411118, -0.048552755733370,  0.020546927875842,
                                -0.006670825284735, -0.050719785532220,  0.003869129949317,
                                 0.006846638577344,  0.121745520079686,  0.081308468657452,
                                 0.043075764801511,  0.003231691920528,  0.074244681422582,
                                 0.036788570995070, -0.012568291802321, -0.096626631708488,
                                 1.000000000000001,  0.461270704598038,  0.003921365971525,
                                 0.018453152183280,  0.020820057998299,  0.026334021283378,
                                -0.090222308360489, -0.048552755733369,  0.022997964889309,
                                -0.006670825284735, -0.003656724530162,  0.003869129949317,
                                 0.048821651713753,  0.061856546048328, -0.013476329533438,
                                -0.025624687028482,  0.005454705934782, -0.006427606396415,
                                -0.145345897605440, -0.232971165295964,  0.461270704598038,
                                 1.000000000000001,  0.004541902035801, -0.002565479308989,
                                 0.010489739578436,  0.005462305411118, -0.001354222388850,
                                 0.020546927875842, -0.027777218351006, -0.050719785532221,
                                 0.004667545918657,  0.006846638577344, -0.069085233651331,
                                -0.017705342589381,  0.012239760377358, -0.003386316170432,
                                -0.055289171780790, -0.005016646618541,  0.003921365971525,
                                 0.004541902035801,  1.000000000000000,  0.843105045632668,
                                -0.001345100711944, -0.154801627231406,  0.002614243981017,
                                 0.003027934690534,  0.023037154908663,  0.002090269424392,
                                -0.062558775262050,  0.017307838204431, -0.068509523370904,
                                -0.017557798067803, -0.036394987735896, -0.020676481157118,
                                 0.000274525129993, -0.005826486720479, -0.037855550045600,
                                 0.009295255704204,  0.018453152183280, -0.002565479308989,
                                 0.843105045632668,  1.000000000000000, -0.097918967417957,
                                -0.249407030039578,  0.012302101455520, -0.001710319539326,
                                 0.015773145852333, -0.003873023210085, -0.001403128442184,
                                 0.029779821015780, -0.036091696171430, -0.020504177147476,
                                -0.069085233651331, -0.036394987735896,  0.012239760377358,
                                 0.000274525129992, -0.055289171780790, -0.037855550045600,
                                 0.003921365971525,  0.018453152183280, -0.001345100711944,
                                -0.097918967417957,  1.000000000000001,  0.461270704598038,
                                 0.002614243981017,  0.012302101455520,  0.023037154908663,
                                 0.015773145852333, -0.062558775262050, -0.001403128442184,
                                -0.068509523370904, -0.036091696171430, -0.017705342589381,
                                -0.020676481157118, -0.003386316170432, -0.005826486720479,
                                -0.005016646618541,  0.009295255704204,  0.004541902035801,
                                -0.002565479308989, -0.154801627231406, -0.249407030039578,
                                 0.461270704598038,  1.000000000000001,  0.003027934690534,
                                -0.001710319539326,  0.002090269424392, -0.003873023210085,
                                 0.017307838204431,  0.029779821015780, -0.017557798067803,
                                -0.020504177147476, -0.053584942017817, -0.014843436423879,
                                -0.070562385382988,  0.030478977244050,  0.095101857692808,
                                 0.002929876968848,  0.020820057998299,  0.010489739578436,
                                 0.002614243981017,  0.003027934690534,  1.000000000000000,
                                 0.843105045632668, -0.029918340134237, -0.154087347254137,
                                 0.049304762612950, -0.002598639696317, -0.004092285521387,
                                -0.010797085297836,  0.133443147079441,  0.050901146925875,
                                -0.028950024762574, -0.017795874907692, -0.001865793587456,
                                 0.057098166204491,  0.050082778985501, -0.018030269810945,
                                 0.026334021283378,  0.005462305411118,  0.012302101455520,
                                -0.001710319539326,  0.843105045632668,  1.000000000000000,
                                -0.118571649444637, -0.237523086471895,  0.028968452150844,
                                -0.019290525394777, -0.005233788461061, -0.019299459528481,
                                 0.086433877647766,  0.064094078430745, -0.053584942017817,
                                -0.028950024762574, -0.070562385382988, -0.001865793587456,
                                 0.095101857692808,  0.050082778985501,  0.020820057998299,
                                 0.026334021283378,  0.002614243981017,  0.012302101455520,
                                -0.029918340134237, -0.118571649444637,  1.000000000000000,
                                 0.461270704598038,  0.049304762612950,  0.028968452150844,
                                -0.004092285521387, -0.005233788461061,  0.133443147079441,
                                 0.086433877647766, -0.014843436423879, -0.017795874907692,
                                 0.030478977244050,  0.057098166204491,  0.002929876968848,
                                -0.018030269810945,  0.010489739578436,  0.005462305411118,
                                 0.003027934690534, -0.001710319539326, -0.154087347254137,
                                -0.237523086471895,  0.461270704598038,  1.000000000000001,
                                -0.002598639696317, -0.019290525394777, -0.010797085297836,
                                -0.019299459528481,  0.050901146925875,  0.064094078430745,
                                 0.156934496888330,  0.102925672496562,  0.012934767747597,
                                -0.053696865731972, -0.014174304535443, -0.002283614193004,
                                -0.090222308360489, -0.001354222388850,  0.023037154908663,
                                 0.002090269424392,  0.049304762612950, -0.002598639696317,
                                 1.000000000000000,  0.843105045632668, -0.115431894661672,
                                -0.121952386788523,  0.024108312930488, -0.035292495362482,
                                -0.057555854782158, -0.041843817373173,  0.135082870921951,
                                 0.143166781382951, -0.012005852455757, -0.103862143057002,
                                -0.003786242173829, -0.003319850679576, -0.048552755733369,
                                 0.020546927875842,  0.015773145852333, -0.003873023210085,
                                 0.028968452150844, -0.019290525394777,  0.843105045632668,
                                 1.000000000000000, -0.121113726992077, -0.177869746771617,
                                -0.004438482090966, -0.069076183251982, -0.053354595451525,
                                -0.058590840488634,  0.156934496888330,  0.135082870921951,
                                 0.012934767747597, -0.012005852455757, -0.014174304535443,
                                -0.003786242173829, -0.090222308360489, -0.048552755733370,
                                 0.023037154908663,  0.015773145852333,  0.049304762612950,
                                 0.028968452150844, -0.115431894661672, -0.121113726992077,
                                 1.000000000000001,  0.461270704598038,  0.024108312930488,
                                -0.004438482090966, -0.057555854782158, -0.053354595451525,
                                 0.102925672496562,  0.143166781382951, -0.053696865731972,
                                -0.103862143057002, -0.002283614193004, -0.003319850679576,
                                -0.001354222388850,  0.020546927875842,  0.002090269424392,
                                -0.003873023210085, -0.002598639696317, -0.019290525394777,
                                -0.121952386788523, -0.177869746771617,  0.461270704598038,
                                 1.000000000000001, -0.035292495362482, -0.069076183251982,
                                -0.041843817373173, -0.058590840488634, -0.088772723047987,
                                -0.144100022311385, -0.003142795974059, -0.000125041691225,
                                -0.048491018732049,  0.052536354847653,  0.022997964889309,
                                -0.027777218351006, -0.062558775262050,  0.017307838204431,
                                -0.004092285521387, -0.010797085297836,  0.024108312930488,
                                -0.035292495362482,  1.000000000000000,  0.843105045632668,
                                 0.065375402095683, -0.018402717879985, -0.057831965990399,
                                -0.095935256520480, -0.125484983897907, -0.228886295825567,
                                -0.000755804331155, -0.000061493878019,  0.003819100651585,
                                 0.103482714075258, -0.006670825284735, -0.050719785532221,
                                -0.001403128442184,  0.029779821015780, -0.005233788461061,
                                -0.019299459528481, -0.004438482090966, -0.069076183251982,
                                 0.843105045632668,  0.999999999999999,  0.001099238854500,
                                -0.021384097148637, -0.083220696629300, -0.152467734545983,
                                -0.088772723047987, -0.125484983897907, -0.003142795974059,
                                -0.000755804331155, -0.048491018732049,  0.003819100651585,
                                 0.022997964889309, -0.006670825284735, -0.062558775262050,
                                -0.001403128442184, -0.004092285521387, -0.005233788461061,
                                 0.024108312930488, -0.004438482090966,  0.065375402095683,
                                 0.001099238854500,  1.000000000000000,  0.461270704598038,
                                -0.057831965990400, -0.083220696629300, -0.144100022311385,
                                -0.228886295825567, -0.000125041691225, -0.000061493878019,
                                 0.052536354847653,  0.103482714075258, -0.027777218351006,
                                -0.050719785532220,  0.017307838204431,  0.029779821015780,
                                -0.010797085297836, -0.019299459528481, -0.035292495362482,
                                -0.069076183251982, -0.018402717879985, -0.021384097148637,
                                 0.461270704598038,  1.000000000000001, -0.095935256520480,
                                -0.152467734545983,  0.000690690361473,  0.000067247499286,
                                 0.092120259206873,  0.144425947571114, -0.164610418387558,
                                -0.103946591107599, -0.003656724530162,  0.004667545918657,
                                -0.068509523370904, -0.017557798067803,  0.133443147079441,
                                 0.050901146925875, -0.057555854782158, -0.041843817373173,
                                -0.057831965990400, -0.095935256520480,  1.000000000000000,
                                 0.843105045632668, -0.055508554714170,  0.020070612366216,
                                 0.000223071472951,  0.000063002767837,  0.126566133807291,
                                 0.229191648347056, -0.137953859601490, -0.144207401090086,
                                 0.003869129949317,  0.006846638577344, -0.036091696171430,
                                -0.020504177147476,  0.086433877647766,  0.064094078430745,
                                -0.053354595451525, -0.058590840488634, -0.083220696629300,
                                -0.152467734545983,  0.843105045632668,  1.000000000000000,
                                -0.033031947571109,  0.069461591294298,  0.000690690361473,
                                 0.000223071472951,  0.092120259206873,  0.126566133807291,
                                -0.164610418387558, -0.137953859601490, -0.003656724530162,
                                 0.003869129949317, -0.068509523370904, -0.036091696171430,
                                 0.133443147079441,  0.086433877647766, -0.057555854782158,
                                -0.053354595451525, -0.057831965990399, -0.083220696629300,
                                -0.055508554714170, -0.033031947571109,  1.000000000000001,
                                 0.461270704598038,  0.000067247499286,  0.000063002767837,
                                 0.144425947571114,  0.229191648347056, -0.103946591107599,
                                -0.144207401090086,  0.004667545918657,  0.006846638577344,
                                -0.017557798067803, -0.020504177147476,  0.050901146925875,
                                 0.064094078430745, -0.041843817373173, -0.058590840488634,
                                -0.095935256520480, -0.152467734545983,  0.020070612366216,
                                 0.069461591294298,  0.461270704598038,  1.000000000000002};

    std::vector<int32_t> rows{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                              0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
                              1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
                              2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3,
                              3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4,
                              4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
                              5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
                              5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
                              6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
                              7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
                              8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9,
                              9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10,
                              10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,
                              10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11,
                              11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12,
                              12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,
                              12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13,
                              13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14,
                              14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,
                              14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15,
                              15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15,
                              16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16,
                              16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17,
                              17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17,
                              17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18,
                              18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19,
                              19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19,
                              19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20,
                              20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21,
                              21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,
                              21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,
                              22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23,
                              23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
                              23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24,
                              24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25,
                              25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25,
                              25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26, 26,
                              26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27,
                              27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27,
                              27, 27, 27, 27, 27, 27, 28, 28, 28, 28, 28, 28, 28,
                              28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28,
                              29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29,
                              29, 29, 29, 29, 29, 29, 29, 30, 30, 30, 30, 30, 30,
                              30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30,
                              30, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,
                              31, 31, 31, 31, 31, 31, 31, 31, 32, 32, 32, 32, 32,
                              32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32,
                              32, 32, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33,
                              33, 33, 33, 33, 33, 33, 33, 33, 33, 34, 34, 34, 34,
                              34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34,
                              34, 34, 34, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35,
                              35, 35, 35, 35, 35, 35, 35, 35, 35, 35};

    std::vector<int32_t> cols{0, 1, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22, 23,
                              26, 27, 30, 31, 34, 35, 0, 1, 2, 3, 6, 7, 10, 11,
                              14, 15, 18, 19, 22, 23, 26, 27, 30, 31, 34, 35, 0,
                              1, 2, 3, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25,
                              28, 29, 32, 33, 0, 1, 2, 3, 4, 5, 8, 9, 12, 13, 16,
                              17, 20, 21, 24, 25, 28, 29, 32, 33, 2, 3, 4, 5, 6,
                              7, 10, 11, 14, 15, 18, 19, 22, 23, 26, 27, 30, 31,
                              34, 35, 2, 3, 4, 5, 6, 7, 10, 11, 14, 15, 18, 19,
                              22, 23, 26, 27, 30, 31, 34, 35, 0, 1, 4, 5, 6, 7,
                              8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 28, 29, 32,
                              33, 0, 1, 4, 5, 6, 7, 8, 9, 12, 13, 16, 17, 20, 21,
                              24, 25, 28, 29, 32, 33, 2, 3, 6, 7, 8, 9, 10, 11,
                              14, 15, 18, 19, 22, 23, 26, 27, 30, 31, 34, 35, 2,
                              3, 6, 7, 8, 9, 10, 11, 14, 15, 18, 19, 22, 23, 26,
                              27, 30, 31, 34, 35, 0, 1, 4, 5, 8, 9, 10, 11, 12,
                              13, 16, 17, 20, 21, 24, 25, 28, 29, 32, 33, 0, 1,
                              4, 5, 8, 9, 10, 11, 12, 13, 16, 17, 20, 21, 24, 25,
                              28, 29, 32, 33, 2, 3, 6, 7, 10, 11, 12, 13, 14, 15,
                              18, 19, 22, 23, 26, 27, 30, 31, 34, 35, 2, 3, 6, 7,
                              10, 11, 12, 13, 14, 15, 18, 19, 22, 23, 26, 27, 30,
                              31, 34, 35, 0, 1, 4, 5, 8, 9, 12, 13, 14, 15, 16,
                              17, 20, 21, 24, 25, 28, 29, 32, 33, 0, 1, 4, 5, 8,
                              9, 12, 13, 14, 15, 16, 17, 20, 21, 24, 25, 28, 29,
                              32, 33, 2, 3, 6, 7, 10, 11, 14, 15, 16, 17, 18, 19,
                              22, 23, 26, 27, 30, 31, 34, 35, 2, 3, 6, 7, 10, 11,
                              14, 15, 16, 17, 18, 19, 22, 23, 26, 27, 30, 31, 34,
                              35, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17, 18, 19, 20,
                              21, 24, 25, 28, 29, 32, 33, 0, 1, 4, 5, 8, 9, 12,
                              13, 16, 17, 18, 19, 20, 21, 24, 25, 28, 29, 32, 33,
                              2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 20, 21, 22, 23,
                              26, 27, 30, 31, 34, 35, 2, 3, 6, 7, 10, 11, 14, 15,
                              18, 19, 20, 21, 22, 23, 26, 27, 30, 31, 34, 35, 0,
                              1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 22, 23, 24,
                              25, 28, 29, 32, 33, 0, 1, 4, 5, 8, 9, 12, 13, 16,
                              17, 20, 21, 22, 23, 24, 25, 28, 29, 32, 33, 2, 3,
                              6, 7, 10, 11, 14, 15, 18, 19, 22, 23, 24, 25, 26,
                              27, 30, 31, 34, 35, 2, 3, 6, 7, 10, 11, 14, 15, 18,
                              19, 22, 23, 24, 25, 26, 27, 30, 31, 34, 35, 0, 1,
                              4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25, 26, 27,
                              28, 29, 32, 33, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17,
                              20, 21, 24, 25, 26, 27, 28, 29, 32, 33, 2, 3, 6, 7,
                              10, 11, 14, 15, 18, 19, 22, 23, 26, 27, 28, 29, 30,
                              31, 34, 35, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22,
                              23, 26, 27, 28, 29, 30, 31, 34, 35, 0, 1, 4, 5, 8,
                              9, 12, 13, 16, 17, 20, 21, 24, 25, 28, 29, 30, 31,
                              32, 33, 0, 1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21,
                              24, 25, 28, 29, 30, 31, 32, 33, 2, 3, 6, 7, 10, 11,
                              14, 15, 18, 19, 22, 23, 26, 27, 30, 31, 32, 33, 34,
                              35, 2, 3, 6, 7, 10, 11, 14, 15, 18, 19, 22, 23, 26,
                              27, 30, 31, 32, 33, 34, 35, 0, 1, 4, 5, 8, 9, 12,
                              13, 16, 17, 20, 21, 24, 25, 28, 29, 32, 33, 34, 35,
                              0, 1, 4, 5, 8, 9, 12, 13, 16, 17, 20, 21, 24, 25,
                              28, 29, 32, 33, 34, 35};

    ASSERT_EQ(ovlmat, CSparseMatrix(intvals, rows, cols, 36, 36, 1.0e-13));
}


