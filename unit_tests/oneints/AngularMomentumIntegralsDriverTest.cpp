//
//                             VELOXCHEM
//      ---------------------------------------------------
//                     An Electronic Structure Code
//
//  Copyright Â© 2019 by VeloxChem developers. All rights reserved.
//  Contact: Zilvinas Rinkevicius (rinkevic@kth.se), KTH, Sweden.

#include "AngularMomentumIntegralsDriverTest.hpp"

#include "AngularMomentumIntegralsDriver.hpp"
#include "MoleculeSetter.hpp"
#include "MolecularBasisSetter.hpp"

TEST_F(CAngularMomentumIntegralsDriverTest, ComputeSSForLiH)
{
    CAngularMomentumIntegralsDriver amomdrv(MPI_COMM_WORLD);
    
    amomdrv.setAngularMomentumOrigin(1.0, 2.0, 3.0); 
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH();
    
    CGtoBlock bgtos(mlih, mbas, 0);
    
    CGtoBlock kgtos(mlih, mbas, 0);
    
    CDenseMatrix amomxmat(4, 4);
    
    CDenseMatrix amomymat(4, 4);
    
    CDenseMatrix amomzmat(4, 4);
    
    amomdrv.compute(amomxmat.values(), amomymat.values(), amomzmat.values(),
                    bgtos, kgtos);
    
    std::vector<double> intxvals{ 0.000000000000000, -0.000000000000000,  0.127944518802996,
                                  0.145535821281024,  0.000000000000000,  0.000000000000000,
                                  0.146032908655964,  0.162329148804550, -0.127944518802996,
                                 -0.146032908655964,  0.000000000000001, -0.000000000000000,
                                 -0.145535821281024, -0.162329148804550,  0.000000000000000,
                                  0.000000000000000};
    
    ASSERT_EQ(amomxmat, CDenseMatrix(intxvals, 4, 4));
   
   std::vector<double> intyvals{ 0.000000000000000, -0.000000000000000,  0.031986129700749,
                                 0.036383955320256,  0.000000000000000,  0.000000000000000,
                                 0.036508227163991,  0.040582287201138, -0.031986129700749,
                                -0.036508227163991, -0.000000000000000,  0.000000000000000,
                                -0.036383955320256, -0.040582287201138, -0.000000000000000,
                                 0.000000000000000};
   
    ASSERT_EQ(amomymat, CDenseMatrix(intyvals, 4, 4));
    
    std::vector<double> intzvals{ 0.000000000000000, -0.000000000000000, -0.063972259401498,
                                 -0.072767910640512,  0.000000000000000,  0.000000000000000,
                                 -0.073016454327982, -0.081164574402275,  0.063972259401498,
                                  0.073016454327982,  0.000000000000000, -0.000000000000000,
                                  0.072767910640512,  0.081164574402275,  0.000000000000000,
                                  0.000000000000000};
    
    ASSERT_EQ(amomzmat, CDenseMatrix(intzvals, 4, 4));
}

TEST_F(CAngularMomentumIntegralsDriverTest, ComputeSPForLiH)
{
    CAngularMomentumIntegralsDriver amomdrv(MPI_COMM_WORLD);
    
    amomdrv.setAngularMomentumOrigin(1.0, 2.0, 3.0); 
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH();
    
    CGtoBlock bgtos(mlih, mbas, 0);
    
    CGtoBlock kgtos(mlih, mbas, 1);
    
    CDenseMatrix amomxmat(4, 12);
    
    CDenseMatrix amomymat(4, 12);
    
    CDenseMatrix amomzmat(4, 12);
    
    amomdrv.compute(amomxmat.values(), amomymat.values(), amomzmat.values(),
                    bgtos, kgtos);
    
    std::vector<double> intxvals{-4.297789018638930, -3.895414738760628, -0.732981563948731,
                                 -1.331052427370746,  2.865192679092620,  2.596943159173752,
                                  0.220384457978629,  0.610624618477252, -0.000000000000000,
                                 -0.000000000000000, -0.071538644796584, -0.073798311049754,
                                 -3.025897147732096, -3.286335345030998, -0.802989885202249,
                                 -1.465709248261963,  2.017264765154731,  2.190890230020665,
                                  0.309025256946127,  0.715794610592518, -0.000000000000000,
                                 -0.000000000000000, -0.060347022183655, -0.069691970199677,
                                 -0.561857855804990, -0.761101328533047, -2.974047821940778,
                                 -2.045750765960131,  0.110286423042074,  0.232130677913452,
                                  2.191403658272153,  1.507395301233781, -0.078779084552498,
                                 -0.085255095141393, -0.000000000000000, -0.000000000000000,
                                 -0.573029497153610, -0.789236297361076, -1.184236488734583,
                                 -1.699411662899840,  0.239880772935673,  0.362165510843122,
                                  0.872595307488640,  1.252198067399882, -0.047299362107478,
                                 -0.056903255386153, -0.000000000000000, -0.000000000000000};
    
    ASSERT_EQ(amomxmat, CDenseMatrix(intxvals, 4, 12));
    
    std::vector<double> intyvals{-0.000000000000000, -0.000000000000000, -0.026826991798719,
                                 -0.027674366643658, -1.432596339546310, -1.298471579586876,
                                 -0.257740683882270, -0.457521325778744,  4.297789018638930,
                                  3.895414738760628,  0.607788935554708,  1.201905383033676,
                                 -0.000000000000000, -0.000000000000000, -0.022630133318871,
                                 -0.026134488824879, -1.008632382577365, -1.095445115010333,
                                 -0.278978361726851, -0.501636993833094,  3.025897147732096,
                                  3.286335345030998,  0.697382596380853,  1.343748300412527,
                                 -0.029542156707187, -0.031970660678022,  0.000000000000000,
                                 -0.000000000000000, -0.194273008727603, -0.258576673432115,
                                 -0.939172996402351, -0.646026557671620,  0.423994457838119,
                                  0.611904912035608,  2.974047821940778,  2.045750765960131,
                                 -0.017737260790304, -0.021338720769808, -0.000000000000000,
                                 -0.000000000000000, -0.191070033762278, -0.261399329430142,
                                 -0.373969417495132, -0.536656314599950,  0.490255613465523,
                                  0.689655600435307,  1.184236488734583,  1.699411662899840};
    
    ASSERT_EQ(amomymat, CDenseMatrix(intyvals, 4, 12));
    
    std::vector<double> intzvals{ 1.432596339546310,  1.298471579586876,  0.262211849182056,
                                  0.462133720219354, -0.000000000000000, -0.000000000000000,
                                  0.098365636595303,  0.101472677693412, -2.865192679092620,
                                 -2.596943159173752, -0.381346408770944, -0.776670818339199,
                                  1.008632382577365,  1.095445115010333,  0.282750050613330,
                                  0.505992741970574, -0.000000000000000, -0.000000000000000,
                                  0.082977155502525,  0.095826459024556, -2.017264765154731,
                                 -2.190890230020665, -0.444806056859350, -0.872601543541792,
                                  0.199196701512134,  0.263905116878452,  0.939172996402351,
                                  0.646026557671620,  0.108321241259684,  0.117225755819416,
                                 -0.000000000000000, -0.000000000000000, -0.287539363285194,
                                 -0.423954641981587, -2.191403658272153, -1.507395301233781,
                                  0.194026243893996,  0.264955782891777,  0.373969417495132,
                                  0.536656314599950,  0.065036622897782,  0.078241976155961,
                                 -0.000000000000000, -0.000000000000000, -0.346304337677498,
                                 -0.490197835461968, -0.872595307488640, -1.252198067399882};
    
    ASSERT_EQ(amomzmat, CDenseMatrix(intzvals, 4, 12));
}

TEST_F(CAngularMomentumIntegralsDriverTest, ComputePSForLiH)
{
    CAngularMomentumIntegralsDriver amomdrv(MPI_COMM_WORLD);
    
    amomdrv.setAngularMomentumOrigin(1.0, 2.0, 3.0);
    
    auto mlih = vlxmol::getTestLiH();
    
    auto mbas = vlxbas::getTestBasisForLiH();
    
    CGtoBlock bgtos(mlih, mbas, 1);
    
    CGtoBlock kgtos(mlih, mbas, 0);
    
    CDenseMatrix amomxmat(12, 4);
    
    CDenseMatrix amomymat(12, 4);
    
    CDenseMatrix amomzmat(12, 4);
    
    amomdrv.compute(amomxmat.values(), amomymat.values(), amomzmat.values(),
                   bgtos, kgtos);
    
    std::vector<double> intxvals{ 4.297789018638930,  3.025897147732096,  0.561857855804990,
                                  0.573029497153610,  3.895414738760628,  3.286335345030998,
                                  0.761101328533047,  0.789236297361076,  0.732981563948731,
                                  0.802989885202249,  2.974047821940778,  1.184236488734583,
                                  1.331052427370746,  1.465709248261963,  2.045750765960131,
                                  1.699411662899840, -2.865192679092620, -2.017264765154731,
                                 -0.110286423042074, -0.239880772935673, -2.596943159173752,
                                 -2.190890230020665, -0.232130677913452, -0.362165510843122,
                                 -0.220384457978629, -0.309025256946127, -2.191403658272153,
                                 -0.872595307488640, -0.610624618477252, -0.715794610592518,
                                 -1.507395301233781, -1.252198067399882,  0.000000000000000,
                                  0.000000000000000,  0.078779084552498,  0.047299362107478,
                                  0.000000000000000,  0.000000000000000,  0.085255095141393,
                                  0.056903255386153,  0.071538644796584,  0.060347022183655,
                                  0.000000000000000,  0.000000000000000,  0.073798311049754,
                                  0.069691970199677,  0.000000000000000,  0.000000000000000};
    
    ASSERT_EQ(amomxmat, CDenseMatrix(intxvals, 12, 4));
    
    std::vector<double> intyvals{ 0.000000000000000,  0.000000000000000,  0.029542156707187,
                                  0.017737260790304,  0.000000000000000,  0.000000000000000,
                                  0.031970660678022,  0.021338720769808,  0.026826991798719,
                                  0.022630133318871, -0.000000000000000,  0.000000000000000,
                                  0.027674366643658,  0.026134488824879,  0.000000000000000,
                                  0.000000000000000,  1.432596339546310,  1.008632382577365,
                                  0.194273008727603,  0.191070033762278,  1.298471579586876,
                                  1.095445115010333,  0.258576673432115,  0.261399329430142,
                                  0.257740683882270,  0.278978361726851,  0.939172996402351,
                                  0.373969417495132,  0.457521325778744,  0.501636993833094,
                                  0.646026557671620,  0.536656314599950, -4.297789018638930,
                                 -3.025897147732096, -0.423994457838119, -0.490255613465523,
                                 -3.895414738760628, -3.286335345030998, -0.611904912035608,
                                 -0.689655600435307, -0.607788935554708, -0.697382596380853,
                                 -2.974047821940778, -1.184236488734583, -1.201905383033676,
                                 -1.343748300412527, -2.045750765960131, -1.699411662899840};
    
    ASSERT_EQ(amomymat, CDenseMatrix(intyvals, 12, 4));
    
    std::vector<double> intzvals{-1.432596339546310, -1.008632382577365, -0.199196701512134,
                                 -0.194026243893996, -1.298471579586876, -1.095445115010333,
                                 -0.263905116878452, -0.264955782891777, -0.262211849182056,
                                 -0.282750050613330, -0.939172996402351, -0.373969417495132,
                                 -0.462133720219354, -0.505992741970574, -0.646026557671620,
                                 -0.536656314599950,  0.000000000000000,  0.000000000000000,
                                 -0.108321241259684, -0.065036622897782,  0.000000000000000,
                                  0.000000000000000, -0.117225755819416, -0.078241976155961,
                                 -0.098365636595303, -0.082977155502525,  0.000000000000000,
                                  0.000000000000000, -0.101472677693412, -0.095826459024556,
                                  0.000000000000000,  0.000000000000000,  2.865192679092620,
                                  2.017264765154731,  0.287539363285194,  0.346304337677498,
                                  2.596943159173752,  2.190890230020665,  0.423954641981587,
                                  0.490197835461968,  0.381346408770944,  0.444806056859350,
                                  2.191403658272153,  0.872595307488640,  0.776670818339199,
                                  0.872601543541792,  1.507395301233781,  1.252198067399882};
    
    ASSERT_EQ(amomzmat, CDenseMatrix(intzvals, 12, 4));
}
